<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>履歴改修案（グラフ式）3: ダッシュボードスタイル型 v2（推奨）</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .category-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .category-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }
        .metric-button {
            transition: all 0.2s ease;
        }
        .metric-button.active {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .chart-container {
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-2xl font-bold mb-2 text-gray-800">📊 履歴改修案（グラフ式）3: ダッシュボードスタイル型 v2</h1>
        <div class="bg-yellow-100 border-l-4 border-yellow-500 p-3 mb-6">
            <p class="text-sm font-semibold text-yellow-800">⭐ 推奨案（改良版）</p>
            <p class="text-xs text-yellow-700">大カテゴリ3つ + 小カテゴリ切り替えで1項目ずつ表示。見やすさ重視</p>
        </div>

        <!-- 大カテゴリカード（3つ） -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <!-- 栄養・食事カード -->
            <div class="category-card bg-gradient-to-br from-green-500 to-green-600 rounded-lg shadow-lg p-6 text-white" onclick="selectCategory('nutrition')">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <div class="text-sm opacity-90">📊 栄養・食事</div>
                        <div class="text-4xl font-bold mt-2">85点</div>
                        <div class="text-sm opacity-75">/ 100点</div>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-green-200">↑</div>
                        <div class="text-sm">+3点</div>
                    </div>
                </div>
                <div class="h-16 opacity-50">
                    <canvas id="nutrition-sparkline"></canvas>
                </div>
            </div>

            <!-- トレーニングカード -->
            <div class="category-card bg-gradient-to-br from-red-500 to-red-600 rounded-lg shadow-lg p-6 text-white" onclick="selectCategory('training')">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <div class="text-sm opacity-90">💪 トレーニング</div>
                        <div class="text-4xl font-bold mt-2">88点</div>
                        <div class="text-sm opacity-75">/ 100点</div>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-red-200">↑</div>
                        <div class="text-sm">+5点</div>
                    </div>
                </div>
                <div class="h-16 opacity-50">
                    <canvas id="training-sparkline"></canvas>
                </div>
            </div>

            <!-- コンディションカード -->
            <div class="category-card bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-lg p-6 text-white" onclick="selectCategory('condition')">
                <div class="flex items-center justify-between mb-4">
                    <div>
                        <div class="text-sm opacity-90">🧘 コンディション</div>
                        <div class="text-4xl font-bold mt-2">24点</div>
                        <div class="text-sm opacity-75">/ 30点</div>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-blue-200">→</div>
                        <div class="text-sm">±0点</div>
                    </div>
                </div>
                <div class="h-16 opacity-50">
                    <canvas id="condition-sparkline"></canvas>
                </div>
            </div>
        </div>

        <!-- 詳細表示エリア -->
        <div id="detail-area" class="bg-white rounded-lg shadow-lg p-6">
            <!-- 栄養・食事の詳細 -->
            <div id="nutrition-detail" class="detail-section">
                <h2 class="text-xl font-bold mb-4 text-green-700">📊 栄養・食事 - 詳細</h2>

                <!-- 小カテゴリボタン -->
                <div class="flex flex-wrap gap-2 mb-6">
                    <button class="metric-button active px-4 py-2 bg-green-100 text-green-700 rounded-full text-sm font-semibold" onclick="selectMetric('nutrition', 'calories')">
                        🔥 カロリー
                    </button>
                    <button class="metric-button px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-semibold" onclick="selectMetric('nutrition', 'protein')">
                        🥩 タンパク質
                    </button>
                    <button class="metric-button px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-semibold" onclick="selectMetric('nutrition', 'fat')">
                        🧈 脂質
                    </button>
                    <button class="metric-button px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-semibold" onclick="selectMetric('nutrition', 'carbs')">
                        🍚 糖質
                    </button>
                    <button class="metric-button px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-semibold" onclick="selectMetric('nutrition', 'fiber')">
                        🥬 食物繊維
                    </button>
                    <button class="metric-button px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-semibold" onclick="selectMetric('nutrition', 'vitamin')">
                        💊 ビタミン
                    </button>
                    <button class="metric-button px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-semibold" onclick="selectMetric('nutrition', 'mineral')">
                        ⚡ ミネラル
                    </button>
                </div>

                <!-- 選択中の指標の詳細グラフ -->
                <div id="nutrition-chart-container" class="chart-container">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">🔥 カロリー</h3>
                            <p class="text-sm text-gray-500">過去7日間の推移</p>
                        </div>
                        <div class="text-right">
                            <div class="text-4xl font-bold text-blue-600">2,450</div>
                            <div class="text-sm text-gray-500">kcal</div>
                            <div class="text-sm font-semibold text-green-600 mt-1">目標: 2,500kcal (98%)</div>
                        </div>
                    </div>
                    <canvas id="nutrition-detail-chart" height="100"></canvas>
                    <div class="mt-4 grid grid-cols-3 gap-4 text-center">
                        <div class="bg-blue-50 p-3 rounded">
                            <div class="text-xs text-gray-600">平均</div>
                            <div class="text-xl font-bold text-blue-600">2,420kcal</div>
                        </div>
                        <div class="bg-green-50 p-3 rounded">
                            <div class="text-xs text-gray-600">最高</div>
                            <div class="text-xl font-bold text-green-600">2,500kcal</div>
                        </div>
                        <div class="bg-orange-50 p-3 rounded">
                            <div class="text-xs text-gray-600">最低</div>
                            <div class="text-xl font-bold text-orange-600">2,380kcal</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- トレーニングの詳細 -->
            <div id="training-detail" class="detail-section hidden">
                <h2 class="text-xl font-bold mb-4 text-red-700">💪 トレーニング - 詳細</h2>

                <!-- 小カテゴリボタン -->
                <div class="flex flex-wrap gap-2 mb-6">
                    <button class="metric-button active px-4 py-2 bg-red-100 text-red-700 rounded-full text-sm font-semibold" onclick="selectMetric('training', 'rm')">
                        🏋️ RM記録
                    </button>
                    <button class="metric-button px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-semibold" onclick="selectMetric('training', 'habit')">
                        📈 運動習慣率
                    </button>
                </div>

                <!-- 選択中の指標の詳細グラフ -->
                <div id="training-chart-container" class="chart-container">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">🏋️ RM記録</h3>
                            <p class="text-sm text-gray-500">過去4週間の推移</p>
                        </div>
                    </div>
                    <canvas id="training-detail-chart" height="100"></canvas>
                    <div class="mt-4 grid grid-cols-3 gap-4">
                        <div class="bg-blue-50 p-3 rounded">
                            <div class="text-xs text-gray-600">ベンチプレス 1RM</div>
                            <div class="text-2xl font-bold text-blue-600">100kg</div>
                            <div class="text-sm text-green-600 font-semibold">↑ +2kg</div>
                        </div>
                        <div class="bg-purple-50 p-3 rounded">
                            <div class="text-xs text-gray-600">スクワット 5RM</div>
                            <div class="text-2xl font-bold text-purple-600">120kg</div>
                            <div class="text-sm text-gray-400">-</div>
                        </div>
                        <div class="bg-orange-50 p-3 rounded">
                            <div class="text-xs text-gray-600">デッドリフト 3RM</div>
                            <div class="text-2xl font-bold text-orange-600">150kg</div>
                            <div class="text-sm text-green-600 font-semibold">↑ +5kg</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- コンディションの詳細 -->
            <div id="condition-detail" class="detail-section hidden">
                <h2 class="text-xl font-bold mb-4 text-blue-700">🧘 コンディション - 詳細</h2>

                <!-- 小カテゴリボタン -->
                <div class="flex flex-wrap gap-2 mb-6">
                    <button class="metric-button active px-4 py-2 bg-blue-100 text-blue-700 rounded-full text-sm font-semibold" onclick="selectMetric('condition', 'total')">
                        🎯 総合スコア
                    </button>
                    <button class="metric-button px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-semibold" onclick="selectMetric('condition', 'sleep')">
                        😴 睡眠の質
                    </button>
                    <button class="metric-button px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-semibold" onclick="selectMetric('condition', 'appetite')">
                        🍽️ 食欲
                    </button>
                    <button class="metric-button px-4 py-2 bg-gray-100 text-gray-700 rounded-full text-sm font-semibold" onclick="selectMetric('condition', 'focus')">
                        🧠 集中力
                    </button>
                </div>

                <!-- 選択中の指標の詳細グラフ -->
                <div id="condition-chart-container" class="chart-container">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">🎯 総合スコア</h3>
                            <p class="text-sm text-gray-500">過去7日間の推移</p>
                        </div>
                        <div class="text-right">
                            <div class="text-4xl font-bold text-blue-600">24</div>
                            <div class="text-sm text-gray-500">/ 30点</div>
                        </div>
                    </div>
                    <canvas id="condition-detail-chart" height="100"></canvas>
                    <div class="mt-4 grid grid-cols-3 gap-4 text-center">
                        <div class="bg-blue-50 p-3 rounded">
                            <div class="text-xs text-gray-600">平均</div>
                            <div class="text-xl font-bold text-blue-600">24.0点</div>
                        </div>
                        <div class="bg-green-50 p-3 rounded">
                            <div class="text-xs text-gray-600">最高</div>
                            <div class="text-xl font-bold text-green-600">26点</div>
                        </div>
                        <div class="bg-orange-50 p-3 rounded">
                            <div class="text-xs text-gray-600">最低</div>
                            <div class="text-xl font-bold text-orange-600">22点</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- メリット・デメリット -->
        <div class="bg-white rounded-lg shadow-md p-4 mt-6">
            <h3 class="font-bold text-lg mb-3 text-gray-800">✅ メリット（v2改良版）</h3>
            <ul class="list-disc pl-5 space-y-1 text-sm text-gray-700 mb-4">
                <li><strong>3つの大カテゴリのみ</strong>で見やすく、無限に増えない</li>
                <li>小カテゴリ切り替えで<strong>1項目ずつ大きく表示</strong>（視認性が高い）</li>
                <li>大カテゴリカードで<strong>全体のスコアを一目で確認</strong></li>
                <li>詳細グラフは<strong>統計情報付き</strong>（平均・最高・最低）</li>
                <li>モバイルでも快適に操作できる</li>
            </ul>
            <h3 class="font-bold text-lg mb-3 text-gray-800">⚠️ デメリット</h3>
            <ul class="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li>複数の小カテゴリを同時に比較できない（切り替えが必要）</li>
            </ul>
        </div>

        <div class="bg-green-50 border-l-4 border-green-500 p-4 mt-6">
            <h3 class="font-bold text-green-800 mb-2">🎯 v2の改良ポイント</h3>
            <ol class="list-decimal pl-5 space-y-1 text-sm text-green-900">
                <li><strong>大カテゴリを3つに固定</strong>: カードの無限増殖を防止</li>
                <li><strong>1項目ずつ表示</strong>: 見やすさ重視で、選択した指標だけを大きく表示</li>
                <li><strong>小カテゴリはボタン切り替え</strong>: タップで簡単に切り替え可能</li>
                <li><strong>統計情報を追加</strong>: 平均・最高・最低を表示し、データの傾向を把握</li>
                <li><strong>シンプルな構成</strong>: スクロール量を最小化</li>
            </ol>
        </div>
    </div>

    <script>
        let currentCategory = 'nutrition';
        let currentMetric = { nutrition: 'calories', training: 'rm', condition: 'total' };
        let charts = {};

        // スパークライン描画
        function createSparkline(canvasId, data, color) {
            const ctx = document.getElementById(canvasId);
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['', '', '', '', '', '', ''],
                    datasets: [{
                        data: data,
                        borderColor: color,
                        borderWidth: 2,
                        pointRadius: 0,
                        fill: false,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { enabled: false } },
                    scales: { x: { display: false }, y: { display: false } }
                }
            });
        }

        // 初期化
        createSparkline('nutrition-sparkline', [80, 82, 85, 83, 87, 82, 85], 'rgba(255,255,255,0.8)');
        createSparkline('training-sparkline', [82, 85, 86, 88, 87, 86, 88], 'rgba(255,255,255,0.8)');
        createSparkline('condition-sparkline', [22, 24, 26, 24, 23, 25, 24], 'rgba(255,255,255,0.8)');

        // カテゴリ選択
        function selectCategory(category) {
            currentCategory = category;
            document.querySelectorAll('.detail-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`${category}-detail`).classList.remove('hidden');

            // 選択中の小カテゴリを表示
            selectMetric(category, currentMetric[category]);
        }

        // 小カテゴリ選択
        function selectMetric(category, metric) {
            currentMetric[category] = metric;

            // ボタンのアクティブ状態を更新
            const buttons = document.querySelectorAll(`#${category}-detail .metric-button`);
            buttons.forEach(btn => {
                btn.classList.remove('active', 'bg-green-100', 'text-green-700', 'bg-red-100', 'text-red-700', 'bg-blue-100', 'text-blue-700');
                btn.classList.add('bg-gray-100', 'text-gray-700');
            });
            event.target.classList.add('active');
            event.target.classList.remove('bg-gray-100', 'text-gray-700');

            if (category === 'nutrition') {
                event.target.classList.add('bg-green-100', 'text-green-700');
                updateNutritionChart(metric);
            } else if (category === 'training') {
                event.target.classList.add('bg-red-100', 'text-red-700');
                updateTrainingChart(metric);
            } else if (category === 'condition') {
                event.target.classList.add('bg-blue-100', 'text-blue-700');
                updateConditionChart(metric);
            }
        }

        // 栄養グラフ更新
        function updateNutritionChart(metric) {
            const data = {
                calories: { values: [2400, 2450, 2500, 2420, 2380, 2460, 2480], label: '🔥 カロリー', unit: 'kcal', color: 'rgb(59, 130, 246)' },
                protein: { values: [145, 150, 155, 148, 142, 152, 150], label: '🥩 タンパク質', unit: 'g', color: 'rgb(6, 182, 212)' },
                fat: { values: [60, 65, 68, 63, 62, 64, 65], label: '🧈 脂質', unit: 'g', color: 'rgb(245, 158, 11)' },
                carbs: { values: [280, 285, 290, 280, 275, 290, 295], label: '🍚 糖質', unit: 'g', color: 'rgb(34, 197, 94)' },
                fiber: { values: [23, 24, 25, 25, 24, 24, 25], label: '🥬 食物繊維', unit: 'g', color: 'rgb(132, 204, 22)' },
                vitamin: { values: [75, 76, 78, 79, 78, 77, 78], label: '💊 ビタミン', unit: '%', color: 'rgb(168, 85, 247)' },
                mineral: { values: [80, 81, 82, 83, 82, 81, 82], label: '⚡ ミネラル', unit: '%', color: 'rgb(249, 115, 22)' }
            };

            const selected = data[metric];
            if (charts['nutrition']) charts['nutrition'].destroy();

            charts['nutrition'] = new Chart(document.getElementById('nutrition-detail-chart'), {
                type: 'line',
                data: {
                    labels: ['月', '火', '水', '木', '金', '土', '日'],
                    datasets: [{
                        label: selected.label,
                        data: selected.values,
                        borderColor: selected.color,
                        backgroundColor: selected.color.replace('rgb', 'rgba').replace(')', ', 0.1)'),
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: false } }
                }
            });

            // タイトルと数値を更新
            const container = document.getElementById('nutrition-chart-container');
            container.querySelector('h3').textContent = selected.label;
            container.querySelector('.text-4xl').textContent = selected.values[selected.values.length - 1];
            container.querySelector('.text-sm.text-gray-500').textContent = selected.unit;
        }

        // トレーニンググラフ更新
        function updateTrainingChart(metric) {
            if (metric === 'rm') {
                if (charts['training']) charts['training'].destroy();
                charts['training'] = new Chart(document.getElementById('training-detail-chart'), {
                    type: 'line',
                    data: {
                        labels: ['第1週', '第2週', '第3週', '第4週'],
                        datasets: [
                            { label: 'ベンチプレス 1RM', data: [95, 97, 98, 100], borderColor: 'rgb(59, 130, 246)', tension: 0.4 },
                            { label: 'スクワット 5RM', data: [115, 117, 118, 120], borderColor: 'rgb(168, 85, 247)', tension: 0.4 },
                            { label: 'デッドリフト 3RM', data: [140, 143, 145, 150], borderColor: 'rgb(249, 115, 22)', tension: 0.4 }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: { legend: { display: true, position: 'bottom' } }
                    }
                });
            } else if (metric === 'habit') {
                if (charts['training']) charts['training'].destroy();
                charts['training'] = new Chart(document.getElementById('training-detail-chart'), {
                    type: 'bar',
                    data: {
                        labels: ['月', '火', '水', '木', '金', '土', '日'],
                        datasets: [{
                            label: '運動実施',
                            data: [1, 1, 0, 1, 1, 1, 1],
                            backgroundColor: ['rgb(34, 197, 94)', 'rgb(34, 197, 94)', 'rgb(229, 231, 235)', 'rgb(34, 197, 94)', 'rgb(34, 197, 94)', 'rgb(34, 197, 94)', 'rgb(34, 197, 94)']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: { legend: { display: false } },
                        scales: { y: { beginAtZero: true, max: 1, ticks: { stepSize: 1 } } }
                    }
                });
            }
        }

        // コンディショングラフ更新
        function updateConditionChart(metric) {
            const data = {
                total: { values: [22, 24, 26, 24, 23, 25, 24], label: '🎯 総合スコア', unit: '点', color: 'rgb(59, 130, 246)' },
                sleep: { values: [7, 8, 9, 8, 7, 8, 8], label: '😴 睡眠の質', unit: '/ 10', color: 'rgb(59, 130, 246)' },
                appetite: { values: [7, 8, 8, 8, 7, 8, 8], label: '🍽️ 食欲', unit: '/ 10', color: 'rgb(34, 197, 94)' },
                focus: { values: [8, 8, 9, 8, 9, 9, 8], label: '🧠 集中力', unit: '/ 10', color: 'rgb(168, 85, 247)' }
            };

            const selected = data[metric];
            if (charts['condition']) charts['condition'].destroy();

            charts['condition'] = new Chart(document.getElementById('condition-detail-chart'), {
                type: 'line',
                data: {
                    labels: ['月', '火', '水', '木', '金', '土', '日'],
                    datasets: [{
                        label: selected.label,
                        data: selected.values,
                        borderColor: selected.color,
                        backgroundColor: selected.color.replace('rgb', 'rgba').replace(')', ', 0.1)'),
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, max: metric === 'total' ? 30 : 10 } }
                }
            });

            const container = document.getElementById('condition-chart-container');
            container.querySelector('h3').textContent = selected.label;
            container.querySelector('.text-4xl').textContent = selected.values[selected.values.length - 1];
            container.querySelector('.text-sm.text-gray-500').textContent = selected.unit;
        }

        // 初期表示
        updateNutritionChart('calories');
        updateTrainingChart('rm');
        updateConditionChart('total');
    </script>
</body>
</html>