<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å±¥æ­´æ”¹ä¿®æ¡ˆï¼ˆã‚°ãƒ©ãƒ•å¼ï¼‰3: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«å‹ v6ï¼ˆæœ€çµ‚ç‰ˆï¼‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .tab-button {
            transition: all 0.3s ease;
            position: relative;
        }
        .tab-button.active {
            font-weight: 600;
        }
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: currentColor;
        }
        .sub-tab-button {
            transition: all 0.2s ease;
        }
        .sub-tab-button.active {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .chart-container {
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .day-box {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.75rem;
        }
        .day-box.done {
            background-color: #22c55e;
            color: white;
        }
        .day-box.not-done {
            background-color: #e5e7eb;
            color: #6b7280;
        }
        .range-control {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-2xl font-bold mb-2 text-gray-800">ğŸ“Š å±¥æ­´æ”¹ä¿®æ¡ˆï¼ˆã‚°ãƒ©ãƒ•å¼ï¼‰3: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«å‹ v6</h1>
        <div class="bg-yellow-100 border-l-4 border-yellow-500 p-3 mb-6">
            <p class="text-sm font-semibold text-yellow-800">â­ æ¨å¥¨æ¡ˆï¼ˆæœ€çµ‚ç‰ˆï¼‰</p>
            <p class="text-xs text-yellow-700">é …ç›®ã”ã¨ã«é©åˆ‡ãªãƒ¬ãƒ³ã‚¸è¨­å®šã€åˆå›è¨˜éŒ²ã‚’åŸºæº–è»¸ã¨ã—ã¦ä»»æ„å¤‰æ›´å¯èƒ½</p>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <!-- å¤§ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ– -->
            <div class="flex border-b bg-gray-50">
                <button
                    class="tab-button flex-1 py-4 px-4 text-center transition text-gray-600"
                    onclick="selectMainCategory('nutrition')">
                    <div class="flex items-center justify-center gap-2">
                        <i data-lucide="utensils" class="w-5 h-5"></i>
                        <div>
                            <div class="text-sm font-semibold">é£Ÿäº‹</div>
                            <div class="text-xs opacity-75">85ç‚¹</div>
                        </div>
                    </div>
                </button>
                <button
                    class="tab-button flex-1 py-4 px-4 text-center transition text-gray-600"
                    onclick="selectMainCategory('training')">
                    <div class="flex items-center justify-center gap-2">
                        <i data-lucide="dumbbell" class="w-5 h-5"></i>
                        <div>
                            <div class="text-sm font-semibold">é‹å‹•</div>
                            <div class="text-xs opacity-75">88ç‚¹</div>
                        </div>
                    </div>
                </button>
                <button
                    class="tab-button flex-1 py-4 px-4 text-center transition text-gray-600"
                    onclick="selectMainCategory('condition')">
                    <div class="flex items-center justify-center gap-2">
                        <i data-lucide="activity" class="w-5 h-5"></i>
                        <div>
                            <div class="text-sm font-semibold">ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³</div>
                            <div class="text-xs opacity-75">24/30ç‚¹</div>
                        </div>
                    </div>
                </button>
                <button
                    class="tab-button flex-1 py-4 px-4 text-center transition active text-purple-700 bg-white border-b-0"
                    onclick="selectMainCategory('performance')">
                    <div class="flex items-center justify-center gap-2">
                        <i data-lucide="trending-up" class="w-5 h-5"></i>
                        <div>
                            <div class="text-sm font-semibold">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</div>
                            <div class="text-xs opacity-75">ç·åˆ92ç‚¹</div>
                        </div>
                    </div>
                </button>
            </div>

            <!-- å°ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–ï¼ˆæ „é¤Šãƒ»é£Ÿäº‹ï¼‰ -->
            <div id="nutrition-subtabs" class="sub-tabs hidden flex-wrap gap-2 p-4 bg-green-50 border-b">
                <button class="sub-tab-button active px-4 py-2 bg-white text-green-700 rounded-lg text-sm font-semibold border-2 border-green-500" onclick="selectSubCategory('nutrition', 'calories')">
                    ğŸ”¥ ã‚«ãƒ­ãƒªãƒ¼
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('nutrition', 'protein')">
                    ğŸ¥© ã‚¿ãƒ³ãƒ‘ã‚¯è³ª
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('nutrition', 'fat')">
                    ğŸ§ˆ è„‚è³ª
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('nutrition', 'carbs')">
                    ğŸš ç³–è³ª
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('nutrition', 'fiber')">
                    ğŸ¥¬ é£Ÿç‰©ç¹Šç¶­
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('nutrition', 'vitamin')">
                    ğŸ’Š ãƒ“ã‚¿ãƒŸãƒ³
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('nutrition', 'mineral')">
                    âš¡ ãƒŸãƒãƒ©ãƒ«
                </button>
            </div>

            <!-- å°ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–ï¼ˆãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ï¼‰ -->
            <div id="training-subtabs" class="sub-tabs hidden flex-wrap gap-2 p-4 bg-red-50 border-b">
                <button class="sub-tab-button active px-4 py-2 bg-white text-red-700 rounded-lg text-sm font-semibold border-2 border-red-500" onclick="selectSubCategory('training', 'habit')">
                    ğŸ“ˆ é‹å‹•ç¿’æ…£ç‡
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('training', 'big3')">
                    ğŸ‹ï¸ BIG3åˆè¨ˆ
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('training', 'routine')">
                    ğŸ“‹ åˆ†å‰²æ³•åˆ¥
                </button>
            </div>

            <!-- å°ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–ï¼ˆã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ï¼‰ -->
            <div id="condition-subtabs" class="sub-tabs hidden flex-wrap gap-2 p-4 bg-blue-50 border-b">
                <button class="sub-tab-button active px-4 py-2 bg-white text-blue-700 rounded-lg text-sm font-semibold border-2 border-blue-500" onclick="selectSubCategory('condition', 'total')">
                    ğŸ¯ ç·åˆã‚¹ã‚³ã‚¢
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('condition', 'sleep')">
                    ğŸ˜´ ç¡çœ ã®è³ª
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('condition', 'appetite')">
                    ğŸ½ï¸ é£Ÿæ¬²
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('condition', 'focus')">
                    ğŸ§  é›†ä¸­åŠ›
                </button>
            </div>

            <!-- å°ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼‰ -->
            <div id="performance-subtabs" class="sub-tabs flex flex-wrap gap-2 p-4 bg-purple-50 border-b">
                <button class="sub-tab-button active px-4 py-2 bg-white text-purple-700 rounded-lg text-sm font-semibold border-2 border-purple-500" onclick="selectSubCategory('performance', 'lbm')">
                    ğŸ’ª LBM
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('performance', 'directive')">
                    ğŸ“‹ æŒ‡ç¤ºæ›¸é”æˆç‡
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('performance', 'overall')">
                    ğŸ¯ ç·åˆåˆ†æ
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('performance', 'rm_detail')">
                    ğŸ‹ï¸ RMè¨˜éŒ²è©³ç´°
                </button>
            </div>

            <!-- è©³ç´°ã‚°ãƒ©ãƒ•è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div class="p-6">
                <div id="chart-display" class="chart-container">
                    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 id="chart-title" class="text-3xl font-bold text-gray-800">ğŸ’ª LBMï¼ˆé™¤è„‚è‚ªä½“é‡ï¼‰</h3>
                            <p id="chart-period" class="text-sm text-gray-500 mt-1">éå»7æ—¥é–“ã®æ¨ç§»</p>
                        </div>
                        <div class="text-right">
                            <div id="chart-value" class="text-5xl font-bold text-purple-600">62.5</div>
                            <div id="chart-unit" class="text-sm text-gray-500 mt-1">kg</div>
                            <div id="chart-target" class="text-sm font-semibold text-green-600 mt-2">ç›®æ¨™: 65kg</div>
                        </div>
                    </div>

                    <!-- Yè»¸ãƒ¬ãƒ³ã‚¸ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
                    <div id="range-control" class="range-control">
                        <div class="flex items-center justify-between mb-2">
                            <label class="text-sm font-semibold text-gray-700">Yè»¸ã®è¡¨ç¤ºç¯„å›²</label>
                            <button
                                onclick="resetAxisRange()"
                                class="text-xs text-blue-600 hover:text-blue-800 underline">
                                åˆæœŸå€¤ã«æˆ»ã™
                            </button>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-xs text-gray-600 block mb-1">æœ€å°å€¤</label>
                                <input
                                    type="number"
                                    id="axis-min"
                                    class="w-full px-3 py-2 border border-gray-300 rounded text-sm"
                                    onchange="updateAxisRange()"
                                />
                            </div>
                            <div>
                                <label class="text-xs text-gray-600 block mb-1">æœ€å¤§å€¤</label>
                                <input
                                    type="number"
                                    id="axis-max"
                                    class="w-full px-3 py-2 border border-gray-300 rounded text-sm"
                                    onchange="updateAxisRange()"
                                />
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">ğŸ’¡ åˆå›è¨˜éŒ²æ™‚ã®ãƒ¬ãƒ³ã‚¸ã‚’åŸºæº–ã«è‡ªå‹•è¨­å®šã•ã‚Œã¾ã™</p>
                    </div>

                    <!-- ã‚°ãƒ©ãƒ• -->
                    <canvas id="main-chart" height="100" class="mt-4"></canvas>

                    <!-- çµ±è¨ˆæƒ…å ± -->
                    <div id="stats-container" class="mt-6 grid grid-cols-3 gap-4 text-center">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <div class="text-xs text-gray-600 mb-1">å¹³å‡</div>
                            <div id="stat-avg" class="text-2xl font-bold text-blue-600">62.0</div>
                            <div id="stat-avg-unit" class="text-xs text-gray-500">kg</div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <div class="text-xs text-gray-600 mb-1">æœ€é«˜</div>
                            <div id="stat-max" class="text-2xl font-bold text-green-600">62.5</div>
                            <div id="stat-max-unit" class="text-xs text-gray-500">kg</div>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <div class="text-xs text-gray-600 mb-1">æœ€ä½</div>
                            <div id="stat-min" class="text-2xl font-bold text-orange-600">61.0</div>
                            <div id="stat-min-unit" class="text-xs text-gray-500">kg</div>
                        </div>
                    </div>

                    <!-- é‹å‹•ç¿’æ…£ç‡ç”¨ã®é€±é–“ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
                    <div id="habit-calendar" class="mt-6 hidden">
                        <div class="grid grid-cols-7 gap-2">
                            <div class="text-center">
                                <div class="text-xs text-gray-500 mb-2">æœˆ</div>
                                <div class="day-box done">å®Ÿæ–½</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xs text-gray-500 mb-2">ç«</div>
                                <div class="day-box done">å®Ÿæ–½</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xs text-gray-500 mb-2">æ°´</div>
                                <div class="day-box not-done">æœªå®Ÿæ–½</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xs text-gray-500 mb-2">æœ¨</div>
                                <div class="day-box done">å®Ÿæ–½</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xs text-gray-500 mb-2">é‡‘</div>
                                <div class="day-box done">å®Ÿæ–½</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xs text-gray-500 mb-2">åœŸ</div>
                                <div class="day-box done">å®Ÿæ–½</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xs text-gray-500 mb-2">æ—¥</div>
                                <div class="day-box done">å®Ÿæ–½</div>
                            </div>
                        </div>
                    </div>

                    <!-- RMè¨˜éŒ²è©³ç´°ç”¨ï¼ˆç¨®ç›®é¸æŠï¼‰ -->
                    <div id="rm-detail-selector" class="mt-6 hidden">
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ç¨®ç›®ã‚’é¸æŠ</label>
                            <select id="exercise-select" class="w-full px-4 py-2 border border-gray-300 rounded-lg" onchange="updateRMDetail()">
                                <option value="bench">ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹</option>
                                <option value="squat">ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ</option>
                                <option value="deadlift">ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">RMå›æ•°ã‚’é¸æŠ</label>
                            <select id="rm-select" class="w-full px-4 py-2 border border-gray-300 rounded-lg" onchange="updateRMDetail()">
                                <option value="1">1RM</option>
                                <option value="3">3RM</option>
                                <option value="5">5RM</option>
                                <option value="10">10RM</option>
                            </select>
                        </div>
                    </div>

                    <!-- åˆ†å‰²æ³•åˆ¥ç”¨ï¼ˆãƒ«ãƒ¼ãƒ†ã‚£ãƒ³é¸æŠï¼‰ -->
                    <div id="routine-selector" class="mt-6 hidden">
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚’é¸æŠ</label>
                            <select id="routine-select" class="w-full px-4 py-2 border border-gray-300 rounded-lg" onchange="updateRoutine()">
                                <option value="chest">èƒ¸ã®æ—¥</option>
                                <option value="back">èƒŒä¸­ã®æ—¥</option>
                                <option value="legs">è„šã®æ—¥</option>
                                <option value="shoulders">è‚©ã®æ—¥</option>
                                <option value="arms">è…•ã®æ—¥</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- v6ã®æ”¹è‰¯ãƒã‚¤ãƒ³ãƒˆ -->
        <div class="bg-white rounded-lg shadow-md p-4 mt-6">
            <h3 class="font-bold text-lg mb-3 text-gray-800">âœ… v6ã®æ”¹è‰¯ãƒã‚¤ãƒ³ãƒˆ</h3>
            <ul class="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li><strong>é …ç›®ã”ã¨ã«é©åˆ‡ãªãƒ¬ãƒ³ã‚¸</strong>: RMè¨˜éŒ²ã¯800kgã€ã‚«ãƒ­ãƒªãƒ¼ã¯1500-3500kcalã€LBMã¯40-80kgãªã©</li>
                <li><strong>åˆå›è¨˜éŒ²ã‚’åŸºæº–è»¸ã¨ã—ã¦ä¿å­˜</strong>: ãƒ‡ãƒ¼ã‚¿ã®æœ€å°å€¤ãƒ»æœ€å¤§å€¤ã‹ã‚‰è‡ªå‹•è¨ˆç®—ã—ã€åˆå›è¨­å®šã‚’è¨˜æ†¶</li>
                <li><strong>è»¸ã®ä»»æ„å¤‰æ›´</strong>: Yè»¸ã®æœ€å°å€¤ãƒ»æœ€å¤§å€¤ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè‡ªç”±ã«å¤‰æ›´å¯èƒ½</li>
                <li><strong>åˆæœŸå€¤ãƒªã‚»ãƒƒãƒˆ</strong>: ãƒœã‚¿ãƒ³1ã¤ã§åˆå›è¨˜éŒ²æ™‚ã®ãƒ¬ãƒ³ã‚¸ã«æˆ»ã›ã‚‹</li>
            </ul>
        </div>
    </div>

    <script>
        // Lucideã‚¢ã‚¤ã‚³ãƒ³åˆæœŸåŒ–
        lucide.createIcons();

        let currentMainCategory = 'performance';
        let currentSubCategory = {
            nutrition: 'calories',
            training: 'habit',
            condition: 'total',
            performance: 'lbm'
        };
        let mainChart = null;
        let currentAxisRange = { min: null, max: null };
        let initialAxisRange = {}; // åˆå›è¨˜éŒ²æ™‚ã®ãƒ¬ãƒ³ã‚¸ã‚’ä¿å­˜

        // å„æŒ‡æ¨™ã®é©åˆ‡ãªãƒ¬ãƒ³ã‚¸è¨­å®š
        const defaultRanges = {
            // æ „é¤Š
            'nutrition-calories': { min: 1500, max: 3500 },
            'nutrition-protein': { min: 0, max: 250 },
            'nutrition-fat': { min: 0, max: 150 },
            'nutrition-carbs': { min: 0, max: 500 },
            'nutrition-fiber': { min: 0, max: 50 },
            'nutrition-vitamin': { min: 0, max: 100 },
            'nutrition-mineral': { min: 0, max: 100 },
            // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°
            'training-habit': { min: 0, max: 1 },
            'training-big3': { min: 0, max: 500 },
            'training-routine': { min: 0, max: 300 },
            // ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³
            'condition-total': { min: 0, max: 30 },
            'condition-sleep': { min: 0, max: 10 },
            'condition-appetite': { min: 0, max: 10 },
            'condition-focus': { min: 0, max: 10 },
            // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
            'performance-lbm': { min: 40, max: 80 },
            'performance-directive': { min: 0, max: 100 },
            'performance-overall': { min: 0, max: 100 },
            'performance-rm_detail': { min: 0, max: 800 } // RMè¨˜éŒ²ã®ã¿800kg
        };

        // ãƒ‡ãƒ¼ã‚¿å®šç¾©
        const chartData = {
            nutrition: {
                calories: {
                    values: [2400, 2450, 2500, 2420, 2380, 2460, 2480],
                    label: 'ğŸ”¥ ã‚«ãƒ­ãƒªãƒ¼',
                    unit: 'kcal',
                    color: 'rgb(59, 130, 246)',
                    target: 'ç›®æ¨™: 2,500kcal (98%)'
                },
                protein: {
                    values: [145, 150, 155, 148, 142, 152, 150],
                    label: 'ğŸ¥© ã‚¿ãƒ³ãƒ‘ã‚¯è³ª',
                    unit: 'g',
                    color: 'rgb(6, 182, 212)',
                    target: 'ç›®æ¨™: 160g (94%)'
                },
                fat: {
                    values: [60, 65, 68, 63, 62, 64, 65],
                    label: 'ğŸ§ˆ è„‚è³ª',
                    unit: 'g',
                    color: 'rgb(245, 158, 11)',
                    target: 'ç›®æ¨™: 70g (93%)'
                },
                carbs: {
                    values: [280, 285, 290, 280, 275, 290, 295],
                    label: 'ğŸš ç³–è³ª',
                    unit: 'g',
                    color: 'rgb(34, 197, 94)',
                    target: 'ç›®æ¨™: 300g (98%)'
                },
                fiber: {
                    values: [23, 24, 25, 25, 24, 24, 25],
                    label: 'ğŸ¥¬ é£Ÿç‰©ç¹Šç¶­',
                    unit: 'g',
                    color: 'rgb(132, 204, 22)',
                    target: 'ç›®æ¨™: 30g (83%)'
                },
                vitamin: {
                    values: [75, 76, 78, 79, 78, 77, 78],
                    label: 'ğŸ’Š ãƒ“ã‚¿ãƒŸãƒ³ç·åˆé”æˆç‡',
                    unit: '%',
                    color: 'rgb(168, 85, 247)',
                    target: 'ç›®æ¨™: 100%'
                },
                mineral: {
                    values: [80, 81, 82, 83, 82, 81, 82],
                    label: 'âš¡ ãƒŸãƒãƒ©ãƒ«ç·åˆé”æˆç‡',
                    unit: '%',
                    color: 'rgb(249, 115, 22)',
                    target: 'ç›®æ¨™: 100%'
                }
            },
            training: {
                habit: {
                    values: [1, 1, 0, 1, 1, 1, 1],
                    label: 'ğŸ“ˆ é‹å‹•ç¿’æ…£ç‡',
                    unit: '',
                    color: 'rgb(34, 197, 94)',
                    target: 'é€±6æ—¥å®Ÿæ–½ (85%)',
                    isHabit: true
                },
                big3: {
                    values: [350, 355, 360, 365, 368, 370, 370],
                    label: 'ğŸ‹ï¸ BIG3åˆè¨ˆï¼ˆ1RMï¼‰',
                    unit: 'kg',
                    color: 'rgb(239, 68, 68)',
                    target: 'ç›®æ¨™: 400kg',
                    period: 'éå»7æ—¥é–“ã®æ¨ç§»'
                },
                routine: {
                    isRoutine: true,
                    label: 'ğŸ“‹ åˆ†å‰²æ³•åˆ¥ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°é‡',
                    period: 'éå»7æ—¥é–“ã®å®Ÿæ–½è¨˜éŒ²'
                }
            },
            condition: {
                total: {
                    values: [22, 24, 26, 24, 23, 25, 24],
                    label: 'ğŸ¯ ç·åˆã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã‚¹ã‚³ã‚¢',
                    unit: 'ç‚¹',
                    color: 'rgb(59, 130, 246)',
                    target: '/ 30ç‚¹'
                },
                sleep: {
                    values: [7, 8, 9, 8, 7, 8, 8],
                    label: 'ğŸ˜´ ç¡çœ ã®è³ª',
                    unit: 'ç‚¹',
                    color: 'rgb(59, 130, 246)',
                    target: '/ 10ç‚¹'
                },
                appetite: {
                    values: [7, 8, 8, 8, 7, 8, 8],
                    label: 'ğŸ½ï¸ é£Ÿæ¬²',
                    unit: 'ç‚¹',
                    color: 'rgb(34, 197, 94)',
                    target: '/ 10ç‚¹'
                },
                focus: {
                    values: [8, 8, 9, 8, 9, 9, 8],
                    label: 'ğŸ§  é›†ä¸­åŠ›',
                    unit: 'ç‚¹',
                    color: 'rgb(168, 85, 247)',
                    target: '/ 10ç‚¹'
                }
            },
            performance: {
                lbm: {
                    values: [61.0, 61.2, 61.5, 61.8, 62.0, 62.2, 62.5],
                    label: 'ğŸ’ª LBMï¼ˆé™¤è„‚è‚ªä½“é‡ï¼‰',
                    unit: 'kg',
                    color: 'rgb(168, 85, 247)',
                    target: 'ç›®æ¨™: 65kg',
                    period: 'éå»7æ—¥é–“ã®æ¨ç§»'
                },
                directive: {
                    values: [80, 85, 90, 85, 88, 92, 95],
                    label: 'ğŸ“‹ æŒ‡ç¤ºæ›¸é”æˆç‡',
                    unit: '%',
                    color: 'rgb(34, 197, 94)',
                    target: 'ç›®æ¨™: 100%',
                    period: 'éå»7æ—¥é–“ã®é”æˆç‡'
                },
                overall: {
                    values: [85, 87, 90, 88, 90, 91, 92],
                    label: 'ğŸ¯ ç·åˆåˆ†æã‚¹ã‚³ã‚¢',
                    unit: 'ç‚¹',
                    color: 'rgb(59, 130, 246)',
                    target: '/ 100ç‚¹',
                    period: 'éå»7æ—¥é–“ã®æ¨ç§»'
                },
                rm_detail: {
                    isRMDetail: true,
                    label: 'ğŸ‹ï¸ RMè¨˜éŒ²è©³ç´°ï¼ˆç¨®ç›®åˆ¥ãƒ»RMåˆ¥ï¼‰',
                    period: 'éå»4é€±é–“ã®æ¨ç§»'
                }
            }
        };

        // RMè©³ç´°ãƒ‡ãƒ¼ã‚¿ï¼ˆç¨®ç›®åˆ¥Ã—RMåˆ¥ï¼‰
        const rmDetailData = {
            bench: {
                '1': { values: [95, 97, 98, 100], latest: 100, change: +2 },
                '3': { values: [88, 90, 91, 93], latest: 93, change: +2 },
                '5': { values: [82, 83, 85, 85], latest: 85, change: 0 },
                '10': { values: [70, 71, 72, 73], latest: 73, change: +1 }
            },
            squat: {
                '1': { values: [135, 138, 140, 140], latest: 140, change: 0 },
                '3': { values: [125, 127, 128, 130], latest: 130, change: +2 },
                '5': { values: [115, 117, 118, 120], latest: 120, change: +2 },
                '10': { values: [95, 96, 98, 100], latest: 100, change: +2 }
            },
            deadlift: {
                '1': { values: [170, 173, 175, 180], latest: 180, change: +5 },
                '3': { values: [155, 158, 160, 165], latest: 165, change: +5 },
                '5': { values: [140, 143, 145, 150], latest: 150, change: +5 },
                '10': { values: [120, 122, 125, 128], latest: 128, change: +3 }
            }
        };

        // ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³åˆ¥ãƒ‡ãƒ¼ã‚¿
        const routineData = {
            chest: { values: [120, 125, 130, 135, 140, 145, 150], label: 'èƒ¸ã®æ—¥', unit: 'kg' },
            back: { values: [150, 155, 160, 165, 170, 175, 180], label: 'èƒŒä¸­ã®æ—¥', unit: 'kg' },
            legs: { values: [200, 205, 210, 215, 220, 225, 230], label: 'è„šã®æ—¥', unit: 'kg' },
            shoulders: { values: [80, 82, 85, 87, 90, 92, 95], label: 'è‚©ã®æ—¥', unit: 'kg' },
            arms: { values: [60, 62, 65, 67, 70, 72, 75], label: 'è…•ã®æ—¥', unit: 'kg' }
        };

        // åˆå›è¨˜éŒ²æ™‚ã®ãƒ¬ãƒ³ã‚¸ã‚’è¨ˆç®—ã—ã¦ä¿å­˜
        function calculateInitialRange(category, subCategory, values) {
            const key = `${category}-${subCategory}`;

            if (initialAxisRange[key]) {
                return initialAxisRange[key];
            }

            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¬ãƒ³ã‚¸ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ç”¨
            if (defaultRanges[key]) {
                initialAxisRange[key] = { ...defaultRanges[key] };
                return initialAxisRange[key];
            }

            // ãªã‘ã‚Œã°ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰è‡ªå‹•è¨ˆç®—
            const min = Math.min(...values);
            const max = Math.max(...values);
            const padding = (max - min) * 0.2 || 10;

            initialAxisRange[key] = {
                min: Math.floor(min - padding),
                max: Math.ceil(max + padding)
            };

            return initialAxisRange[key];
        }

        // Yè»¸ãƒ¬ãƒ³ã‚¸ã‚’ãƒªã‚»ãƒƒãƒˆ
        function resetAxisRange() {
            const key = `${currentMainCategory}-${currentSubCategory[currentMainCategory]}`;
            const range = initialAxisRange[key];

            if (range) {
                document.getElementById('axis-min').value = range.min;
                document.getElementById('axis-max').value = range.max;
                updateAxisRange();
            }
        }

        // Yè»¸ãƒ¬ãƒ³ã‚¸ã‚’æ›´æ–°
        function updateAxisRange() {
            const min = parseFloat(document.getElementById('axis-min').value);
            const max = parseFloat(document.getElementById('axis-max').value);

            if (!isNaN(min) && !isNaN(max) && min < max) {
                currentAxisRange = { min, max };

                // ã‚°ãƒ©ãƒ•ã‚’å†æç”»
                if (mainChart) {
                    mainChart.options.scales.y.min = min;
                    mainChart.options.scales.y.max = max;
                    mainChart.update();
                }
            }
        }

        // å¤§ã‚«ãƒ†ã‚´ãƒªé¸æŠ
        function selectMainCategory(category) {
            currentMainCategory = category;

            // å¤§ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'text-green-700', 'text-red-700', 'text-blue-700', 'text-purple-700', 'bg-white', 'border-b-0');
                btn.classList.add('text-gray-600');
            });
            event.currentTarget.classList.add('active', 'bg-white', 'border-b-0');

            if (category === 'nutrition') {
                event.currentTarget.classList.add('text-green-700');
            } else if (category === 'training') {
                event.currentTarget.classList.add('text-red-700');
            } else if (category === 'condition') {
                event.currentTarget.classList.add('text-blue-700');
            } else if (category === 'performance') {
                event.currentTarget.classList.add('text-purple-700');
            }

            // å°ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.sub-tabs').forEach(el => el.classList.add('hidden'));
            document.getElementById(`${category}-subtabs`).classList.remove('hidden');
            document.getElementById(`${category}-subtabs`).classList.add('flex');

            // é¸æŠä¸­ã®å°ã‚«ãƒ†ã‚´ãƒªã‚’è¡¨ç¤º
            updateChart(category, currentSubCategory[category]);
        }

        // å°ã‚«ãƒ†ã‚´ãƒªé¸æŠ
        function selectSubCategory(category, subCategory) {
            currentSubCategory[category] = subCategory;

            // å°ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            const subtabContainer = document.getElementById(`${category}-subtabs`);
            subtabContainer.querySelectorAll('.sub-tab-button').forEach(btn => {
                btn.classList.remove('active', 'border-green-500', 'border-red-500', 'border-blue-500', 'border-purple-500', 'text-green-700', 'text-red-700', 'text-blue-700', 'text-purple-700');
                btn.classList.add('border-transparent', 'text-gray-700');
            });

            event.currentTarget.classList.add('active');
            event.currentTarget.classList.remove('border-transparent', 'text-gray-700');

            if (category === 'nutrition') {
                event.currentTarget.classList.add('border-green-500', 'text-green-700');
            } else if (category === 'training') {
                event.currentTarget.classList.add('border-red-500', 'text-red-700');
            } else if (category === 'condition') {
                event.currentTarget.classList.add('border-blue-500', 'text-blue-700');
            } else if (category === 'performance') {
                event.currentTarget.classList.add('border-purple-500', 'text-purple-700');
            }

            updateChart(category, subCategory);
        }

        // ã‚°ãƒ©ãƒ•æ›´æ–°
        function updateChart(category, subCategory) {
            const data = chartData[category][subCategory];

            // ã™ã¹ã¦ã®ç‰¹åˆ¥è¡¨ç¤ºã‚’éè¡¨ç¤º
            document.getElementById('habit-calendar').classList.add('hidden');
            document.getElementById('rm-detail-selector').classList.add('hidden');
            document.getElementById('routine-selector').classList.add('hidden');
            document.getElementById('stats-container').classList.remove('hidden');
            document.getElementById('range-control').classList.remove('hidden');

            // é‹å‹•ç¿’æ…£ç‡ã®å ´åˆ
            if (data.isHabit) {
                document.getElementById('chart-title').textContent = data.label;
                document.getElementById('chart-period').textContent = 'éå»7æ—¥é–“ã®å®Ÿæ–½çŠ¶æ³';
                document.getElementById('chart-value').textContent = '6';
                document.getElementById('chart-unit').textContent = 'æ—¥å®Ÿæ–½';
                document.getElementById('chart-target').textContent = data.target;
                document.getElementById('stats-container').classList.add('hidden');
                document.getElementById('habit-calendar').classList.remove('hidden');
                document.getElementById('range-control').classList.add('hidden');

                const range = calculateInitialRange(category, subCategory, data.values);
                currentAxisRange = { ...range };
                document.getElementById('axis-min').value = range.min;
                document.getElementById('axis-max').value = range.max;

                if (mainChart) mainChart.destroy();
                mainChart = new Chart(document.getElementById('main-chart'), {
                    type: 'bar',
                    data: {
                        labels: ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ', 'æ—¥'],
                        datasets: [{
                            label: 'é‹å‹•å®Ÿæ–½',
                            data: data.values,
                            backgroundColor: data.values.map(v => v === 1 ? data.color : 'rgb(229, 231, 235)')
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: {
                                beginAtZero: true,
                                min: currentAxisRange.min,
                                max: currentAxisRange.max,
                                ticks: {
                                    stepSize: 1,
                                    callback: (val) => val === 1 ? 'å®Ÿæ–½' : 'æœªå®Ÿæ–½'
                                }
                            }
                        }
                    }
                });
                return;
            }

            // RMè©³ç´°ã®å ´åˆ
            if (data.isRMDetail) {
                document.getElementById('chart-title').textContent = data.label;
                document.getElementById('chart-period').textContent = data.period;
                document.getElementById('chart-value').textContent = '';
                document.getElementById('chart-unit').textContent = '';
                document.getElementById('chart-target').textContent = '';
                document.getElementById('stats-container').classList.add('hidden');
                document.getElementById('rm-detail-selector').classList.remove('hidden');
                updateRMDetail();
                return;
            }

            // ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³åˆ¥ã®å ´åˆ
            if (data.isRoutine) {
                document.getElementById('chart-title').textContent = data.label;
                document.getElementById('chart-period').textContent = data.period;
                document.getElementById('chart-value').textContent = '';
                document.getElementById('chart-unit').textContent = '';
                document.getElementById('chart-target').textContent = '';
                document.getElementById('stats-container').classList.add('hidden');
                document.getElementById('routine-selector').classList.remove('hidden');
                updateRoutine();
                return;
            }

            // é€šå¸¸ã®æŒ‡æ¨™
            document.getElementById('chart-title').textContent = data.label;
            document.getElementById('chart-period').textContent = data.period || 'éå»7æ—¥é–“ã®æ¨ç§»';
            document.getElementById('chart-value').textContent = data.values[data.values.length - 1];
            document.getElementById('chart-unit').textContent = data.unit;
            document.getElementById('chart-target').textContent = data.target;

            // çµ±è¨ˆè¨ˆç®—
            const avg = (data.values.reduce((a, b) => a + b, 0) / data.values.length).toFixed(data.unit === '%' ? 1 : 1);
            const max = Math.max(...data.values);
            const min = Math.min(...data.values);

            document.getElementById('stat-avg').textContent = avg;
            document.getElementById('stat-max').textContent = max;
            document.getElementById('stat-min').textContent = min;

            // çµ±è¨ˆã®å˜ä½ã‚‚æ›´æ–°
            document.getElementById('stat-avg-unit').textContent = data.unit;
            document.getElementById('stat-max-unit').textContent = data.unit;
            document.getElementById('stat-min-unit').textContent = data.unit;

            // Yè»¸ãƒ¬ãƒ³ã‚¸ã‚’è¨­å®š
            const range = calculateInitialRange(category, subCategory, data.values);
            currentAxisRange = { ...range };
            document.getElementById('axis-min').value = range.min;
            document.getElementById('axis-max').value = range.max;

            // ã‚°ãƒ©ãƒ•æç”»
            if (mainChart) mainChart.destroy();

            const labels = ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ', 'æ—¥'];

            mainChart = new Chart(document.getElementById('main-chart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: data.label,
                        data: data.values,
                        borderColor: data.color,
                        backgroundColor: data.color.replace('rgb', 'rgba').replace(')', ', 0.1)'),
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: currentAxisRange.min,
                            max: currentAxisRange.max
                        }
                    }
                }
            });
        }

        // RMè©³ç´°æ›´æ–°
        function updateRMDetail() {
            const exercise = document.getElementById('exercise-select').value;
            const rm = document.getElementById('rm-select').value;
            const data = rmDetailData[exercise][rm];

            const exerciseNames = {
                bench: 'ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹',
                squat: 'ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ',
                deadlift: 'ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ'
            };

            document.getElementById('chart-value').textContent = data.latest;
            document.getElementById('chart-unit').textContent = 'kg';
            document.getElementById('chart-target').textContent = `${rm}RM | ${data.change > 0 ? 'â†‘' : data.change < 0 ? 'â†“' : ''} ${data.change > 0 ? '+' : ''}${data.change}kg`;

            // RMè¨˜éŒ²å°‚ç”¨ã®ãƒ¬ãƒ³ã‚¸ï¼ˆ800kgï¼‰
            const range = { min: 0, max: 800 };
            currentAxisRange = { ...range };
            document.getElementById('axis-min').value = range.min;
            document.getElementById('axis-max').value = range.max;

            if (mainChart) mainChart.destroy();

            mainChart = new Chart(document.getElementById('main-chart'), {
                type: 'line',
                data: {
                    labels: ['ç¬¬1é€±', 'ç¬¬2é€±', 'ç¬¬3é€±', 'ç¬¬4é€±'],
                    datasets: [{
                        label: `${exerciseNames[exercise]} ${rm}RM`,
                        data: data.values,
                        borderColor: 'rgb(168, 85, 247)',
                        backgroundColor: 'rgba(168, 85, 247, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            min: currentAxisRange.min,
                            max: currentAxisRange.max
                        }
                    }
                }
            });
        }

        // ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³æ›´æ–°
        function updateRoutine() {
            const routine = document.getElementById('routine-select').value;
            const data = routineData[routine];

            document.getElementById('chart-value').textContent = data.values[data.values.length - 1];
            document.getElementById('chart-unit').textContent = data.unit;
            document.getElementById('chart-target').textContent = `${data.label}ã®ç·é‡é‡`;

            // ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ç”¨ã®ãƒ¬ãƒ³ã‚¸
            const range = calculateInitialRange('training', 'routine', data.values);
            currentAxisRange = { ...range };
            document.getElementById('axis-min').value = range.min;
            document.getElementById('axis-max').value = range.max;

            if (mainChart) mainChart.destroy();

            mainChart = new Chart(document.getElementById('main-chart'), {
                type: 'line',
                data: {
                    labels: ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ', 'æ—¥'],
                    datasets: [{
                        label: data.label,
                        data: data.values,
                        borderColor: 'rgb(239, 68, 68)',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: currentAxisRange.min,
                            max: currentAxisRange.max
                        }
                    }
                }
            });
        }

        // åˆæœŸè¡¨ç¤º
        updateChart('performance', 'lbm');
    </script>
</body>
</html>