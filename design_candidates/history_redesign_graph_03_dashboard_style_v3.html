<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>履歴改修案（グラフ式）3: ダッシュボードスタイル型 v3（推奨）</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .tab-button {
            transition: all 0.3s ease;
            position: relative;
        }
        .tab-button.active {
            font-weight: 600;
        }
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: currentColor;
        }
        .sub-tab-button {
            transition: all 0.2s ease;
        }
        .sub-tab-button.active {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .chart-container {
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-2xl font-bold mb-2 text-gray-800">📊 履歴改修案（グラフ式）3: ダッシュボードスタイル型 v3</h1>
        <div class="bg-yellow-100 border-l-4 border-yellow-500 p-3 mb-6">
            <p class="text-sm font-semibold text-yellow-800">⭐ 推奨案（最終版）</p>
            <p class="text-xs text-yellow-700">大カテゴリ・小カテゴリともにタブ式。大カテゴリ切り替えで小カテゴリも自動更新</p>
        </div>

        <!-- メインコンテナ -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <!-- 大カテゴリタブ -->
            <div class="flex border-b bg-gray-50">
                <button
                    class="tab-button flex-1 py-4 px-6 text-center transition active text-green-700 bg-white border-b-0"
                    onclick="selectMainCategory('nutrition')">
                    <div class="flex items-center justify-center gap-2">
                        <span class="text-xl">📊</span>
                        <div>
                            <div class="text-sm font-semibold">栄養・食事</div>
                            <div class="text-xs opacity-75">85点</div>
                        </div>
                    </div>
                </button>
                <button
                    class="tab-button flex-1 py-4 px-6 text-center transition text-gray-600"
                    onclick="selectMainCategory('training')">
                    <div class="flex items-center justify-center gap-2">
                        <span class="text-xl">💪</span>
                        <div>
                            <div class="text-sm font-semibold">トレーニング</div>
                            <div class="text-xs opacity-75">88点</div>
                        </div>
                    </div>
                </button>
                <button
                    class="tab-button flex-1 py-4 px-6 text-center transition text-gray-600"
                    onclick="selectMainCategory('condition')">
                    <div class="flex items-center justify-center gap-2">
                        <span class="text-xl">🧘</span>
                        <div>
                            <div class="text-sm font-semibold">コンディション</div>
                            <div class="text-xs opacity-75">24/30点</div>
                        </div>
                    </div>
                </button>
            </div>

            <!-- 小カテゴリタブ（栄養・食事） -->
            <div id="nutrition-subtabs" class="sub-tabs flex flex-wrap gap-2 p-4 bg-green-50 border-b">
                <button class="sub-tab-button active px-4 py-2 bg-white text-green-700 rounded-lg text-sm font-semibold border-2 border-green-500" onclick="selectSubCategory('nutrition', 'calories')">
                    🔥 カロリー
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('nutrition', 'protein')">
                    🥩 タンパク質
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('nutrition', 'fat')">
                    🧈 脂質
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('nutrition', 'carbs')">
                    🍚 糖質
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('nutrition', 'fiber')">
                    🥬 食物繊維
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('nutrition', 'vitamin')">
                    💊 ビタミン
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('nutrition', 'mineral')">
                    ⚡ ミネラル
                </button>
            </div>

            <!-- 小カテゴリタブ（トレーニング） -->
            <div id="training-subtabs" class="sub-tabs hidden flex-wrap gap-2 p-4 bg-red-50 border-b">
                <button class="sub-tab-button active px-4 py-2 bg-white text-red-700 rounded-lg text-sm font-semibold border-2 border-red-500" onclick="selectSubCategory('training', 'rm')">
                    🏋️ RM記録
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('training', 'habit')">
                    📈 運動習慣率
                </button>
            </div>

            <!-- 小カテゴリタブ（コンディション） -->
            <div id="condition-subtabs" class="sub-tabs hidden flex-wrap gap-2 p-4 bg-blue-50 border-b">
                <button class="sub-tab-button active px-4 py-2 bg-white text-blue-700 rounded-lg text-sm font-semibold border-2 border-blue-500" onclick="selectSubCategory('condition', 'total')">
                    🎯 総合スコア
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('condition', 'sleep')">
                    😴 睡眠の質
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('condition', 'appetite')">
                    🍽️ 食欲
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('condition', 'focus')">
                    🧠 集中力
                </button>
            </div>

            <!-- 詳細グラフ表示エリア -->
            <div class="p-6">
                <div id="chart-display" class="chart-container">
                    <!-- ヘッダー -->
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 id="chart-title" class="text-3xl font-bold text-gray-800">🔥 カロリー</h3>
                            <p class="text-sm text-gray-500 mt-1">過去7日間の推移</p>
                        </div>
                        <div class="text-right">
                            <div id="chart-value" class="text-5xl font-bold text-blue-600">2,450</div>
                            <div id="chart-unit" class="text-sm text-gray-500 mt-1">kcal</div>
                            <div id="chart-target" class="text-sm font-semibold text-green-600 mt-2">目標: 2,500kcal (98%)</div>
                        </div>
                    </div>

                    <!-- グラフ -->
                    <canvas id="main-chart" height="100"></canvas>

                    <!-- 統計情報 -->
                    <div id="stats-container" class="mt-6 grid grid-cols-3 gap-4 text-center">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <div class="text-xs text-gray-600 mb-1">平均</div>
                            <div id="stat-avg" class="text-2xl font-bold text-blue-600">2,420</div>
                            <div class="text-xs text-gray-500">kcal</div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <div class="text-xs text-gray-600 mb-1">最高</div>
                            <div id="stat-max" class="text-2xl font-bold text-green-600">2,500</div>
                            <div class="text-xs text-gray-500">kcal</div>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <div class="text-xs text-gray-600 mb-1">最低</div>
                            <div id="stat-min" class="text-2xl font-bold text-orange-600">2,380</div>
                            <div class="text-xs text-gray-500">kcal</div>
                        </div>
                    </div>

                    <!-- RM記録用の追加情報 -->
                    <div id="rm-info" class="mt-6 grid grid-cols-3 gap-4 hidden">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <div class="text-xs text-gray-600 mb-1">ベンチプレス 1RM</div>
                            <div class="text-2xl font-bold text-blue-600">100kg</div>
                            <div class="text-sm text-green-600 font-semibold">↑ +2kg</div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <div class="text-xs text-gray-600 mb-1">スクワット 5RM</div>
                            <div class="text-2xl font-bold text-purple-600">120kg</div>
                            <div class="text-sm text-gray-400">-</div>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <div class="text-xs text-gray-600 mb-1">デッドリフト 3RM</div>
                            <div class="text-2xl font-bold text-orange-600">150kg</div>
                            <div class="text-sm text-green-600 font-semibold">↑ +5kg</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- メリット・デメリット -->
        <div class="bg-white rounded-lg shadow-md p-4 mt-6">
            <h3 class="font-bold text-lg mb-3 text-gray-800">✅ メリット（v3最終版）</h3>
            <ul class="list-disc pl-5 space-y-1 text-sm text-gray-700 mb-4">
                <li><strong>タブ式で直感的</strong>: 大カテゴリ・小カテゴリともにタブで切り替え</li>
                <li><strong>自動連動</strong>: 大カテゴリを選ぶと小カテゴリが自動で切り替わる</li>
                <li><strong>1画面完結</strong>: スクロール不要で全ての情報を表示</li>
                <li><strong>見やすさ重視</strong>: 選択した指標だけを大きく表示</li>
                <li><strong>統計情報付き</strong>: 平均・最高・最低を自動計算</li>
            </ul>
            <h3 class="font-bold text-lg mb-3 text-gray-800">⚠️ デメリット</h3>
            <ul class="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li>複数の小カテゴリを同時に比較できない（タブ切り替えが必要）</li>
            </ul>
        </div>

        <div class="bg-green-50 border-l-4 border-green-500 p-4 mt-6">
            <h3 class="font-bold text-green-800 mb-2">🎯 v3の改良ポイント</h3>
            <ol class="list-decimal pl-5 space-y-1 text-sm text-green-900">
                <li><strong>大カテゴリもタブ化</strong>: カード形式からタブ形式に変更</li>
                <li><strong>自動連動</strong>: 大カテゴリを選ぶと小カテゴリタブが自動切り替え</li>
                <li><strong>1画面完結</strong>: ヘッダー固定でスクロール不要</li>
                <li><strong>アクティブ表示</strong>: 選択中のタブが視覚的にわかりやすい</li>
                <li><strong>レスポンシブ</strong>: モバイルでも快適に操作可能</li>
            </ol>
        </div>
    </div>

    <script>
        let currentMainCategory = 'nutrition';
        let currentSubCategory = { nutrition: 'calories', training: 'rm', condition: 'total' };
        let mainChart = null;

        // データ定義
        const chartData = {
            nutrition: {
                calories: {
                    values: [2400, 2450, 2500, 2420, 2380, 2460, 2480],
                    label: '🔥 カロリー',
                    unit: 'kcal',
                    color: 'rgb(59, 130, 246)',
                    target: '目標: 2,500kcal (98%)'
                },
                protein: {
                    values: [145, 150, 155, 148, 142, 152, 150],
                    label: '🥩 タンパク質',
                    unit: 'g',
                    color: 'rgb(6, 182, 212)',
                    target: '目標: 160g (94%)'
                },
                fat: {
                    values: [60, 65, 68, 63, 62, 64, 65],
                    label: '🧈 脂質',
                    unit: 'g',
                    color: 'rgb(245, 158, 11)',
                    target: '目標: 70g (93%)'
                },
                carbs: {
                    values: [280, 285, 290, 280, 275, 290, 295],
                    label: '🍚 糖質',
                    unit: 'g',
                    color: 'rgb(34, 197, 94)',
                    target: '目標: 300g (98%)'
                },
                fiber: {
                    values: [23, 24, 25, 25, 24, 24, 25],
                    label: '🥬 食物繊維',
                    unit: 'g',
                    color: 'rgb(132, 204, 22)',
                    target: '目標: 30g (83%)'
                },
                vitamin: {
                    values: [75, 76, 78, 79, 78, 77, 78],
                    label: '💊 ビタミン総合達成率',
                    unit: '%',
                    color: 'rgb(168, 85, 247)',
                    target: '目標: 100%'
                },
                mineral: {
                    values: [80, 81, 82, 83, 82, 81, 82],
                    label: '⚡ ミネラル総合達成率',
                    unit: '%',
                    color: 'rgb(249, 115, 22)',
                    target: '目標: 100%'
                }
            },
            training: {
                rm: {
                    multiLine: true,
                    datasets: [
                        { label: 'ベンチプレス 1RM', data: [95, 97, 98, 100], color: 'rgb(59, 130, 246)' },
                        { label: 'スクワット 5RM', data: [115, 117, 118, 120], color: 'rgb(168, 85, 247)' },
                        { label: 'デッドリフト 3RM', data: [140, 143, 145, 150], color: 'rgb(249, 115, 22)' }
                    ],
                    labels: ['第1週', '第2週', '第3週', '第4週'],
                    title: '🏋️ RM記録推移',
                    period: '過去4週間'
                },
                habit: {
                    values: [1, 1, 0, 1, 1, 1, 1],
                    label: '📈 運動習慣率',
                    unit: '',
                    color: 'rgb(34, 197, 94)',
                    target: '週6日実施 (85%)',
                    isBar: true
                }
            },
            condition: {
                total: {
                    values: [22, 24, 26, 24, 23, 25, 24],
                    label: '🎯 総合コンディションスコア',
                    unit: '点',
                    color: 'rgb(59, 130, 246)',
                    target: '/ 30点'
                },
                sleep: {
                    values: [7, 8, 9, 8, 7, 8, 8],
                    label: '😴 睡眠の質',
                    unit: '点',
                    color: 'rgb(59, 130, 246)',
                    target: '/ 10点'
                },
                appetite: {
                    values: [7, 8, 8, 8, 7, 8, 8],
                    label: '🍽️ 食欲',
                    unit: '点',
                    color: 'rgb(34, 197, 94)',
                    target: '/ 10点'
                },
                focus: {
                    values: [8, 8, 9, 8, 9, 9, 8],
                    label: '🧠 集中力',
                    unit: '点',
                    color: 'rgb(168, 85, 247)',
                    target: '/ 10点'
                }
            }
        };

        // 大カテゴリ選択
        function selectMainCategory(category) {
            currentMainCategory = category;

            // 大カテゴリタブのアクティブ状態を更新
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'text-green-700', 'text-red-700', 'text-blue-700', 'bg-white', 'border-b-0');
                btn.classList.add('text-gray-600');
            });
            event.currentTarget.classList.add('active', 'bg-white', 'border-b-0');

            if (category === 'nutrition') {
                event.currentTarget.classList.add('text-green-700');
            } else if (category === 'training') {
                event.currentTarget.classList.add('text-red-700');
            } else if (category === 'condition') {
                event.currentTarget.classList.add('text-blue-700');
            }

            // 小カテゴリタブを切り替え
            document.querySelectorAll('.sub-tabs').forEach(el => el.classList.add('hidden'));
            document.getElementById(`${category}-subtabs`).classList.remove('hidden');
            document.getElementById(`${category}-subtabs`).classList.add('flex');

            // 選択中の小カテゴリを表示
            updateChart(category, currentSubCategory[category]);
        }

        // 小カテゴリ選択
        function selectSubCategory(category, subCategory) {
            currentSubCategory[category] = subCategory;

            // 小カテゴリタブのアクティブ状態を更新
            const subtabContainer = document.getElementById(`${category}-subtabs`);
            subtabContainer.querySelectorAll('.sub-tab-button').forEach(btn => {
                btn.classList.remove('active', 'border-green-500', 'border-red-500', 'border-blue-500', 'text-green-700', 'text-red-700', 'text-blue-700');
                btn.classList.add('border-transparent', 'text-gray-700');
            });

            event.currentTarget.classList.add('active');
            event.currentTarget.classList.remove('border-transparent', 'text-gray-700');

            if (category === 'nutrition') {
                event.currentTarget.classList.add('border-green-500', 'text-green-700');
            } else if (category === 'training') {
                event.currentTarget.classList.add('border-red-500', 'text-red-700');
            } else if (category === 'condition') {
                event.currentTarget.classList.add('border-blue-500', 'text-blue-700');
            }

            updateChart(category, subCategory);
        }

        // グラフ更新
        function updateChart(category, subCategory) {
            const data = chartData[category][subCategory];

            // RM記録用の特別表示を非表示
            document.getElementById('rm-info').classList.add('hidden');
            document.getElementById('stats-container').classList.remove('hidden');

            // RM記録の場合
            if (data.multiLine) {
                document.getElementById('chart-title').textContent = data.title;
                document.querySelector('#chart-display .text-sm.text-gray-500').textContent = data.period;
                document.getElementById('chart-value').textContent = '';
                document.getElementById('chart-unit').textContent = '';
                document.getElementById('chart-target').textContent = '';
                document.getElementById('stats-container').classList.add('hidden');
                document.getElementById('rm-info').classList.remove('hidden');

                if (mainChart) mainChart.destroy();
                mainChart = new Chart(document.getElementById('main-chart'), {
                    type: 'line',
                    data: {
                        labels: data.labels,
                        datasets: data.datasets.map(ds => ({
                            label: ds.label,
                            data: ds.data,
                            borderColor: ds.color,
                            backgroundColor: ds.color.replace('rgb', 'rgba').replace(')', ', 0.1)'),
                            tension: 0.4
                        }))
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: { legend: { display: true, position: 'bottom' } }
                    }
                });
                return;
            }

            // 通常の指標
            document.getElementById('chart-title').textContent = data.label;
            document.querySelector('#chart-display .text-sm.text-gray-500').textContent = category === 'training' ? '過去7日間の実施状況' : '過去7日間の推移';
            document.getElementById('chart-value').textContent = data.values[data.values.length - 1];
            document.getElementById('chart-unit').textContent = data.unit;
            document.getElementById('chart-target').textContent = data.target;

            // 統計計算
            const avg = (data.values.reduce((a, b) => a + b, 0) / data.values.length).toFixed(1);
            const max = Math.max(...data.values);
            const min = Math.min(...data.values);

            document.getElementById('stat-avg').textContent = avg;
            document.getElementById('stat-max').textContent = max;
            document.getElementById('stat-min').textContent = min;

            // グラフ描画
            if (mainChart) mainChart.destroy();

            const chartType = data.isBar ? 'bar' : 'line';
            const labels = ['月', '火', '水', '木', '金', '土', '日'];

            mainChart = new Chart(document.getElementById('main-chart'), {
                type: chartType,
                data: {
                    labels: labels,
                    datasets: [{
                        label: data.label,
                        data: data.values,
                        borderColor: data.color,
                        backgroundColor: data.isBar
                            ? data.values.map(v => v === 1 ? data.color : 'rgb(229, 231, 235)')
                            : data.color.replace('rgb', 'rgba').replace(')', ', 0.1)'),
                        fill: !data.isBar,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: data.isBar ? 1 : undefined
                        }
                    }
                }
            });
        }

        // 初期表示
        updateChart('nutrition', 'calories');
    </script>
</body>
</html>