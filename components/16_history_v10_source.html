<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å±¥æ­´æ”¹ä¿®æ¡ˆï¼ˆã‚°ãƒ©ãƒ•å¼ï¼‰3: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«å‹ v10ï¼ˆå®Œå…¨ç‰ˆï¼‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- ç›®æ¨™ãƒ©ã‚¤ãƒ³ãƒ»ãƒ¡ãƒ¢æ©Ÿèƒ½ -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.2.1"></script>
    <!-- ã‚«ã‚¹ã‚¿ãƒ æœŸé–“é¸æŠ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ja.js"></script>
    <style>
        .tab-button {
            transition: all 0.3s ease;
            position: relative;
        }
        .tab-button.active {
            font-weight: 600;
        }
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: currentColor;
        }
        .sub-tab-button {
            transition: all 0.2s ease;
        }
        .sub-tab-button.active {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .chart-container {
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .day-box {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.75rem;
        }
        .day-box.done {
            background-color: #22c55e;
            color: white;
        }
        .day-box.not-done {
            background-color: #e5e7eb;
            color: #6b7280;
        }
        .range-control {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            padding: 0.75rem;
            margin-top: 1rem;
        }
        .period-button {
            transition: all 0.2s ease;
        }
        .period-button.active {
            background: #3b82f6;
            color: white;
            font-weight: 600;
        }
        .comparison-enabled .chart-section {
            border: 2px solid #3b82f6;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.show {
            display: flex;
        }
        .modal-content {
            background: white;
            border-radius: 1rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .ai-analyzing {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .ai-analyzing .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid #e5e7eb;
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .sync-icon {
            transition: transform 0.3s ease;
        }
        .sync-icon.syncing {
            animation: rotate 1s ease-in-out;
        }
        @keyframes rotate {
            to { transform: rotate(360deg); }
        }
        .info-icon {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .info-icon:hover {
            transform: scale(1.1);
            color: #3b82f6;
        }
        .tooltip {
            display: none;
            position: absolute;
            background: white;
            border: 2px solid #3b82f6;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 100;
            max-width: 400px;
            animation: fadeIn 0.2s ease-out;
        }
        .tooltip.show {
            display: block;
        }
        .help-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        .help-modal.show {
            display: flex;
        }
        .help-content {
            background: white;
            border-radius: 1rem;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease-out;
        }
        .floating-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 320px;
            max-height: calc(100vh - 100px);
            background: white;
            border-radius: 1rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 1500;
            overflow-y: auto;
            animation: slideInRight 0.3s ease-out;
        }
        .floating-panel.hidden {
            display: none;
        }
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        .stats-inline {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            padding: 0.75rem;
            background: linear-gradient(to right, #f3f4f6, #e5e7eb);
            border-radius: 0.5rem;
            font-size: 0.875rem;
            margin-top: 1rem;
        }
        .stats-inline .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .stats-inline .stat-value {
            font-size: 1.25rem;
            font-weight: bold;
        }
        .stats-inline .stat-label {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        .compact-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        .compact-buttons {
            display: flex;
            gap: 0.5rem;
        }
        .compact-buttons button {
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }
    </style>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-6xl mx-auto">
        <div class="flex items-center justify-between mb-2">
            <h1 class="text-2xl font-bold text-gray-800">ğŸ“Š å±¥æ­´æ”¹ä¿®æ¡ˆï¼ˆã‚°ãƒ©ãƒ•å¼ï¼‰3: ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«å‹ v10</h1>
            <div class="flex items-center gap-2">
                <button
                    onclick="openGoalSettingModal()"
                    class="flex items-center gap-2 px-3 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition shadow-md">
                    <i data-lucide="target" class="w-4 h-4"></i>
                    <span class="text-sm font-semibold">ç›®æ¨™è¨­å®š</span>
                </button>
                <button
                    onclick="openHelpModal()"
                    class="flex items-center gap-2 px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition shadow-md">
                    <i data-lucide="help-circle" class="w-4 h-4"></i>
                    <span class="text-sm font-semibold">ä½¿ã„æ–¹</span>
                </button>
            </div>
        </div>
        <div class="bg-yellow-100 border-l-4 border-yellow-500 p-3 mb-6">
            <p class="text-sm font-semibold text-yellow-800">â­ v10 å®Ÿè£…ç‰ˆ</p>
            <p class="text-xs text-yellow-700">å®Ÿè£…æ¸ˆã¿: ç›®æ¨™è¨­å®šãƒ»ãƒ¡ãƒ¢ãƒ»ã‚«ã‚¹ã‚¿ãƒ æœŸé–“é¸æŠ</p>
            <p class="text-xs text-yellow-700 mt-1">ğŸ’¡ ãƒ‡ãƒ¼ã‚¿ä¿å­˜: ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆï¼ˆWin: Win+Shift+S / Mac: Cmd+Shift+4ï¼‰ã‚’æ¨å¥¨</p>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <!-- å¤§ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ– -->
            <div class="flex border-b bg-gray-50">
                <button
                    class="tab-button flex-1 py-4 px-4 text-center transition text-gray-600"
                    onclick="selectMainCategory('nutrition')">
                    <div class="flex items-center justify-center gap-2">
                        <i data-lucide="utensils" class="w-5 h-5"></i>
                        <div>
                            <div class="text-sm font-semibold">é£Ÿäº‹</div>
                            <div class="text-xs opacity-75">85ç‚¹</div>
                        </div>
                    </div>
                </button>
                <button
                    class="tab-button flex-1 py-4 px-4 text-center transition text-gray-600"
                    onclick="selectMainCategory('training')">
                    <div class="flex items-center justify-center gap-2">
                        <i data-lucide="dumbbell" class="w-5 h-5"></i>
                        <div>
                            <div class="text-sm font-semibold">é‹å‹•</div>
                            <div class="text-xs opacity-75">88ç‚¹</div>
                        </div>
                    </div>
                </button>
                <button
                    class="tab-button flex-1 py-4 px-4 text-center transition text-gray-600"
                    onclick="selectMainCategory('condition')">
                    <div class="flex items-center justify-center gap-2">
                        <i data-lucide="activity" class="w-5 h-5"></i>
                        <div>
                            <div class="text-sm font-semibold">ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³</div>
                            <div class="text-xs opacity-75">24/30ç‚¹</div>
                        </div>
                    </div>
                </button>
                <button
                    class="tab-button flex-1 py-4 px-4 text-center transition active text-purple-700 bg-white border-b-0"
                    onclick="selectMainCategory('performance')">
                    <div class="flex items-center justify-center gap-2">
                        <i data-lucide="trending-up" class="w-5 h-5"></i>
                        <div>
                            <div class="text-sm font-semibold">ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</div>
                            <div class="text-xs opacity-75">ç·åˆ92ç‚¹</div>
                        </div>
                    </div>
                </button>
            </div>

            <!-- å°ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ï¼‰ -->
            <div id="performance-subtabs" class="sub-tabs flex flex-wrap gap-2 p-4 bg-purple-50 border-b">
                <button class="sub-tab-button active px-4 py-2 bg-white text-purple-700 rounded-lg text-sm font-semibold border-2 border-purple-500" onclick="selectSubCategory('performance', 'lbm')">
                    ğŸ’ª LBM
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('performance', 'directive')">
                    ğŸ“‹ æŒ‡ç¤ºæ›¸é”æˆçŠ¶æ³
                </button>
                <button class="sub-tab-button px-4 py-2 bg-white text-gray-700 rounded-lg text-sm font-semibold border-2 border-transparent hover:border-gray-300" onclick="selectSubCategory('performance', 'overall')">
                    ğŸ¯ ç·åˆåˆ†æ
                </button>
            </div>

            <!-- è©³ç´°ã‚°ãƒ©ãƒ•è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div class="p-6">
                <!-- ã‚°ãƒ©ãƒ•1ï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰ -->
                <div id="chart-1" class="chart-section mb-6">
                    <!-- ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ -->
                    <div class="compact-header">
                        <div>
                            <h3 id="chart-title-1" class="text-2xl font-bold text-gray-800">ğŸ’ª LBMï¼ˆé™¤è„‚è‚ªä½“é‡ï¼‰</h3>
                            <p id="chart-period-1" class="text-sm text-gray-500 mt-1">éå»7æ—¥é–“ã®æ¨ç§»</p>
                        </div>
                        <div class="compact-buttons">
                            <button onclick="toggleSettingsPanel(1)" class="bg-gray-100 hover:bg-gray-200 text-gray-700 flex items-center gap-1">
                                <i data-lucide="settings" class="w-4 h-4"></i>
                                <span class="hidden sm:inline">è¨­å®š</span>
                            </button>
                            <button onclick="analyzeWithGemini()" class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white flex items-center gap-1">
                                <i data-lucide="sparkles" class="w-4 h-4"></i>
                                <span class="hidden sm:inline">AIåˆ†æ</span>
                            </button>
                        </div>
                    </div>

                    <!-- æœŸé–“é¸æŠ -->
                    <div class="mb-4">
                        <div class="flex flex-wrap gap-2">
                            <button class="period-button active px-3 py-1.5 rounded-lg text-sm border-2 border-purple-500 bg-white font-semibold" onclick="selectPeriod(1, 7)">7æ—¥</button>
                            <button class="period-button px-3 py-1.5 rounded-lg text-sm border-2 border-gray-300 bg-white hover:border-purple-300" onclick="selectPeriod(1, 14)">14æ—¥</button>
                            <button class="period-button px-3 py-1.5 rounded-lg text-sm border-2 border-gray-300 bg-white hover:border-purple-300" onclick="selectPeriod(1, 30)">30æ—¥</button>
                            <button class="period-button px-3 py-1.5 rounded-lg text-sm border-2 border-gray-300 bg-white hover:border-purple-300" onclick="selectPeriodRange(1, 'thisWeek')">ä»Šé€±</button>
                            <button class="period-button px-3 py-1.5 rounded-lg text-sm border-2 border-gray-300 bg-white hover:border-purple-300" onclick="selectPeriodRange(1, 'lastWeek')">å…ˆé€±</button>
                            <button class="period-button px-3 py-1.5 rounded-lg text-sm border-2 border-gray-300 bg-white hover:border-purple-300" onclick="selectPeriodRange(1, 'thisMonth')">ä»Šæœˆ</button>
                            <button class="period-button px-3 py-1.5 rounded-lg text-sm border-2 border-gray-300 bg-white hover:border-purple-300" onclick="selectPeriodRange(1, 'lastMonth')">å…ˆæœˆ</button>
                        </div>
                    </div>

                    <!-- ã‚«ãƒ†ã‚´ãƒªåˆ¥ç¯„å›²è¡¨ç¤º -->
                    <div class="mb-3 p-2 bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg border border-purple-200">
                        <div class="flex items-center justify-between text-xs">
                            <span class="text-gray-600">å…¨æœŸé–“ï¼ˆ90æ—¥ï¼‰ã®ç¯„å›²:</span>
                            <span class="font-semibold text-gray-800">
                                <span class="text-orange-600" id="category-min-1">60.0</span>
                                <span class="text-gray-400 mx-1">ï½</span>
                                <span class="text-green-600" id="category-max-1">63.0</span>
                                <span id="category-unit-1" class="text-gray-500 ml-1">kg</span>
                            </span>
                        </div>
                    </div>

                    <canvas id="main-chart-1" height="100"></canvas>

                    <!-- ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªçµ±è¨ˆæƒ…å ±ï¼ˆ1è¡Œï¼‰ -->
                    <div class="stats-inline">
                        <div class="stat-item">
                            <div class="stat-value text-blue-600" id="stat-avg-1">62.0</div>
                            <div class="stat-label">å¹³å‡ <span id="stat-avg-unit-1">kg</span></div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value text-green-600" id="stat-max-1">62.5</div>
                            <div class="stat-label">æœ€é«˜ <span id="stat-max-unit-1">kg</span></div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value text-orange-600" id="stat-min-1">61.0</div>
                            <div class="stat-label">æœ€ä½ <span id="stat-min-unit-1">kg</span></div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value text-purple-600" id="chart-value-1">62.5</div>
                            <div class="stat-label">ç¾åœ¨ <span id="chart-unit-1">kg</span></div>
                        </div>
                    </div>

                    <!-- æ—§çµ±è¨ˆæƒ…å ±ã‚³ãƒ³ãƒ†ãƒŠï¼ˆéè¡¨ç¤ºç”¨ãƒ»äº’æ›æ€§ç¶­æŒï¼‰ -->
                    <div id="stats-container-1" class="hidden"></div>
                </div>

                <!-- ã‚°ãƒ©ãƒ•2ï¼ˆæ¯”è¼ƒç”¨ï¼‰ -->
                <div id="chart-2" class="chart-section hidden">
                    <div class="border-t-2 border-dashed border-gray-300 pt-6 mt-6">
                        <!-- ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ -->
                        <div class="compact-header">
                            <div>
                                <h3 id="chart-title-2" class="text-2xl font-bold text-gray-800">ğŸ’ª LBMï¼ˆé™¤è„‚è‚ªä½“é‡ï¼‰- æ¯”è¼ƒ</h3>
                                <p id="chart-period-2" class="text-sm text-gray-500 mt-1">éå»30æ—¥é–“ã®æ¨ç§»</p>
                            </div>
                        </div>

                        <!-- æœŸé–“é¸æŠ -->
                        <div class="mb-4">
                            <div class="flex flex-wrap gap-2">
                                <button class="period-button px-3 py-1.5 rounded-lg text-sm border-2 border-gray-300 bg-white hover:border-blue-300" onclick="selectPeriod(2, 7)">7æ—¥</button>
                                <button class="period-button px-3 py-1.5 rounded-lg text-sm border-2 border-gray-300 bg-white hover:border-blue-300" onclick="selectPeriod(2, 14)">14æ—¥</button>
                                <button class="period-button active px-3 py-1.5 rounded-lg text-sm border-2 border-blue-500 bg-white font-semibold" onclick="selectPeriod(2, 30)">30æ—¥</button>
                                <button class="period-button px-3 py-1.5 rounded-lg text-sm border-2 border-gray-300 bg-white hover:border-blue-300" onclick="selectPeriodRange(2, 'thisWeek')">ä»Šé€±</button>
                                <button class="period-button px-3 py-1.5 rounded-lg text-sm border-2 border-gray-300 bg-white hover:border-blue-300" onclick="selectPeriodRange(2, 'lastWeek')">å…ˆé€±</button>
                                <button class="period-button px-3 py-1.5 rounded-lg text-sm border-2 border-gray-300 bg-white hover:border-blue-300" onclick="selectPeriodRange(2, 'thisMonth')">ä»Šæœˆ</button>
                                <button class="period-button px-3 py-1.5 rounded-lg text-sm border-2 border-gray-300 bg-white hover:border-blue-300" onclick="selectPeriodRange(2, 'lastMonth')">å…ˆæœˆ</button>
                            </div>
                        </div>

                        <!-- ã‚«ãƒ†ã‚´ãƒªåˆ¥ç¯„å›²è¡¨ç¤º -->
                        <div class="mb-3 p-2 bg-gradient-to-r from-blue-50 to-cyan-50 rounded-lg border border-blue-200">
                            <div class="flex items-center justify-between text-xs">
                                <span class="text-gray-600">å…¨æœŸé–“ï¼ˆ90æ—¥ï¼‰ã®ç¯„å›²:</span>
                                <span class="font-semibold text-gray-800">
                                    <span class="text-orange-600" id="category-min-2">60.0</span>
                                    <span class="text-gray-400 mx-1">ï½</span>
                                    <span class="text-green-600" id="category-max-2">63.0</span>
                                    <span id="category-unit-2" class="text-gray-500 ml-1">kg</span>
                                </span>
                            </div>
                        </div>

                        <canvas id="main-chart-2" height="100"></canvas>

                        <!-- ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªçµ±è¨ˆæƒ…å ±ï¼ˆ1è¡Œï¼‰ -->
                        <div class="stats-inline">
                            <div class="stat-item">
                                <div class="stat-value text-blue-600" id="stat-avg-2">61.5</div>
                                <div class="stat-label">å¹³å‡ <span id="stat-avg-unit-2">kg</span></div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value text-green-600" id="stat-max-2">62.5</div>
                                <div class="stat-label">æœ€é«˜ <span id="stat-max-unit-2">kg</span></div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value text-orange-600" id="stat-min-2">60.0</div>
                                <div class="stat-label">æœ€ä½ <span id="stat-min-unit-2">kg</span></div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value text-purple-600" id="chart-value-2">62.5</div>
                                <div class="stat-label">ç¾åœ¨ <span id="chart-unit-2">kg</span></div>
                            </div>
                        </div>

                        <!-- æ—§çµ±è¨ˆæƒ…å ±ã‚³ãƒ³ãƒ†ãƒŠï¼ˆéè¡¨ç¤ºç”¨ãƒ»äº’æ›æ€§ç¶­æŒï¼‰ -->
                        <div id="stats-container-2" class="hidden"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AIåˆ†æçµæœãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="ai-analysis-modal" class="modal">
            <div class="modal-content">
                <div class="sticky top-0 bg-gradient-to-r from-purple-600 to-blue-600 text-white p-4 rounded-t-lg">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-2">
                            <i data-lucide="sparkles" class="w-5 h-5"></i>
                            <h3 class="text-lg font-bold">AI ã‚°ãƒ©ãƒ•åˆ†æ</h3>
                        </div>
                        <button onclick="closeAnalysisModal()" class="p-1 hover:bg-white/20 rounded">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
                <div id="analysis-content" class="p-6">
                    <div class="ai-analyzing">
                        <div class="spinner"></div>
                        <span class="text-gray-600">åˆ†æä¸­...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒ˜ãƒ«ãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="help-modal" class="help-modal">
            <div class="help-content">
                <div class="sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 text-white p-4 rounded-t-lg">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-2">
                            <i data-lucide="help-circle" class="w-5 h-5"></i>
                            <h3 class="text-lg font-bold">å±¥æ­´ã‚°ãƒ©ãƒ•ã®ä½¿ã„æ–¹</h3>
                        </div>
                        <button onclick="closeHelpModal()" class="p-1 hover:bg-white/20 rounded">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <div class="space-y-6">
                        <!-- åŸºæœ¬æ“ä½œ -->
                        <div>
                            <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                                <i data-lucide="mouse-pointer-click" class="w-5 h-5 text-blue-600"></i>
                                åŸºæœ¬æ“ä½œ
                            </h4>
                            <ul class="space-y-2 text-sm text-gray-700">
                                <li class="flex items-start gap-2">
                                    <span class="text-blue-600 font-bold">1.</span>
                                    <span><strong>ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–</strong>: é£Ÿäº‹ãƒ»é‹å‹•ãƒ»ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’åˆ‡ã‚Šæ›¿ãˆ</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-blue-600 font-bold">2.</span>
                                    <span><strong>ã‚µãƒ–ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–</strong>: å„ã‚«ãƒ†ã‚´ãƒªå†…ã®è©³ç´°æŒ‡æ¨™ã‚’é¸æŠ</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-blue-600 font-bold">3.</span>
                                    <span><strong>æœŸé–“ãƒœã‚¿ãƒ³</strong>: 7æ—¥é–“/14æ—¥é–“/30æ—¥é–“/90æ—¥é–“ã‹ã‚‰è¡¨ç¤ºæœŸé–“ã‚’é¸æŠ</span>
                                </li>
                            </ul>
                        </div>

                        <!-- æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰ -->
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                                <i data-lucide="columns-2" class="w-5 h-5 text-blue-600"></i>
                                æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰
                            </h4>
                            <p class="text-sm text-gray-700 mb-3">
                                2ã¤ã®ã‚°ãƒ©ãƒ•ã‚’åŒæ™‚ã«è¡¨ç¤ºã—ã€ç•°ãªã‚‹æœŸé–“ã‚’æ¯”è¼ƒã§ãã¾ã™ã€‚
                            </p>
                            <ul class="space-y-2 text-sm text-gray-700">
                                <li class="flex items-start gap-2">
                                    <span class="text-blue-600">â€¢</span>
                                    <span>ä¾‹: ä¸Šã®ã‚°ãƒ©ãƒ•ã§ã€Œ7æ—¥é–“ã€ã€ä¸‹ã®ã‚°ãƒ©ãƒ•ã§ã€Œ30æ—¥é–“ã€ã‚’é¸æŠã—ã¦çŸ­æœŸã¨é•·æœŸã‚’æ¯”è¼ƒ</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-blue-600">â€¢</span>
                                    <span>ä¸Šã®ã‚°ãƒ©ãƒ•ã§é¸æŠã—ãŸæœŸé–“ã¯ã€ä¸‹ã®ã‚°ãƒ©ãƒ•ã§é¸æŠã§ãã¾ã›ã‚“ï¼ˆé‡è¤‡é˜²æ­¢ï¼‰</span>
                                </li>
                            </ul>
                        </div>

                        <!-- Yè»¸é€£å‹• -->
                        <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                            <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                                <i data-lucide="refresh-cw" class="w-5 h-5 text-purple-600"></i>
                                Yè»¸é€£å‹•æ©Ÿèƒ½
                            </h4>
                            <p class="text-sm text-gray-700 mb-3">
                                ä¸Šã®ã‚°ãƒ©ãƒ•ã®Yè»¸ç¯„å›²ã‚’å¤‰æ›´ã™ã‚‹ã¨ã€ä¸‹ã®ã‚°ãƒ©ãƒ•ã‚‚è‡ªå‹•ã§åŒã˜ç¯„å›²ã«èª¿æ•´ã•ã‚Œã¾ã™ã€‚
                            </p>
                            <ul class="space-y-2 text-sm text-gray-700">
                                <li class="flex items-start gap-2">
                                    <span class="text-purple-600">â€¢</span>
                                    <span><strong>ONã®å ´åˆ</strong>: ä¸Šä¸‹ã®ã‚°ãƒ©ãƒ•ã§åŒã˜ã‚¹ã‚±ãƒ¼ãƒ«ã‚’ä½¿ç”¨ï¼ˆæ¯”è¼ƒã—ã‚„ã™ã„ï¼‰</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-purple-600">â€¢</span>
                                    <span><strong>OFFã®å ´åˆ</strong>: ä¸Šä¸‹ã®ã‚°ãƒ©ãƒ•ã§ç‹¬ç«‹ã—ãŸã‚¹ã‚±ãƒ¼ãƒ«ã‚’ä½¿ç”¨</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-purple-600">â€¢</span>
                                    <span>ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã§ON/OFFåˆ‡ã‚Šæ›¿ãˆå¯èƒ½</span>
                                </li>
                            </ul>
                        </div>

                        <!-- Yè»¸ç¯„å›²èª¿æ•´ -->
                        <div>
                            <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                                <i data-lucide="sliders-horizontal" class="w-5 h-5 text-green-600"></i>
                                Yè»¸ç¯„å›²ã®èª¿æ•´
                            </h4>
                            <ul class="space-y-2 text-sm text-gray-700">
                                <li class="flex items-start gap-2">
                                    <span class="text-green-600">â€¢</span>
                                    <span><strong>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ</strong>: å…¨æœŸé–“ï¼ˆ90æ—¥é–“ï¼‰ã®æœ€ä½å€¤ï½æœ€é«˜å€¤ã‚’åŸºæº–ã«è‡ªå‹•è¨­å®š</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-green-600">â€¢</span>
                                    <span><strong>æ‰‹å‹•èª¿æ•´</strong>: ã€Œæœ€å°å€¤ã€ã€Œæœ€å¤§å€¤ã€ã®å…¥åŠ›æ¬„ã«æ•°å€¤ã‚’å…¥åŠ›ã—ã¦è¡¨ç¤ºç¯„å›²ã‚’å¤‰æ›´</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-green-600">â€¢</span>
                                    <span><strong>åˆæœŸå€¤ã«æˆ»ã™</strong>: ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ç¯„å›²ã«æˆ»ã™</span>
                                </li>
                            </ul>
                        </div>

                        <!-- AIåˆ†æ -->
                        <div class="bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-lg border border-purple-200">
                            <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                                <i data-lucide="sparkles" class="w-5 h-5 text-purple-600"></i>
                                AIåˆ†ææ©Ÿèƒ½
                            </h4>
                            <p class="text-sm text-gray-700 mb-3">
                                Gemini AIãŒã‚°ãƒ©ãƒ•ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã€ãƒˆãƒ¬ãƒ³ãƒ‰è©•ä¾¡ãƒ»æ”¹å–„ææ¡ˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚
                            </p>
                            <ul class="space-y-2 text-sm text-gray-700">
                                <li class="flex items-start gap-2">
                                    <span class="text-purple-600">â€¢</span>
                                    <span><strong>ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ</strong>: å¢—åŠ /æ¸›å°‘/æ¨ªã°ã„ã‚’åˆ¤å®šã—ç†ç”±ã‚’èª¬æ˜</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-purple-600">â€¢</span>
                                    <span><strong>ç›®æ¨™é”æˆäºˆæ¸¬</strong>: ç¾åœ¨ã®ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆã¾ã§ã®æ—¥æ•°ã‚’äºˆæ¸¬</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-purple-600">â€¢</span>
                                    <span><strong>æ”¹å–„ææ¡ˆ</strong>: å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆé£Ÿäº‹/é‹å‹•/ä¼‘é¤Šï¼‰ã‚’3ã¤æç¤º</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-purple-600">â€¢</span>
                                    <span><strong>æ³¨æ„ç‚¹</strong>: ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ°—ã‚’ã¤ã‘ã‚‹ã¹ããƒã‚¤ãƒ³ãƒˆã‚’æŠ½å‡º</span>
                                </li>
                            </ul>
                        </div>

                        <!-- çµ±è¨ˆæƒ…å ± -->
                        <div>
                            <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                                <i data-lucide="bar-chart-3" class="w-5 h-5 text-orange-600"></i>
                                çµ±è¨ˆæƒ…å ±ã®è¦‹æ–¹
                            </h4>
                            <ul class="space-y-2 text-sm text-gray-700">
                                <li class="flex items-start gap-2">
                                    <span class="text-blue-600">â€¢</span>
                                    <span><strong>å¹³å‡</strong>: é¸æŠæœŸé–“å†…ã®å¹³å‡å€¤</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-green-600">â€¢</span>
                                    <span><strong>æœ€é«˜</strong>: é¸æŠæœŸé–“å†…ã®æœ€é«˜å€¤</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-orange-600">â€¢</span>
                                    <span><strong>æœ€ä½</strong>: é¸æŠæœŸé–“å†…ã®æœ€ä½å€¤</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-purple-600">â€¢</span>
                                    <span><strong>æŒ‡ç¤ºæ›¸é”æˆçŠ¶æ³</strong>: é”æˆç‡ï¼ˆ%ï¼‰ã€å®Œäº†æ—¥æ•°ã€æœªå®Œäº†æ—¥æ•°ã‚’è¡¨ç¤º</span>
                                </li>
                            </ul>
                        </div>

                        <!-- ãƒ‡ãƒ¼ã‚¿ä¿å­˜ï¼ˆã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ¨å¥¨ï¼‰ -->
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                            <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                                <i data-lucide="camera" class="w-5 h-5 text-green-600"></i>
                                ãƒ‡ãƒ¼ã‚¿ä¿å­˜æ–¹æ³•
                            </h4>
                            <p class="text-sm text-gray-700 mb-3">
                                ã‚°ãƒ©ãƒ•ã‚’ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã§ä¿å­˜ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ï¼š
                            </p>
                            <ul class="space-y-2 text-sm text-gray-700">
                                <li class="flex items-start gap-2">
                                    <span class="text-green-600">ğŸ“¸</span>
                                    <span><strong>Windows</strong>: Win + Shift + Sï¼ˆç”»é¢ã®ä¸€éƒ¨ã‚’é¸æŠï¼‰</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-green-600">ğŸ“¸</span>
                                    <span><strong>Mac</strong>: Cmd + Shift + 4ï¼ˆç”»é¢ã®ä¸€éƒ¨ã‚’é¸æŠï¼‰</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-green-600">ğŸ“¸</span>
                                    <span><strong>ãƒ–ãƒ©ã‚¦ã‚¶</strong>: å³ã‚¯ãƒªãƒƒã‚¯ â†’ ã€Œãƒšãƒ¼ã‚¸ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®ã‚‹ã€ï¼ˆFirefoxï¼‰</span>
                                </li>
                            </ul>
                        </div>

                        <!-- ãƒ’ãƒ³ãƒˆ -->
                        <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                            <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center gap-2">
                                <i data-lucide="lightbulb" class="w-5 h-5 text-yellow-600"></i>
                                æ´»ç”¨ãƒ’ãƒ³ãƒˆ
                            </h4>
                            <ul class="space-y-2 text-sm text-gray-700">
                                <li class="flex items-start gap-2">
                                    <span class="text-yellow-600">ğŸ’¡</span>
                                    <span>çŸ­æœŸï¼ˆ7æ—¥é–“ï¼‰ã§ç´°ã‹ã„å¤‰åŒ–ã‚’ç¢ºèªã—ã€é•·æœŸï¼ˆ30-90æ—¥é–“ï¼‰ã§å…¨ä½“çš„ãªãƒˆãƒ¬ãƒ³ãƒ‰ã‚’æŠŠæ¡ã—ã¾ã—ã‚‡ã†</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-yellow-600">ğŸ’¡</span>
                                    <span>æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰ã§çŸ­æœŸã¨é•·æœŸã‚’ä¸¦ã¹ã¦è¡¨ç¤ºã™ã‚‹ã¨ã€ä¸€æ™‚çš„ãªå¤‰å‹•ã¨æœ¬å½“ã®ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’åŒºåˆ¥ã§ãã¾ã™</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-yellow-600">ğŸ’¡</span>
                                    <span>Yè»¸ç¯„å›²ã‚’èª¿æ•´ã™ã‚‹ã“ã¨ã§ã€å°ã•ãªå¤‰åŒ–ã‚‚å¤§ããè¡¨ç¤ºã§ãã€å¾®ç´°ãªãƒˆãƒ¬ãƒ³ãƒ‰ã‚’ç™ºè¦‹ã§ãã¾ã™</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-yellow-600">ğŸ’¡</span>
                                    <span>AIåˆ†æã¯å®šæœŸçš„ã«å®Ÿè¡Œã—ã€å®¢è¦³çš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å—ã‘ã‚‹ã“ã¨ã§æ”¹å–„ã«ã¤ãªã’ã¾ã—ã‚‡ã†</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-yellow-600">ğŸ’¡</span>
                                    <span>ã‚°ãƒ©ãƒ•ã«ãƒ¡ãƒ¢ï¼ˆğŸ“ï¼‰ã‚’è¿½åŠ ã—ã¦ã€ç‰¹åˆ¥ãªæ—¥ï¼ˆãƒãƒ¼ãƒˆãƒ‡ã‚¤ã€é¢¨é‚ªãªã©ï¼‰ã‚’è¨˜éŒ²ã§ãã¾ã™</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ— -->
        <div id="tooltip" class="tooltip"></div>

        <!-- ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®šãƒ‘ãƒãƒ« -->
        <div id="settings-panel" class="floating-panel hidden">
            <div class="sticky top-0 bg-gradient-to-r from-gray-700 to-gray-600 text-white p-4 rounded-t-xl">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-2">
                        <i data-lucide="settings" class="w-5 h-5"></i>
                        <h3 class="text-lg font-bold">ã‚°ãƒ©ãƒ•è¨­å®š</h3>
                    </div>
                    <button onclick="closeSettingsPanel()" class="p-1 hover:bg-white/20 rounded">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>

            <div class="p-4 space-y-6">
                <!-- ã‚«ã‚¹ã‚¿ãƒ æœŸé–“è¨­å®š -->
                <div>
                    <h4 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                        <i data-lucide="calendar" class="w-4 h-4 text-indigo-600"></i>
                        ã‚«ã‚¹ã‚¿ãƒ æœŸé–“
                    </h4>
                    <div class="space-y-2">
                        <div>
                            <label class="text-xs text-gray-600 block mb-1">é–‹å§‹æ—¥</label>
                            <input type="text" id="custom-start-panel" placeholder="é–‹å§‹æ—¥ã‚’é¸æŠ" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="text-xs text-gray-600 block mb-1">çµ‚äº†æ—¥</label>
                            <input type="text" id="custom-end-panel" placeholder="çµ‚äº†æ—¥ã‚’é¸æŠ" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                        </div>
                        <button onclick="applyCustomPeriodFromPanel()" class="w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition font-semibold text-sm">
                            é©ç”¨
                        </button>
                    </div>
                </div>

                <!-- Yè»¸ç¯„å›²è¨­å®š -->
                <div>
                    <h4 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                        <i data-lucide="sliders-horizontal" class="w-4 h-4 text-green-600"></i>
                        Yè»¸ç¯„å›²
                    </h4>
                    <div class="space-y-2">
                        <div>
                            <label class="text-xs text-gray-600 block mb-1">æœ€å°å€¤</label>
                            <input type="number" id="axis-min-panel" step="0.1" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" onchange="updateAxisRangeFromPanel()">
                        </div>
                        <div>
                            <label class="text-xs text-gray-600 block mb-1">æœ€å¤§å€¤</label>
                            <input type="number" id="axis-max-panel" step="0.1" class="w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent" onchange="updateAxisRangeFromPanel()">
                        </div>
                        <button onclick="resetAxisRangeFromPanel()" class="w-full px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition font-semibold text-sm">
                            åˆæœŸå€¤ã«æˆ»ã™
                        </button>
                    </div>
                </div>

                <!-- è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
                <div>
                    <h4 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                        <i data-lucide="eye" class="w-4 h-4 text-purple-600"></i>
                        è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³
                    </h4>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center gap-2">
                                <i data-lucide="columns-2" class="w-4 h-4 text-blue-600"></i>
                                <label for="comparison-mode-panel" class="text-sm font-semibold text-gray-700">æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰</label>
                            </div>
                            <input type="checkbox" id="comparison-mode-panel" class="w-4 h-4" onchange="toggleComparisonMode()">
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center gap-2">
                                <i data-lucide="refresh-cw" class="w-4 h-4 text-purple-600"></i>
                                <label for="sync-axis-panel" class="text-sm font-semibold text-gray-700">Yè»¸é€£å‹•</label>
                            </div>
                            <input type="checkbox" id="sync-axis-panel" class="w-4 h-4" checked onchange="toggleAxisSync()">
                        </div>
                    </div>
                </div>

                <!-- ãƒ˜ãƒ«ãƒ—ãƒªãƒ³ã‚¯ -->
                <div class="pt-4 border-t border-gray-200">
                    <button onclick="openHelpModal(); closeSettingsPanel();" class="w-full flex items-center justify-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition font-semibold text-sm">
                        <i data-lucide="help-circle" class="w-4 h-4"></i>
                        ä½¿ã„æ–¹ã‚’è¦‹ã‚‹
                    </button>
                </div>
            </div>
        </div>

        <!-- ç›®æ¨™è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="goal-setting-modal" class="modal">
            <div class="modal-content">
                <div class="sticky top-0 bg-gradient-to-r from-green-600 to-teal-600 text-white p-4 rounded-t-lg">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-2">
                            <i data-lucide="target" class="w-5 h-5"></i>
                            <h3 class="text-lg font-bold">ç›®æ¨™è¨­å®š</h3>
                        </div>
                        <button onclick="closeGoalSettingModal()" class="p-1 hover:bg-white/20 rounded">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        <!-- æŒ‡æ¨™é¸æŠ -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ç›®æ¨™ã‚’è¨­å®šã™ã‚‹æŒ‡æ¨™</label>
                            <select id="goal-metric" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                <option value="lbm">ğŸ’ª LBMï¼ˆé™¤è„‚è‚ªä½“é‡ï¼‰</option>
                                <option value="overall">ğŸ¯ ç·åˆåˆ†æã‚¹ã‚³ã‚¢</option>
                            </select>
                        </div>

                        <!-- ç›®æ¨™å€¤ -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ç›®æ¨™å€¤</label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="goal-value" step="0.1" placeholder="ä¾‹: 65.0" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                                <span id="goal-unit" class="text-gray-600 font-semibold">kg</span>
                            </div>
                        </div>

                        <!-- é”æˆäºˆå®šæ—¥ -->
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">é”æˆäºˆå®šæ—¥ï¼ˆä»»æ„ï¼‰</label>
                            <input type="date" id="goal-date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                        </div>

                        <!-- ã‚°ãƒ©ãƒ•ã«è¡¨ç¤ºã™ã‚‹ã‹ -->
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="goal-show-line" checked class="w-4 h-4">
                            <label for="goal-show-line" class="text-sm font-semibold text-gray-700">ã‚°ãƒ©ãƒ•ã«ç›®æ¨™ãƒ©ã‚¤ãƒ³ã‚’è¡¨ç¤º</label>
                        </div>

                        <!-- ç¾åœ¨ã®ç›®æ¨™ -->
                        <div id="current-goal-info" class="bg-blue-50 p-4 rounded-lg border border-blue-200 hidden">
                            <h4 class="text-sm font-bold text-blue-700 mb-2">ç¾åœ¨ã®ç›®æ¨™</h4>
                            <div id="current-goal-text" class="text-sm text-gray-700"></div>
                        </div>

                        <!-- ãƒœã‚¿ãƒ³ -->
                        <div class="flex gap-3">
                            <button onclick="saveGoal()" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition flex items-center justify-center gap-2 font-semibold">
                                <i data-lucide="check" class="w-4 h-4"></i>
                                ç›®æ¨™ã‚’ä¿å­˜
                            </button>
                            <button onclick="clearGoal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition font-semibold">
                                ã‚¯ãƒªã‚¢
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- v9ã®æ”¹è‰¯ãƒã‚¤ãƒ³ãƒˆ -->
        <div class="bg-white rounded-lg shadow-md p-4 mt-6">
            <h3 class="font-bold text-lg mb-3 text-gray-800">âœ… v9ã®æ–°æ©Ÿèƒ½</h3>
            <ul class="list-disc pl-5 space-y-1 text-sm text-gray-700">
                <li><strong>Yè»¸é€£å‹•æ©Ÿèƒ½</strong>: ä¸Šã®ã‚°ãƒ©ãƒ•ã®Yè»¸ç¯„å›²ã‚’å¤‰æ›´ã™ã‚‹ã¨ã€ä¸‹ã®ã‚°ãƒ©ãƒ•ã‚‚è‡ªå‹•ã§åŒã˜ç¯„å›²ã«èª¿æ•´</li>
                <li><strong>è‡ªå‹•ãƒ¬ãƒ³ã‚¸èª¿æ•´</strong>: ã‚°ãƒ©ãƒ•ã®é«˜ã•ã‚’è¡¨ç¤ºç¯„å›²ã«å¿œã˜ã¦è‡ªå‹•æœ€é©åŒ–ï¼ˆè¦–è¦šçš„ã«è¦‹ã‚„ã™ãï¼‰</li>
                <li><strong>æœ€ä½å€¤/æœ€å¤§å€¤ãƒ™ãƒ¼ã‚¹</strong>: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®Yè»¸ç¯„å›²ã¯å…¨æœŸé–“ï¼ˆ90æ—¥é–“ï¼‰ã®æœ€ä½å€¤ã¨æœ€å¤§å€¤ã‚’åŸºæº–ã«è‡ªå‹•è¨­å®š</li>
                <li><strong>é€£å‹•ON/OFFåˆ‡æ›¿</strong>: ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§Yè»¸é€£å‹•ã‚’ä»»æ„ã«ON/OFFå¯èƒ½</li>
                <li><strong>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ</strong>: ä¸Šã®ã‚°ãƒ©ãƒ•ã®æ•°å€¤å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹ã¨å³åº§ã«ä¸‹ã®ã‚°ãƒ©ãƒ•ã‚‚æ›´æ–°</li>
                <li><strong>æœŸé–“ã®é‡è¤‡é˜²æ­¢</strong>: ä¸Šã®ã‚°ãƒ©ãƒ•ã§é¸æŠã—ãŸæœŸé–“ã¯ã€ä¸‹ã®ã‚°ãƒ©ãƒ•ã§é¸æŠã§ããªã„ã‚ˆã†ã«è‡ªå‹•ã§ç„¡åŠ¹åŒ–</li>
                <li><strong>æŒ‡ç¤ºæ›¸é”æˆçŠ¶æ³</strong>: å®Œäº†/æœªå®Œäº†ã®2æŠãƒ‡ãƒ¼ã‚¿ã«å¯¾å¿œï¼ˆãƒãƒ¼ã‚°ãƒ©ãƒ•è¡¨ç¤ºã€é”æˆç‡ãƒ»å®Œäº†æ—¥æ•°ãƒ»æœªå®Œäº†æ—¥æ•°ã‚’çµ±è¨ˆè¡¨ç¤ºï¼‰</li>
                <li><strong>ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</strong>: ã€Œä½¿ã„æ–¹ã€ãƒœã‚¿ãƒ³ã§è©³ç´°ãªæ“ä½œèª¬æ˜ã‚’è¡¨ç¤ºã€å„æ©Ÿèƒ½ã«iã‚¢ã‚¤ã‚³ãƒ³ã§ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—è¡¨ç¤º</li>
            </ul>
        </div>

        <!-- ä»Šå¾Œå®Ÿè£…ã™ã¹ãæ©Ÿèƒ½ï¼ˆææ¡ˆï¼‰ -->
        <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg shadow-md p-4 mt-6 border-2 border-blue-300">
            <h3 class="font-bold text-lg mb-3 text-gray-800 flex items-center gap-2">
                <span>ğŸ’¡</span>
                ä»Šå¾Œå®Ÿè£…ã™ã¹ãæ©Ÿèƒ½ï¼ˆææ¡ˆï¼‰
            </h3>

            <!-- å„ªå…ˆåº¦: é«˜ -->
            <div class="mb-4">
                <h4 class="font-semibold text-md mb-2 text-red-700">ğŸ”´ å„ªå…ˆåº¦: é«˜</h4>
                <ul class="space-y-2 text-sm text-gray-700">
                    <li class="flex items-start gap-2 bg-white p-2 rounded">
                        <span class="text-red-600 font-bold">1.</span>
                        <div>
                            <strong>ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½</strong>
                            <p class="text-xs text-gray-600 mt-1">CSV/PDFå½¢å¼ã§ã‚°ãƒ©ãƒ•ã¨çµ±è¨ˆãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€‚åŒ»å¸«ã‚„æ „é¤Šå£«ã¨ã®å…±æœ‰ã«ä¾¿åˆ©</p>
                        </div>
                    </li>
                    <li class="flex items-start gap-2 bg-white p-2 rounded">
                        <span class="text-red-600 font-bold">2.</span>
                        <div>
                            <strong>ç›®æ¨™è¨­å®šãƒ»é€²æ—è¡¨ç¤º</strong>
                            <p class="text-xs text-gray-600 mt-1">å„æŒ‡æ¨™ã«ç›®æ¨™å€¤ã‚’è¨­å®šã—ã€ã‚°ãƒ©ãƒ•ä¸Šã«ç›®æ¨™ãƒ©ã‚¤ãƒ³ã‚’è¡¨ç¤ºã€‚é”æˆåº¦ã‚’å¯è¦–åŒ–</p>
                        </div>
                    </li>
                    <li class="flex items-start gap-2 bg-white p-2 rounded">
                        <span class="text-red-600 font-bold">3.</span>
                        <div>
                            <strong>ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ¡ãƒ¢ï¼‰æ©Ÿèƒ½</strong>
                            <p class="text-xs text-gray-600 mt-1">ç‰¹å®šã®æ—¥ä»˜ã«ãƒ¡ãƒ¢ã‚’è¿½åŠ ï¼ˆä¾‹: ã€Œé¢¨é‚ªã§ä¼‘é¤Šã€ã€Œãƒãƒ¼ãƒˆãƒ‡ã‚¤ã€ï¼‰ã€‚ã‚°ãƒ©ãƒ•ä¸Šã«ãƒãƒ¼ã‚«ãƒ¼è¡¨ç¤º</p>
                        </div>
                    </li>
                    <li class="flex items-start gap-2 bg-white p-2 rounded">
                        <span class="text-red-600 font-bold">4.</span>
                        <div>
                            <strong>ã‚«ã‚¹ã‚¿ãƒ æœŸé–“é¸æŠ</strong>
                            <p class="text-xs text-gray-600 mt-1">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼UIã§ä»»æ„ã®æ—¥ä»˜ç¯„å›²ã‚’é¸æŠå¯èƒ½ã«ï¼ˆä¾‹: 2024/10/1 ã€œ 2024/10/15ï¼‰</p>
                        </div>
                    </li>
                </ul>
            </div>

            <!-- å„ªå…ˆåº¦: ä¸­ -->
            <div class="mb-4">
                <h4 class="font-semibold text-md mb-2 text-orange-700">ğŸŸ¡ å„ªå…ˆåº¦: ä¸­</h4>
                <ul class="space-y-2 text-sm text-gray-700">
                    <li class="flex items-start gap-2 bg-white p-2 rounded">
                        <span class="text-orange-600 font-bold">5.</span>
                        <div>
                            <strong>è¤‡æ•°æŒ‡æ¨™ã®é‡ã­åˆã‚ã›</strong>
                            <p class="text-xs text-gray-600 mt-1">1ã¤ã®ã‚°ãƒ©ãƒ•ã«è¤‡æ•°ã®æŒ‡æ¨™ã‚’è¡¨ç¤ºï¼ˆä¾‹: ä½“é‡ã¨LBMã‚’åŒæ™‚è¡¨ç¤ºï¼‰ã€‚ç›¸é–¢é–¢ä¿‚ã‚’åˆ†æ</p>
                        </div>
                    </li>
                    <li class="flex items-start gap-2 bg-white p-2 rounded">
                        <span class="text-orange-600 font-bold">6.</span>
                        <div>
                            <strong>ç§»å‹•å¹³å‡ç·šã®è¡¨ç¤º</strong>
                            <p class="text-xs text-gray-600 mt-1">7æ—¥/14æ—¥/30æ—¥ç§»å‹•å¹³å‡ç·šã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤ºã€‚ãƒã‚¤ã‚ºã‚’é™¤å»ã—ã¦ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’æŠŠæ¡</p>
                        </div>
                    </li>
                    <li class="flex items-start gap-2 bg-white p-2 rounded">
                        <span class="text-orange-600 font-bold">7.</span>
                        <div>
                            <strong>é€±æ¬¡ãƒ»æœˆæ¬¡ã‚µãƒãƒªãƒ¼</strong>
                            <p class="text-xs text-gray-600 mt-1">é€±ã”ã¨ãƒ»æœˆã”ã¨ã®å¹³å‡å€¤ã‚„é”æˆç‡ã‚’ä¸€è¦§è¡¨ç¤ºã€‚é•·æœŸãƒˆãƒ¬ãƒ³ãƒ‰ã‚’ä¿¯ç°</p>
                        </div>
                    </li>
                    <li class="flex items-start gap-2 bg-white p-2 rounded">
                        <span class="text-orange-600 font-bold">8.</span>
                        <div>
                            <strong>ã‚°ãƒ©ãƒ•ã®ç”»åƒä¿å­˜</strong>
                            <p class="text-xs text-gray-600 mt-1">ã‚°ãƒ©ãƒ•ã‚’PNG/JPGå½¢å¼ã§ä¿å­˜ã€‚SNSã‚„å ±å‘Šæ›¸ã¸ã®è²¼ã‚Šä»˜ã‘ã«ä¾¿åˆ©</p>
                        </div>
                    </li>
                </ul>
            </div>

            <!-- å„ªå…ˆåº¦: ä½ -->
            <div>
                <h4 class="font-semibold text-md mb-2 text-green-700">ğŸŸ¢ å„ªå…ˆåº¦: ä½ï¼ˆå°†æ¥çš„ã«ï¼‰</h4>
                <ul class="space-y-2 text-sm text-gray-700">
                    <li class="flex items-start gap-2 bg-white p-2 rounded">
                        <span class="text-green-600 font-bold">9.</span>
                        <div>
                            <strong>äºˆæ¸¬ç·šã®è¡¨ç¤º</strong>
                            <p class="text-xs text-gray-600 mt-1">æ©Ÿæ¢°å­¦ç¿’ã§ä»Šå¾Œã®æ¨ç§»ã‚’äºˆæ¸¬ã€‚æœªæ¥7æ—¥é–“ã®äºˆæ¸¬ç·šã‚’è¡¨ç¤º</p>
                        </div>
                    </li>
                    <li class="flex items-start gap-2 bg-white p-2 rounded">
                        <span class="text-green-600 font-bold">10.</span>
                        <div>
                            <strong>ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸAIã‚³ãƒ¼ãƒãƒ³ã‚°</strong>
                            <p class="text-xs text-gray-600 mt-1">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å±¥æ­´ã‹ã‚‰æœ€é©ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’è‡ªå‹•ç”Ÿæˆã€‚æ¯é€±æœˆæ›œæ—¥ã«ãƒ¬ãƒãƒ¼ãƒˆé…ä¿¡</p>
                        </div>
                    </li>
                    <li class="flex items-start gap-2 bg-white p-2 rounded">
                        <span class="text-green-600 font-bold">11.</span>
                        <div>
                            <strong>ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®æ¯”è¼ƒ</strong>
                            <p class="text-xs text-gray-600 mt-1">åŒ¿ååŒ–ã•ã‚ŒãŸä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¹³å‡å€¤ã¨è‡ªåˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¯”è¼ƒï¼ˆãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·å¿…é ˆï¼‰</p>
                        </div>
                    </li>
                    <li class="flex items-start gap-2 bg-white p-2 rounded">
                        <span class="text-green-600 font-bold">12.</span>
                        <div>
                            <strong>ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³</strong>
                            <p class="text-xs text-gray-600 mt-1">ã‚°ãƒ©ãƒ•ä¸Šã®ç‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ãã®æ—¥ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ï¼ˆé£Ÿäº‹å†…å®¹ã€ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼‰ã‚’è¡¨ç¤º</p>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Lucideã‚¢ã‚¤ã‚³ãƒ³åˆæœŸåŒ–
        lucide.createIcons();

        let currentMainCategory = 'performance';
        let currentSubCategory = 'lbm';
        let comparisonMode = false;
        let axisSync = true; // Yè»¸é€£å‹•ON/OFF
        let charts = { 1: null, 2: null };
        let currentPeriods = { 1: 7, 2: 30 };
        let currentAxisRanges = { 1: { min: null, max: null }, 2: { min: null, max: null } };
        let globalMinMax = { min: 0, max: 100 }; // å…¨æœŸé–“ã®æœ€ä½å€¤ãƒ»æœ€å¤§å€¤
        let currentData = { 1: [], 2: [] };
        let goals = {}; // ç›®æ¨™ãƒ‡ãƒ¼ã‚¿ï¼ˆLocalStorageã‹ã‚‰èª­ã¿è¾¼ã¿ï¼‰
        let annotations = {}; // ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ¡ãƒ¢ï¼‰ãƒ‡ãƒ¼ã‚¿

        // Gemini APIè¨­å®šï¼ˆãƒ‡ãƒ¢ç”¨ - å®Ÿéš›ã¯config.jsã‹ã‚‰å–å¾—ï¼‰
        const GEMINI_API_KEY = 'YOUR_API_KEY_HERE';
        const GEMINI_API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent';

        // æŒ‡æ¨™ã®æ—¥æœ¬èªåã¨ãƒ¡ã‚¿æƒ…å ±
        const metricInfo = {
            lbm: { name: 'LBMï¼ˆé™¤è„‚è‚ªä½“é‡ï¼‰', unit: 'kg', target: 65, icon: 'ğŸ’ª' },
            directive: { name: 'æŒ‡ç¤ºæ›¸é”æˆçŠ¶æ³', unit: '', target: 1, icon: 'ğŸ“‹', isBinary: true }, // 0=æœªå®Œäº†, 1=å®Œäº†
            overall: { name: 'ç·åˆåˆ†æã‚¹ã‚³ã‚¢', unit: 'ç‚¹', target: 100, icon: 'ğŸ¯' }
        };

        // 90æ—¥é–“ã®ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆï¼ˆå…¨æœŸé–“ãƒ‡ãƒ¼ã‚¿ï¼‰
        const allData = {
            lbm: Array.from({ length: 90 }, (_, i) => 61.0 + (i * 0.02) + (Math.random() * 0.3 - 0.15)),
            directive: Array.from({ length: 90 }, () => Math.random() > 0.3 ? 1 : 0), // 0=æœªå®Œäº†, 1=å®Œäº†ï¼ˆ70%å®Œäº†ç‡ï¼‰
            overall: Array.from({ length: 90 }, (_, i) => 80 + (i * 0.1) + (Math.random() * 8 - 4))
        };

        // å…¨æœŸé–“ã®æœ€ä½å€¤ãƒ»æœ€å¤§å€¤ã‚’è¨ˆç®—
        function calculateGlobalMinMax(metric) {
            const data = allData[metric];
            const info = metricInfo[metric];

            // æŒ‡ç¤ºæ›¸ï¼ˆãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ï¼‰ã¯0-1å›ºå®š
            if (info.isBinary) {
                return { min: 0, max: 1 };
            }

            const min = Math.min(...data);
            const max = Math.max(...data);
            const range = max - min;

            // ãƒãƒ¼ã‚¸ãƒ³ã‚’å¤§ãã‚ã«è¨­å®šï¼ˆ20%ï¼‰ã—ã¦ã€æ•°å€¤ãŒè¦‹åˆ‡ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹
            const margin = Math.max(range * 0.2, 0.5); // æœ€ä½ã§ã‚‚0.5ã®ãƒãƒ¼ã‚¸ãƒ³

            return {
                min: Math.floor((min - margin) * 10) / 10,
                max: Math.ceil((max + margin) * 10) / 10
            };
        }

        // æŒ‡å®šæœŸé–“ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
        function generateData(days) {
            return {
                lbm: allData.lbm.slice(-days),
                directive: allData.directive.slice(-days),
                overall: allData.overall.slice(-days)
            };
        }

        // ãƒ©ãƒ™ãƒ«ç”Ÿæˆ
        function generateLabels(days) {
            if (days <= 7) {
                return ['æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ', 'æ—¥'].slice(-days);
            } else if (days <= 30) {
                return Array.from({ length: days }, (_, i) => `${i + 1}æ—¥`);
            } else {
                return Array.from({ length: days }, (_, i) => {
                    if (i % 7 === 0) return `${Math.floor(i / 7) + 1}é€±`;
                    return '';
                });
            }
        }

        // Yè»¸é€£å‹•ã®ON/OFFåˆ‡æ›¿
        function toggleAxisSync() {
            // ãƒ‘ãƒãƒ«ã¾ãŸã¯ãƒ¡ã‚¤ãƒ³ç”»é¢ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‹ã‚‰çŠ¶æ…‹ã‚’å–å¾—
            const syncAxisPanelElement = document.getElementById('sync-axis-panel');
            const syncAxisElement = document.getElementById('sync-axis');

            // ãƒ‘ãƒãƒ«ã®è¦ç´ ãŒã‚ã‚Œã°ãã¡ã‚‰ã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°ãƒ¡ã‚¤ãƒ³ã®è¦ç´ ã‚’ä½¿ç”¨
            const checkboxElement = syncAxisPanelElement || syncAxisElement;
            if (!checkboxElement) {
                console.warn('Yè»¸é€£å‹•è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }

            axisSync = checkboxElement.checked;

            // ä¸¡æ–¹ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’åŒæœŸ
            if (syncAxisPanelElement) syncAxisPanelElement.checked = axisSync;
            if (syncAxisElement) syncAxisElement.checked = axisSync;

            const icon = document.querySelector('.sync-icon');

            if (axisSync) {
                // ONã«ãªã£ãŸã‚‰ã€ã‚°ãƒ©ãƒ•1ã®å€¤ã‚’ã‚°ãƒ©ãƒ•2ã«åæ˜ 
                if (icon) {
                    icon.classList.add('syncing');
                    setTimeout(() => icon.classList.remove('syncing'), 1000);
                }

                if (comparisonMode && currentAxisRanges[1].min !== null) {
                    const axisMin2Element = document.getElementById('axis-min-2');
                    const axisMax2Element = document.getElementById('axis-max-2');

                    currentAxisRanges[2] = { ...currentAxisRanges[1] };
                    if (axisMin2Element) axisMin2Element.value = currentAxisRanges[1].min;
                    if (axisMax2Element) axisMax2Element.value = currentAxisRanges[1].max;
                    updateChart(2);
                }
            }

            lucide.createIcons();
        }

        // Geminiåˆ†æ
        async function analyzeWithGemini() {
            const modal = document.getElementById('ai-analysis-modal');
            const content = document.getElementById('analysis-content');

            modal.classList.add('show');
            content.innerHTML = `
                <div class="ai-analyzing">
                    <div class="spinner"></div>
                    <span class="text-gray-600">AIãŒã‚°ãƒ©ãƒ•ã‚’åˆ†æä¸­...</span>
                </div>
            `;

            const metric = metricInfo[currentSubCategory];
            const data1 = currentData[1];
            const period1 = currentPeriods[1];

            // ãƒ‡ãƒ¼ã‚¿ã®çµ±è¨ˆæƒ…å ±ã‚’è¨ˆç®—
            const avg = (data1.reduce((a, b) => a + b, 0) / data1.length).toFixed(1);
            const max = Math.max(...data1).toFixed(1);
            const min = Math.min(...data1).toFixed(1);
            const trend = (data1[data1.length - 1] - data1[0]).toFixed(1);
            const trendPercent = ((trend / data1[0]) * 100).toFixed(1);

            // Geminiã¸ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä½œæˆ
            const prompt = `
ã‚ãªãŸã¯ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ã‚³ãƒ¼ãƒã§ã™ã€‚ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚

ã€æŒ‡æ¨™ã€‘${metric.name}
ã€æœŸé–“ã€‘éå»${period1}æ—¥é–“
ã€ãƒ‡ãƒ¼ã‚¿ã€‘${data1.map(v => v.toFixed(1)).join(', ')}
ã€çµ±è¨ˆã€‘
- å¹³å‡: ${avg}${metric.unit}
- æœ€é«˜: ${max}${metric.unit}
- æœ€ä½: ${min}${metric.unit}
- å¤‰åŒ–é‡: ${trend > 0 ? '+' : ''}${trend}${metric.unit} (${trendPercent}%)
ã€ç›®æ¨™ã€‘${metric.target}${metric.unit}

ä»¥ä¸‹ã®å½¢å¼ã§ç°¡æ½”ã«å›ç­”ã—ã¦ãã ã•ã„ï¼ˆå„ã‚»ã‚¯ã‚·ãƒ§ãƒ³200æ–‡å­—ä»¥å†…ï¼‰ï¼š

## ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
[å¢—åŠ /æ¸›å°‘/æ¨ªã°ã„ã‚’åˆ¤å®šã—ã€ãã®ç†ç”±ã‚’1-2æ–‡ã§]

## ç›®æ¨™é”æˆäºˆæ¸¬
[ç¾åœ¨ã®ãƒšãƒ¼ã‚¹ã§ç›®æ¨™é”æˆã¾ã§ã®äºˆæ¸¬æ—¥æ•°ã¨æ ¹æ‹ ã‚’1-2æ–‡ã§]

## æ”¹å–„ææ¡ˆ
1. [å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³1]
2. [å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³2]
3. [å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³3]

## æ³¨æ„ç‚¹
[æ°—ã‚’ã¤ã‘ã‚‹ã¹ããƒã‚¤ãƒ³ãƒˆã‚’1-2æ–‡ã§]
`;

            try {
                // ãƒ‡ãƒ¢ç”¨ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå®Ÿéš›ã¯Gemini APIã‚’å‘¼ã³å‡ºã—ï¼‰
                await new Promise(resolve => setTimeout(resolve, 2000));

                // ãƒ‡ãƒ¢ç”¨ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹
                const demoResponse = `## ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ
éå»${period1}æ—¥é–“ã§${trend > 0 ? 'å¢—åŠ ' : 'æ¸›å°‘'}å‚¾å‘ã«ã‚ã‚Šã¾ã™ï¼ˆ${trend > 0 ? '+' : ''}${trend}${metric.unit}ã€${trendPercent}%ã®å¤‰åŒ–ï¼‰ã€‚${trend > 0 ? 'é †èª¿ãªãƒšãƒ¼ã‚¹ã§ç›®æ¨™ã«å‘ã‹ã£ã¦ã„ã¾ã™ã€‚' : 'æ”¹å–„ã®ä½™åœ°ãŒã‚ã‚Šã¾ã™ã€‚'}

## ç›®æ¨™é”æˆäºˆæ¸¬
ç¾åœ¨ã®ãƒšãƒ¼ã‚¹ï¼ˆ1æ—¥ã‚ãŸã‚Š${(trend / period1).toFixed(2)}${metric.unit}ï¼‰ã‚’ç¶­æŒã™ã‚Œã°ã€ç´„${Math.ceil((metric.target - data1[data1.length - 1]) / (trend / period1))}æ—¥å¾Œã«ç›®æ¨™é”æˆãŒå¯èƒ½ã§ã™ã€‚ãŸã ã—ã€ä½“èª¿ã‚„ç’°å¢ƒã«ã‚ˆã‚Šå¤‰å‹•ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

## æ”¹å–„ææ¡ˆ
1. **ã‚¿ãƒ³ãƒ‘ã‚¯è³ªæ‘‚å–ã‚’å¢—ã‚„ã™**: ä½“é‡1kgã‚ãŸã‚Š2.0gä»¥ä¸Šã‚’ç›®æŒ‡ã—ã€é¶ã‚€ã­è‚‰ã‚„é­šã‚’æ¯é£Ÿã«å–ã‚Šå…¥ã‚Œã¾ã—ã‚‡ã†
2. **ç­‹ãƒˆãƒ¬é »åº¦ã‚’é€±4-5å›ã«**: BIG3ï¼ˆãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹ã€ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆã€ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆï¼‰ã‚’ä¸­å¿ƒã«é«˜å¼·åº¦ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’å®Ÿæ–½
3. **ç¡çœ æ™‚é–“ã‚’ç¢ºä¿**: ç­‹è‚‰ã®å›å¾©ã¨æˆé•·ã«ã¯7-8æ™‚é–“ã®è³ªã®é«˜ã„ç¡çœ ãŒå¿…é ˆã§ã™

## æ³¨æ„ç‚¹
ãƒ‡ãƒ¼ã‚¿ã®å¤‰å‹•ãŒ${Math.max(...data1) - Math.min(...data1) > 1 ? 'å¤§ãã„' : 'å°ã•ã„'}ãŸã‚ã€${Math.max(...data1) - Math.min(...data1) > 1 ? 'æ¸¬å®šç’°å¢ƒã‚„æ™‚é–“ã‚’çµ±ä¸€ã™ã‚‹ã“ã¨ã§ç²¾åº¦ãŒå‘ä¸Šã—ã¾ã™ã€‚' : 'å®‰å®šã—ãŸãƒšãƒ¼ã‚¹ã‚’ç¶­æŒã§ãã¦ã„ã¾ã™ã€‚'}çŸ­æœŸçš„ãªå¤‰å‹•ã«ä¸€å–œä¸€æ†‚ã›ãšã€é•·æœŸçš„ãªãƒˆãƒ¬ãƒ³ãƒ‰ã«æ³¨ç›®ã—ã¾ã—ã‚‡ã†ã€‚`;

                content.innerHTML = `
                    <div class="prose prose-sm max-w-none">
                        <div class="mb-4 p-3 bg-purple-50 rounded-lg border border-purple-200">
                            <div class="flex items-center gap-2 text-purple-700 font-semibold mb-2">
                                ${metric.icon} ${metric.name} ã®åˆ†æçµæœ
                            </div>
                            <div class="text-xs text-purple-600">
                                æœŸé–“: éå»${period1}æ—¥é–“ | å¤‰åŒ–: ${trend > 0 ? '+' : ''}${trend}${metric.unit} (${trendPercent}%)
                            </div>
                        </div>
                        <div class="whitespace-pre-line text-sm text-gray-700 leading-relaxed">
${demoResponse}
                        </div>
                        <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                            <div class="text-xs text-blue-700">
                                ğŸ’¡ ã“ã®åˆ†æã¯éå»${period1}æ—¥é–“ã®ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦ã„ã¾ã™ã€‚ã‚ˆã‚Šæ­£ç¢ºãªäºˆæ¸¬ã«ã¯ã€30æ—¥é–“ä»¥ä¸Šã®ãƒ‡ãƒ¼ã‚¿è“„ç©ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚
                            </div>
                        </div>
                    </div>
                `;

                // ã‚¢ã‚¤ã‚³ãƒ³ã‚’å†åˆæœŸåŒ–
                lucide.createIcons();

            } catch (error) {
                content.innerHTML = `
                    <div class="text-center py-8">
                        <div class="text-red-600 mb-2">âš ï¸ åˆ†æã«å¤±æ•—ã—ã¾ã—ãŸ</div>
                        <div class="text-sm text-gray-600">${error.message}</div>
                        <button onclick="closeAnalysisModal()" class="mt-4 px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">
                            é–‰ã˜ã‚‹
                        </button>
                    </div>
                `;
            }
        }

        function closeAnalysisModal() {
            document.getElementById('ai-analysis-modal').classList.remove('show');
        }

        // ãƒ˜ãƒ«ãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ«
        function openHelpModal() {
            document.getElementById('help-modal').classList.add('show');
            lucide.createIcons();
        }

        function closeHelpModal() {
            document.getElementById('help-modal').classList.remove('show');
        }

        // ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—
        const tooltipContent = {
            comparison: `
                <div class="text-sm">
                    <div class="font-bold text-blue-600 mb-2">æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰ã¨ã¯ï¼Ÿ</div>
                    <p class="mb-2">2ã¤ã®ã‚°ãƒ©ãƒ•ã‚’åŒæ™‚ã«è¡¨ç¤ºã—ã€ç•°ãªã‚‹æœŸé–“ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¯”è¼ƒã§ãã¾ã™ã€‚</p>
                    <div class="font-semibold mb-1">ä½¿ã„æ–¹:</div>
                    <ul class="text-xs space-y-1 pl-4">
                        <li>â€¢ ãƒã‚§ãƒƒã‚¯ã‚’ONã«ã™ã‚‹ã¨ä¸‹ã«ã‚°ãƒ©ãƒ•ãŒè¿½åŠ è¡¨ç¤º</li>
                        <li>â€¢ ä¸Šä¸‹ã§ç•°ãªã‚‹æœŸé–“ã‚’é¸æŠå¯èƒ½ï¼ˆä¾‹: 7æ—¥ vs 30æ—¥ï¼‰</li>
                        <li>â€¢ çŸ­æœŸã¨é•·æœŸã®ãƒˆãƒ¬ãƒ³ãƒ‰æ¯”è¼ƒã«æœ€é©</li>
                    </ul>
                </div>
            `,
            sync: `
                <div class="text-sm">
                    <div class="font-bold text-purple-600 mb-2">Yè»¸é€£å‹•ã¨ã¯ï¼Ÿ</div>
                    <p class="mb-2">ä¸Šã®ã‚°ãƒ©ãƒ•ã®Yè»¸ç¯„å›²ã‚’å¤‰æ›´ã™ã‚‹ã¨ã€ä¸‹ã®ã‚°ãƒ©ãƒ•ã‚‚è‡ªå‹•ã§åŒã˜ç¯„å›²ã«èª¿æ•´ã•ã‚Œã‚‹æ©Ÿèƒ½ã§ã™ã€‚</p>
                    <div class="font-semibold mb-1">ãƒ¡ãƒªãƒƒãƒˆ:</div>
                    <ul class="text-xs space-y-1 pl-4">
                        <li>â€¢ åŒã˜ã‚¹ã‚±ãƒ¼ãƒ«ã§æ¯”è¼ƒã§ãã‚‹</li>
                        <li>â€¢ æ•°å€¤ã®å¤§å°ã‚’ç›´æ„Ÿçš„ã«æ¯”è¼ƒ</li>
                        <li>â€¢ ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ON/OFFåˆ‡æ›¿å¯èƒ½</li>
                    </ul>
                </div>
            `
        };

        let tooltipTimeout;
        function showTooltip(event, type) {
            clearTimeout(tooltipTimeout);
            const tooltip = document.getElementById('tooltip');
            tooltip.innerHTML = tooltipContent[type];
            tooltip.classList.add('show');

            // ä½ç½®èª¿æ•´
            const rect = event.target.getBoundingClientRect();
            tooltip.style.position = 'fixed';
            tooltip.style.left = rect.left + 'px';
            tooltip.style.top = (rect.bottom + 10) + 'px';
        }

        function hideTooltip() {
            tooltipTimeout = setTimeout(() => {
                document.getElementById('tooltip').classList.remove('show');
            }, 200);
        }

        // æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        function toggleComparisonMode() {
            // ãƒ‘ãƒãƒ«ã¾ãŸã¯ãƒ¡ã‚¤ãƒ³ç”»é¢ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‹ã‚‰çŠ¶æ…‹ã‚’å–å¾—
            const comparisonModePanelElement = document.getElementById('comparison-mode-panel');
            const comparisonModeElement = document.getElementById('comparison-mode');
            const chart2Element = document.getElementById('chart-2');

            if (!chart2Element) {
                console.warn('Chart 2è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }

            // ãƒ‘ãƒãƒ«ã®è¦ç´ ãŒã‚ã‚Œã°ãã¡ã‚‰ã‚’ä½¿ç”¨ã€ãªã‘ã‚Œã°ãƒ¡ã‚¤ãƒ³ã®è¦ç´ ã‚’ä½¿ç”¨
            const checkboxElement = comparisonModePanelElement || comparisonModeElement;
            if (!checkboxElement) {
                console.warn('æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }

            comparisonMode = checkboxElement.checked;

            // ä¸¡æ–¹ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’åŒæœŸ
            if (comparisonModePanelElement) comparisonModePanelElement.checked = comparisonMode;
            if (comparisonModeElement) comparisonModeElement.checked = comparisonMode;

            chart2Element.classList.toggle('hidden', !comparisonMode);

            if (comparisonMode) {
                // æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰ONæ™‚ã€Yè»¸é€£å‹•ãŒONãªã‚‰åŒã˜ç¯„å›²ã‚’é©ç”¨
                if (axisSync && currentAxisRanges[1].min !== null) {
                    const axisMin2Element = document.getElementById('axis-min-2');
                    const axisMax2Element = document.getElementById('axis-max-2');

                    currentAxisRanges[2] = { ...currentAxisRanges[1] };
                    if (axisMin2Element) axisMin2Element.value = currentAxisRanges[1].min;
                    if (axisMax2Element) axisMax2Element.value = currentAxisRanges[1].max;
                }
                updateChart(2);
                updateChart2PeriodButtons();
            }
        }

        // å¤§ã‚«ãƒ†ã‚´ãƒªé¸æŠï¼ˆãƒ‡ãƒ¢ç”¨ - å®Ÿéš›ã«ã¯å„ã‚«ãƒ†ã‚´ãƒªã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤ºï¼‰
        function selectMainCategory(category) {
            currentMainCategory = category;

            // ã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'text-purple-700', 'bg-white', 'border-b-0');
                btn.classList.add('text-gray-600');
            });
            event.currentTarget.classList.add('active', 'text-purple-700', 'bg-white', 'border-b-0');
            event.currentTarget.classList.remove('text-gray-600');

            // å®Ÿéš›ã«ã¯å„ã‚«ãƒ†ã‚´ãƒªã«å¿œã˜ãŸã‚µãƒ–ã‚¿ãƒ–ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
            console.log(`ã‚«ãƒ†ã‚´ãƒª "${category}" ã‚’é¸æŠã—ã¾ã—ãŸï¼ˆãƒ‡ãƒ¢ã§ã¯æœªå®Ÿè£…ï¼‰`);
        }

        // æœŸé–“é¸æŠ
        function selectPeriod(chartNum, days) {
            currentPeriods[chartNum] = days;

            // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            const container = chartNum === 1 ? document.getElementById('chart-1') : document.getElementById('chart-2');
            container.querySelectorAll('.period-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            updateChart(chartNum);

            // ã‚°ãƒ©ãƒ•1ã®æœŸé–“ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã€ã‚°ãƒ©ãƒ•2ã®æœŸé–“ãƒœã‚¿ãƒ³ã‚’æ›´æ–°
            if (chartNum === 1 && comparisonMode) {
                updateChart2PeriodButtons();
            }
        }

        // æœŸé–“ç¯„å›²é¸æŠï¼ˆä»Šé€±ã€å…ˆé€±ã€ä»Šæœˆã€å…ˆæœˆï¼‰
        function selectPeriodRange(chartNum, rangeType) {
            const today = new Date();
            let startDate, endDate, days;

            switch(rangeType) {
                case 'thisWeek':
                    // ä»Šé€±ï¼ˆæœˆæ›œæ—¥ï½æ—¥æ›œæ—¥ï¼‰
                    const dayOfWeek = today.getDay();
                    const diffToMonday = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // æœˆæ›œã‚’é€±ã®é–‹å§‹ã¨ã™ã‚‹
                    startDate = new Date(today);
                    startDate.setDate(today.getDate() - diffToMonday);
                    endDate = today;
                    days = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
                    break;

                case 'lastWeek':
                    // å…ˆé€±ï¼ˆå…ˆé€±ã®æœˆæ›œæ—¥ï½æ—¥æ›œæ—¥ï¼‰
                    const lastWeekEnd = new Date(today);
                    const daysToLastSunday = today.getDay() === 0 ? 0 : today.getDay();
                    lastWeekEnd.setDate(today.getDate() - daysToLastSunday);
                    startDate = new Date(lastWeekEnd);
                    startDate.setDate(lastWeekEnd.getDate() - 6);
                    days = 7;
                    break;

                case 'thisMonth':
                    // ä»Šæœˆï¼ˆ1æ—¥ï½ä»Šæ—¥ï¼‰
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    endDate = today;
                    days = today.getDate();
                    break;

                case 'lastMonth':
                    // å…ˆæœˆï¼ˆå…ˆæœˆã®1æ—¥ï½æœ«æ—¥ï¼‰
                    const lastMonthDate = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                    const lastMonthEnd = new Date(today.getFullYear(), today.getMonth(), 0);
                    days = lastMonthEnd.getDate();
                    break;
            }

            currentPeriods[chartNum] = days;

            // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            const container = chartNum === 1 ? document.getElementById('chart-1') : document.getElementById('chart-2');
            container.querySelectorAll('.period-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.currentTarget.classList.add('active');

            updateChart(chartNum);

            // ã‚°ãƒ©ãƒ•1ã®æœŸé–“ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã€ã‚°ãƒ©ãƒ•2ã®æœŸé–“ãƒœã‚¿ãƒ³ã‚’æ›´æ–°
            if (chartNum === 1 && comparisonMode) {
                updateChart2PeriodButtons();
            }
        }

        // ã‚°ãƒ©ãƒ•2ã®æœŸé–“ãƒœã‚¿ãƒ³ã‚’æ›´æ–°ï¼ˆã‚°ãƒ©ãƒ•1ã¨åŒã˜æœŸé–“ã‚’ç„¡åŠ¹åŒ–ï¼‰
        function updateChart2PeriodButtons() {
            const chart2Container = document.getElementById('chart-2');
            const buttons = chart2Container.querySelectorAll('.period-button');

            buttons.forEach(btn => {
                const btnText = btn.textContent;
                const days = parseInt(btnText);

                if (days === currentPeriods[1]) {
                    btn.disabled = true;
                    btn.classList.add('opacity-50', 'cursor-not-allowed');
                    btn.onclick = null;
                } else {
                    btn.disabled = false;
                    btn.classList.remove('opacity-50', 'cursor-not-allowed');
                    // onclick ã‚’å¾©å…ƒ
                    const dayValue = btnText === '7æ—¥é–“' ? 7 : btnText === '14æ—¥é–“' ? 14 : btnText === '30æ—¥é–“' ? 30 : 90;
                    btn.onclick = () => selectPeriod(2, dayValue);
                }
            });
        }

        // Yè»¸ãƒ¬ãƒ³ã‚¸ã‚’ãƒªã‚»ãƒƒãƒˆ
        function resetAxisRange(chartNum) {
            const axisMinElement = document.getElementById(`axis-min-${chartNum}`);
            const axisMaxElement = document.getElementById(`axis-max-${chartNum}`);

            if (axisMinElement && axisMaxElement) {
                axisMinElement.value = globalMinMax.min;
                axisMaxElement.value = globalMinMax.max;
                updateAxisRange(chartNum);
            }
        }

        // Yè»¸ãƒ¬ãƒ³ã‚¸ã‚’æ›´æ–°
        function updateAxisRange(chartNum) {
            const axisMinElement = document.getElementById(`axis-min-${chartNum}`);
            const axisMaxElement = document.getElementById(`axis-max-${chartNum}`);

            if (!axisMinElement || !axisMaxElement) {
                console.warn(`Yè»¸ãƒ¬ãƒ³ã‚¸è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: chart ${chartNum}`);
                return;
            }

            const min = parseFloat(axisMinElement.value);
            const max = parseFloat(axisMaxElement.value);

            if (!isNaN(min) && !isNaN(max) && min < max) {
                currentAxisRanges[chartNum] = { min, max };

                // ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°
                if (charts[chartNum]) {
                    charts[chartNum].options.scales.y.min = min;
                    charts[chartNum].options.scales.y.max = max;
                    charts[chartNum].update();
                }

                // Yè»¸é€£å‹•ãŒONã§ã€ã‚°ãƒ©ãƒ•1ã®å¤‰æ›´ãªã‚‰ã€ã‚°ãƒ©ãƒ•2ã‚‚åŒæœŸ
                if (axisSync && chartNum === 1 && comparisonMode) {
                    const axisMin2Element = document.getElementById('axis-min-2');
                    const axisMax2Element = document.getElementById('axis-max-2');

                    currentAxisRanges[2] = { min, max };
                    if (axisMin2Element) axisMin2Element.value = min;
                    if (axisMax2Element) axisMax2Element.value = max;

                    if (charts[2]) {
                        charts[2].options.scales.y.min = min;
                        charts[2].options.scales.y.max = max;
                        charts[2].update();
                    }

                    // åŒæœŸã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                    const icon = document.querySelector('.sync-icon');
                    if (icon) {
                        icon.classList.add('syncing');
                        setTimeout(() => icon.classList.remove('syncing'), 1000);
                    }
                    lucide.createIcons();
                }
            }
        }

        // ã‚°ãƒ©ãƒ•æ›´æ–°
        function updateChart(chartNum) {
            const days = currentPeriods[chartNum];
            const data = generateData(days)[currentSubCategory];
            const labels = generateLabels(days);
            const metric = metricInfo[currentSubCategory];

            // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            currentData[chartNum] = data;

            // ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
            document.getElementById(`chart-title-${chartNum}`).textContent = `${metric.icon} ${metric.name}${chartNum === 2 ? ' - æ¯”è¼ƒ' : ''}`;
            document.getElementById(`chart-period-${chartNum}`).textContent = `éå»${days}æ—¥é–“ã®æ¨ç§»`;

            // ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®æœ€ä½å€¤ãƒ»æœ€é«˜å€¤ã‚’è¨ˆç®—ã—ã¦è¡¨ç¤ºï¼ˆå…¨æœŸé–“90æ—¥ï¼‰
            const categoryMinElement = document.getElementById(`category-min-${chartNum}`);
            const categoryMaxElement = document.getElementById(`category-max-${chartNum}`);
            const categoryUnitElement = document.getElementById(`category-unit-${chartNum}`);

            if (categoryMinElement && categoryMaxElement && categoryUnitElement) {
                const fullData = generateData(90)[currentSubCategory];
                const categoryMin = Math.min(...fullData);
                const categoryMax = Math.max(...fullData);
                categoryMinElement.textContent = categoryMin.toFixed(1);
                categoryMaxElement.textContent = categoryMax.toFixed(1);
                categoryUnitElement.textContent = metric.unit;
            }

            // å€¤ã®è¡¨ç¤ºï¼ˆãƒã‚¤ãƒŠãƒªã®å ´åˆã¯å®Œäº†/æœªå®Œäº†ï¼‰
            const currentValue = data[data.length - 1];
            if (metric.isBinary) {
                document.getElementById(`chart-value-${chartNum}`).textContent = currentValue === 1 ? 'âœ“' : 'âœ—';
                document.getElementById(`chart-unit-${chartNum}`).textContent = currentValue === 1 ? 'å®Œäº†' : 'æœªå®Œäº†';
            } else {
                document.getElementById(`chart-value-${chartNum}`).textContent = currentValue.toFixed(1);
                document.getElementById(`chart-unit-${chartNum}`).textContent = metric.unit;
            }

            // çµ±è¨ˆè¨ˆç®—
            if (metric.isBinary) {
                // ãƒã‚¤ãƒŠãƒªãƒ‡ãƒ¼ã‚¿ï¼ˆæŒ‡ç¤ºæ›¸ï¼‰ã®å ´åˆã¯å®Œäº†ç‡ã‚’è¡¨ç¤º
                const completionRate = ((data.reduce((a, b) => a + b, 0) / data.length) * 100).toFixed(0);
                document.getElementById(`stat-avg-${chartNum}`).textContent = completionRate;
                document.getElementById(`stat-avg-unit-${chartNum}`).textContent = '%';
                document.getElementById(`stat-max-${chartNum}`).textContent = data.filter(v => v === 1).length;
                document.getElementById(`stat-max-unit-${chartNum}`).textContent = 'æ—¥';
                document.getElementById(`stat-min-${chartNum}`).textContent = data.filter(v => v === 0).length;
                document.getElementById(`stat-min-unit-${chartNum}`).textContent = 'æ—¥';
            } else {
                const avg = (data.reduce((a, b) => a + b, 0) / data.length).toFixed(1);
                const max = Math.max(...data).toFixed(1);
                const min = Math.min(...data).toFixed(1);

                document.getElementById(`stat-avg-${chartNum}`).textContent = avg;
                document.getElementById(`stat-max-${chartNum}`).textContent = max;
                document.getElementById(`stat-min-${chartNum}`).textContent = min;
                document.getElementById(`stat-avg-unit-${chartNum}`).textContent = metric.unit;
                document.getElementById(`stat-max-unit-${chartNum}`).textContent = metric.unit;
                document.getElementById(`stat-min-unit-${chartNum}`).textContent = metric.unit;
            }

            // Yè»¸ãƒ¬ãƒ³ã‚¸è¨­å®šï¼ˆåˆå›ã®ã¿å…¨æœŸé–“ã®æœ€ä½å€¤ãƒ»æœ€å¤§å€¤ã‚’é©ç”¨ï¼‰
            if (!currentAxisRanges[chartNum].min) {
                currentAxisRanges[chartNum] = { ...globalMinMax };

                // è»¸å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿å€¤ã‚’è¨­å®š
                const axisMinElement = document.getElementById(`axis-min-${chartNum}`);
                const axisMaxElement = document.getElementById(`axis-max-${chartNum}`);
                if (axisMinElement) axisMinElement.value = globalMinMax.min;
                if (axisMaxElement) axisMaxElement.value = globalMinMax.max;
            }

            // ã‚°ãƒ©ãƒ•æç”»
            if (charts[chartNum]) charts[chartNum].destroy();

            const chartType = metric.isBinary ? 'bar' : 'line';

            // ç›®æ¨™ãƒ©ã‚¤ãƒ³ã¨ãƒ¡ãƒ¢ãƒãƒ¼ã‚«ãƒ¼ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
            const chartAnnotations = {};

            // ç›®æ¨™ãƒ©ã‚¤ãƒ³
            const goal = goals[currentSubCategory];
            if (goal && goal.showLine && !metric.isBinary) {
                chartAnnotations.goalLine = {
                    type: 'line',
                    yMin: goal.value,
                    yMax: goal.value,
                    borderColor: 'rgb(34, 197, 94)', // green-500
                    borderWidth: 2,
                    borderDash: [6, 6],
                    label: {
                        display: true,
                        content: `ç›®æ¨™: ${goal.value}${metric.unit}`,
                        position: 'end',
                        backgroundColor: 'rgba(34, 197, 94, 0.8)',
                        color: 'white',
                        font: {
                            size: 11,
                            weight: 'bold'
                        },
                        padding: 4
                    }
                };
            }

            // ãƒ¡ãƒ¢ãƒãƒ¼ã‚«ãƒ¼
            const markers = getAnnotationMarkers(chartNum);
            Object.assign(chartAnnotations, markers);

            const chartConfig = {
                type: chartType,
                data: {
                    labels: labels,
                    datasets: [{
                        label: metric.name,
                        data: data,
                        borderColor: chartNum === 1 ? 'rgb(168, 85, 247)' : 'rgb(59, 130, 246)',
                        backgroundColor: chartNum === 1 ? 'rgba(168, 85, 247, 0.6)' : 'rgba(59, 130, 246, 0.6)',
                        fill: !metric.isBinary,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    onClick: (event) => addAnnotationOnClick(chartNum, event),
                    layout: {
                        padding: {
                            left: 10,
                            right: 20,
                            top: 20,
                            bottom: 10
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = context.formattedValue;
                                    const index = context.dataIndex;
                                    const chartLabel = context.chart.data.labels[index];
                                    const key = `${currentSubCategory}_${chartLabel}`;

                                    if (annotations[key]) {
                                        return [
                                            `${label}: ${value}`,
                                            '',
                                            `ğŸ“ ãƒ¡ãƒ¢: ${annotations[key].note}`
                                        ];
                                    }

                                    return `${label}: ${value}`;
                                }
                            }
                        },
                        annotation: {
                            annotations: chartAnnotations
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: currentAxisRanges[chartNum].min,
                            max: currentAxisRanges[chartNum].max,
                            ticks: metric.isBinary ? {
                                stepSize: 1,
                                callback: function(value) {
                                    return value === 1 ? 'å®Œäº†' : value === 0 ? 'æœªå®Œäº†' : '';
                                }
                            } : {
                                padding: 10,
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                drawBorder: true,
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                padding: 5,
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            };

            charts[chartNum] = new Chart(document.getElementById(`main-chart-${chartNum}`), chartConfig);
        }

        // å°ã‚«ãƒ†ã‚´ãƒªé¸æŠ
        function selectSubCategory(category, subCategory) {
            currentSubCategory = subCategory;

            // å…¨æœŸé–“ã®æœ€ä½å€¤ãƒ»æœ€å¤§å€¤ã‚’å†è¨ˆç®—
            globalMinMax = calculateGlobalMinMax(subCategory);

            // Yè»¸ãƒ¬ãƒ³ã‚¸ã‚’ãƒªã‚»ãƒƒãƒˆ
            currentAxisRanges = { 1: { min: null, max: null }, 2: { min: null, max: null } };

            // ã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.sub-tab-button').forEach(btn => {
                btn.classList.remove('active', 'border-purple-500', 'text-purple-700');
                btn.classList.add('border-transparent', 'text-gray-700');
            });
            event.currentTarget.classList.add('active', 'border-purple-500', 'text-purple-700');
            event.currentTarget.classList.remove('border-transparent', 'text-gray-700');

            updateChart(1);
            if (comparisonMode) {
                updateChart(2);
            }
        }

        // ç›®æ¨™ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
        function loadGoals() {
            try {
                const stored = localStorage.getItem('fitness_goals');
                if (stored) {
                    goals = JSON.parse(stored);
                }
            } catch (error) {
                console.error('ç›®æ¨™ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                goals = {};
            }
        }

        // ç›®æ¨™ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜
        function saveGoalsToStorage() {
            try {
                localStorage.setItem('fitness_goals', JSON.stringify(goals));
            } catch (error) {
                console.error('ç›®æ¨™ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // ç›®æ¨™è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        function openGoalSettingModal() {
            const modal = document.getElementById('goal-setting-modal');
            const metricSelect = document.getElementById('goal-metric');

            // ç¾åœ¨ã®æŒ‡æ¨™ã‚’é¸æŠçŠ¶æ…‹ã«ã™ã‚‹
            metricSelect.value = currentSubCategory;
            updateGoalUnit();

            // æ—¢å­˜ã®ç›®æ¨™ã‚’ãƒ­ãƒ¼ãƒ‰
            loadCurrentGoal();

            modal.classList.add('show');
            lucide.createIcons();
        }

        function closeGoalSettingModal() {
            document.getElementById('goal-setting-modal').classList.remove('show');
        }

        // æŒ‡æ¨™ã«å¿œã˜ã¦å˜ä½ã‚’æ›´æ–°
        document.getElementById('goal-metric')?.addEventListener('change', updateGoalUnit);

        function updateGoalUnit() {
            const metricSelect = document.getElementById('goal-metric');
            const selectedMetric = metricSelect.value;
            const metric = metricInfo[selectedMetric];
            document.getElementById('goal-unit').textContent = metric.unit;
            loadCurrentGoal();
        }

        // ç¾åœ¨ã®ç›®æ¨™ã‚’è¡¨ç¤º
        function loadCurrentGoal() {
            const metricSelect = document.getElementById('goal-metric');
            const selectedMetric = metricSelect.value;
            const goal = goals[selectedMetric];
            const infoDiv = document.getElementById('current-goal-info');
            const textDiv = document.getElementById('current-goal-text');

            if (goal) {
                const metric = metricInfo[selectedMetric];
                let text = `ç›®æ¨™å€¤: ${goal.value}${metric.unit}`;
                if (goal.date) {
                    text += `<br>é”æˆäºˆå®šæ—¥: ${goal.date}`;
                }
                text += `<br>ã‚°ãƒ©ãƒ•è¡¨ç¤º: ${goal.showLine ? 'ON' : 'OFF'}`;

                textDiv.innerHTML = text;
                infoDiv.classList.remove('hidden');

                // ãƒ•ã‚©ãƒ¼ãƒ ã«å€¤ã‚’è¨­å®š
                document.getElementById('goal-value').value = goal.value;
                document.getElementById('goal-date').value = goal.date || '';
                document.getElementById('goal-show-line').checked = goal.showLine;
            } else {
                infoDiv.classList.add('hidden');
                // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
                document.getElementById('goal-value').value = '';
                document.getElementById('goal-date').value = '';
                document.getElementById('goal-show-line').checked = true;
            }
        }

        // ç›®æ¨™ã‚’ä¿å­˜
        function saveGoal() {
            const metricSelect = document.getElementById('goal-metric');
            const selectedMetric = metricSelect.value;
            const value = parseFloat(document.getElementById('goal-value').value);
            const date = document.getElementById('goal-date').value;
            const showLine = document.getElementById('goal-show-line').checked;

            if (isNaN(value) || value <= 0) {
                alert('æœ‰åŠ¹ãªç›®æ¨™å€¤ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            // ç›®æ¨™ã‚’ä¿å­˜
            goals[selectedMetric] = {
                value: value,
                date: date || null,
                showLine: showLine,
                createdAt: new Date().toISOString()
            };

            saveGoalsToStorage();

            // ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°ï¼ˆç›®æ¨™ãƒ©ã‚¤ãƒ³ã‚’è¡¨ç¤ºï¼‰
            updateChart(1);
            if (comparisonMode) {
                updateChart(2);
            }

            alert('ç›®æ¨™ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
            closeGoalSettingModal();
        }

        // ç›®æ¨™ã‚’ã‚¯ãƒªã‚¢
        function clearGoal() {
            const metricSelect = document.getElementById('goal-metric');
            const selectedMetric = metricSelect.value;

            if (goals[selectedMetric]) {
                if (confirm('ã“ã®æŒ‡æ¨™ã®ç›®æ¨™ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                    delete goals[selectedMetric];
                    saveGoalsToStorage();
                    loadCurrentGoal();

                    // ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°
                    updateChart(1);
                    if (comparisonMode) {
                        updateChart(2);
                    }

                    alert('ç›®æ¨™ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
                }
            } else {
                alert('è¨­å®šã•ã‚ŒãŸç›®æ¨™ãŒã‚ã‚Šã¾ã›ã‚“');
            }
        }

        // ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ¡ãƒ¢ï¼‰æ©Ÿèƒ½
        function loadAnnotations() {
            try {
                const stored = localStorage.getItem('fitness_annotations');
                if (stored) {
                    annotations = JSON.parse(stored);
                }
            } catch (error) {
                console.error('ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                annotations = {};
            }
        }

        function saveAnnotations() {
            try {
                localStorage.setItem('fitness_annotations', JSON.stringify(annotations));
            } catch (error) {
                console.error('ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // ã‚°ãƒ©ãƒ•ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã§ãƒ¡ãƒ¢ã‚’è¿½åŠ 
        function addAnnotationOnClick(chartNum, event) {
            const chart = charts[chartNum];
            if (!chart) return;

            const points = chart.getElementsAtEventForMode(event, 'nearest', { intersect: true }, true);

            if (points.length > 0) {
                const point = points[0];
                const dataIndex = point.index;
                const label = chart.data.labels[dataIndex];
                const metric = metricInfo[currentSubCategory];

                // ãƒ¡ãƒ¢ã‚’å…¥åŠ›
                const note = prompt(`${label}ã®ãƒ¡ãƒ¢ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:\nï¼ˆä¾‹: é¢¨é‚ªã§ä¼‘é¤Šã€ãƒãƒ¼ãƒˆãƒ‡ã‚¤ã€ä½“èª¿è‰¯å¥½ï¼‰`);

                if (note && note.trim() !== '') {
                    const key = `${currentSubCategory}_${label}`;
                    annotations[key] = {
                        date: label,
                        note: note.trim(),
                        metric: currentSubCategory,
                        createdAt: new Date().toISOString()
                    };

                    saveAnnotations();
                    updateChart(chartNum);
                    alert('ãƒ¡ãƒ¢ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
                }
            }
        }

        // ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚°ãƒ©ãƒ•ã«è¿½åŠ 
        function getAnnotationMarkers(chartNum) {
            const labels = charts[chartNum]?.data.labels || [];
            const markers = {};

            labels.forEach((label, index) => {
                const key = `${currentSubCategory}_${label}`;
                if (annotations[key]) {
                    markers[`note_${index}`] = {
                        type: 'point',
                        xValue: index,
                        yValue: currentData[chartNum][index],
                        backgroundColor: 'rgba(255, 193, 7, 0.8)', // amber-400
                        borderColor: 'rgb(245, 158, 11)',
                        borderWidth: 2,
                        radius: 8,
                        label: {
                            display: true,
                            content: 'ğŸ“',
                            position: 'top',
                            font: {
                                size: 14
                            }
                        }
                    };
                }
            });

            return markers;
        }

        // ã‚°ãƒ©ãƒ•ãƒ›ãƒãƒ¼æ™‚ã«ãƒ¡ãƒ¢ã‚’è¡¨ç¤º
        function showAnnotationTooltip(chartNum, tooltipItems) {
            if (!tooltipItems || tooltipItems.length === 0) return;

            const index = tooltipItems[0].dataIndex;
            const label = charts[chartNum].data.labels[index];
            const key = `${currentSubCategory}_${label}`;

            if (annotations[key]) {
                return [
                    tooltipItems[0].formattedValue,
                    '',
                    `ğŸ“ ãƒ¡ãƒ¢: ${annotations[key].note}`
                ];
            }

            return tooltipItems[0].formattedValue;
        }

        // ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®šãƒ‘ãƒãƒ«
        let currentPanelChart = 1; // ã©ã®ã‚°ãƒ©ãƒ•ã®è¨­å®šã‚’é–‹ã„ã¦ã„ã‚‹ã‹

        function toggleSettingsPanel(chartNum) {
            const panel = document.getElementById('settings-panel');
            const isHidden = panel.classList.contains('hidden');

            if (isHidden) {
                currentPanelChart = chartNum;
                openSettingsPanel();
            } else {
                closeSettingsPanel();
            }
        }

        function openSettingsPanel() {
            const panel = document.getElementById('settings-panel');
            panel.classList.remove('hidden');

            // ãƒ‘ãƒãƒ«ã®çŠ¶æ…‹ã‚’ç¾åœ¨ã®ã‚°ãƒ©ãƒ•è¨­å®šã«åŒæœŸ
            syncPanelToCurrentSettings();

            // Flatpickrã‚’åˆæœŸåŒ–ï¼ˆãƒ‘ãƒãƒ«ç”¨ï¼‰
            initPanelFlatpickr();

            lucide.createIcons();
        }

        function closeSettingsPanel() {
            document.getElementById('settings-panel').classList.add('hidden');
        }

        function syncPanelToCurrentSettings() {
            // Yè»¸ç¯„å›²ã‚’åŒæœŸ
            const axisMinPanel = document.getElementById('axis-min-panel');
            const axisMaxPanel = document.getElementById('axis-max-panel');
            const comparisonModePanel = document.getElementById('comparison-mode-panel');
            const syncAxisPanel = document.getElementById('sync-axis-panel');

            if (axisMinPanel) axisMinPanel.value = currentAxisRanges[currentPanelChart].min || '';
            if (axisMaxPanel) axisMaxPanel.value = currentAxisRanges[currentPanelChart].max || '';

            // æ¯”è¼ƒãƒ¢ãƒ¼ãƒ‰ã¨Yè»¸é€£å‹•ã‚’åŒæœŸ
            if (comparisonModePanel) comparisonModePanel.checked = comparisonMode;
            if (syncAxisPanel) syncAxisPanel.checked = axisSync;
        }

        function initPanelFlatpickr() {
            if (!flatpickrInstances['panel']) {
                flatpickrInstances['panel'] = {
                    start: flatpickr('#custom-start-panel', {
                        locale: 'ja',
                        dateFormat: 'Y-m-d',
                        maxDate: 'today',
                        onChange: function(selectedDates) {
                            if (flatpickrInstances['panel']?.end) {
                                flatpickrInstances['panel'].end.set('minDate', selectedDates[0]);
                            }
                        }
                    }),
                    end: flatpickr('#custom-end-panel', {
                        locale: 'ja',
                        dateFormat: 'Y-m-d',
                        maxDate: 'today'
                    })
                };
            }
        }

        function applyCustomPeriodFromPanel() {
            const startDate = document.getElementById('custom-start-panel').value;
            const endDate = document.getElementById('custom-end-panel').value;

            if (!startDate || !endDate) {
                alert('é–‹å§‹æ—¥ã¨çµ‚äº†æ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const start = new Date(startDate);
            const end = new Date(endDate);

            if (start > end) {
                alert('é–‹å§‹æ—¥ã¯çµ‚äº†æ—¥ã‚ˆã‚Šå‰ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™');
                return;
            }

            const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;

            if (days > 90) {
                alert('æœ€å¤§90æ—¥é–“ã¾ã§é¸æŠã§ãã¾ã™');
                return;
            }

            currentPeriods[currentPanelChart] = days;

            // æœŸé–“ãƒœã‚¿ãƒ³ã®é¸æŠçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            const container = currentPanelChart === 1 ? document.getElementById('chart-1') : document.getElementById('chart-2');
            container.querySelectorAll('.period-button').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.remove('border-purple-500', 'border-blue-500', 'font-semibold');
                btn.classList.add('border-gray-300');
            });

            updateChart(currentPanelChart);
            alert(`ã‚«ã‚¹ã‚¿ãƒ æœŸé–“ï¼ˆ${days}æ—¥é–“ï¼‰ã‚’é©ç”¨ã—ã¾ã—ãŸ`);
        }

        function updateAxisRangeFromPanel() {
            const min = parseFloat(document.getElementById('axis-min-panel').value);
            const max = parseFloat(document.getElementById('axis-max-panel').value);

            if (!isNaN(min) && !isNaN(max) && min < max) {
                currentAxisRanges[currentPanelChart] = { min, max };

                // ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°
                if (charts[currentPanelChart]) {
                    charts[currentPanelChart].options.scales.y.min = min;
                    charts[currentPanelChart].options.scales.y.max = max;
                    charts[currentPanelChart].update();
                }

                // Yè»¸é€£å‹•ãŒONã§ã€ã‚°ãƒ©ãƒ•1ã®å¤‰æ›´ãªã‚‰ã€ã‚°ãƒ©ãƒ•2ã‚‚åŒæœŸ
                if (axisSync && currentPanelChart === 1 && comparisonMode) {
                    currentAxisRanges[2] = { min, max };
                    if (charts[2]) {
                        charts[2].options.scales.y.min = min;
                        charts[2].options.scales.y.max = max;
                        charts[2].update();
                    }
                }
            }
        }

        function resetAxisRangeFromPanel() {
            document.getElementById('axis-min-panel').value = globalMinMax.min;
            document.getElementById('axis-max-panel').value = globalMinMax.max;
            updateAxisRangeFromPanel();
        }

        // ã‚«ã‚¹ã‚¿ãƒ æœŸé–“é¸æŠæ©Ÿèƒ½
        let flatpickrInstances = {};

        function initFlatpickr() {
            // Flatpickrã‚’æ—¥æœ¬èªã«è¨­å®š
            if (typeof flatpickr !== 'undefined') {
                flatpickr.localize(flatpickr.l10ns.ja);
            }

            // Chart 1ã®FlatpickråˆæœŸåŒ–
            if (!flatpickrInstances[1]) {
                flatpickrInstances[1] = {
                    start: flatpickr('#custom-start-1', {
                        locale: 'ja',
                        dateFormat: 'Y-m-d',
                        maxDate: 'today',
                        onChange: function(selectedDates) {
                            if (flatpickrInstances[1]?.end) {
                                flatpickrInstances[1].end.set('minDate', selectedDates[0]);
                            }
                        }
                    }),
                    end: flatpickr('#custom-end-1', {
                        locale: 'ja',
                        dateFormat: 'Y-m-d',
                        maxDate: 'today'
                    })
                };
            }

            // Chart 2ã®FlatpickråˆæœŸåŒ–
            if (!flatpickrInstances[2]) {
                flatpickrInstances[2] = {
                    start: flatpickr('#custom-start-2', {
                        locale: 'ja',
                        dateFormat: 'Y-m-d',
                        maxDate: 'today',
                        onChange: function(selectedDates) {
                            if (flatpickrInstances[2]?.end) {
                                flatpickrInstances[2].end.set('minDate', selectedDates[0]);
                            }
                        }
                    }),
                    end: flatpickr('#custom-end-2', {
                        locale: 'ja',
                        dateFormat: 'Y-m-d',
                        maxDate: 'today'
                    })
                };
            }
        }

        function toggleCustomPeriod(chartNum) {
            const customPeriodDiv = document.getElementById(`custom-period-${chartNum}`);
            customPeriodDiv.classList.toggle('hidden');

            // åˆå›è¡¨ç¤ºæ™‚ã«Flatpickrã‚’åˆæœŸåŒ–
            if (!customPeriodDiv.classList.contains('hidden')) {
                initFlatpickr();
            }

            lucide.createIcons();
        }

        function applyCustomPeriod(chartNum) {
            const startDate = document.getElementById(`custom-start-${chartNum}`).value;
            const endDate = document.getElementById(`custom-end-${chartNum}`).value;

            if (!startDate || !endDate) {
                alert('é–‹å§‹æ—¥ã¨çµ‚äº†æ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const start = new Date(startDate);
            const end = new Date(endDate);

            if (start > end) {
                alert('é–‹å§‹æ—¥ã¯çµ‚äº†æ—¥ã‚ˆã‚Šå‰ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™');
                return;
            }

            // æ—¥æ•°ã‚’è¨ˆç®—
            const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;

            if (days > 90) {
                alert('æœ€å¤§90æ—¥é–“ã¾ã§é¸æŠã§ãã¾ã™');
                return;
            }

            // ã‚«ã‚¹ã‚¿ãƒ æœŸé–“ã‚’é©ç”¨
            currentPeriods[chartNum] = days;

            // æœŸé–“ãƒœã‚¿ãƒ³ã®é¸æŠçŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            const container = chartNum === 1 ? document.getElementById('chart-1') : document.getElementById('chart-2');
            container.querySelectorAll('.period-button').forEach(btn => {
                btn.classList.remove('active');
            });

            // ã‚«ã‚¹ã‚¿ãƒ æœŸé–“ã®UIã‚’é–‰ã˜ã‚‹
            document.getElementById(`custom-period-${chartNum}`).classList.add('hidden');

            // ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°
            updateChart(chartNum);

            alert(`ã‚«ã‚¹ã‚¿ãƒ æœŸé–“ï¼ˆ${days}æ—¥é–“ï¼‰ã‚’é©ç”¨ã—ã¾ã—ãŸ`);
        }

        // åˆæœŸè¡¨ç¤º
        loadGoals(); // ç›®æ¨™ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        loadAnnotations(); // ãƒ¡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        globalMinMax = calculateGlobalMinMax('lbm');
        updateChart(1);
    </script>
</body>
</html>
