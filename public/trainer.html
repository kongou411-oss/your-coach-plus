<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ãƒãƒ¼ã‚¿ãƒ« - Your Coach+</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-functions-compat.js"></script>
    <script src="/config.js"></script>
    <script src="/js/cq-databases.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif; background: #f0f2f5; color: #333; height: 100vh; overflow: hidden; }
        .cq-header { background: white; border-bottom: 1px solid #e0e0e0; padding: 12px 24px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); z-index: 40; position: relative; }
        .cq-layout { display: flex; height: calc(100vh - 57px); }
        .cq-left { width: 280px; min-width: 280px; background: white; border-right: 1px solid #e0e0e0; display: flex; flex-direction: column; overflow: hidden; }
        .cq-main { flex: 1; overflow-y: auto; padding: 20px; }
        .cq-drawer-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.3); z-index: 45; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
        .cq-drawer-overlay.open { opacity: 1; pointer-events: auto; }
        .cq-drawer { position: fixed; right: 0; top: 0; height: 100vh; width: 540px; background: rgba(255,255,255,0.92); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-left: 1px solid rgba(255,255,255,0.3); box-shadow: -8px 0 30px rgba(0,0,0,0.12); transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.4,0,0.2,1); z-index: 50; display: flex; flex-direction: column; overflow: hidden; }
        .cq-drawer.open { transform: translateX(0); }
        .tpl-card { border: 1px solid #e5e7eb; border-radius: 10px; padding: 10px 12px; margin-bottom: 8px; cursor: pointer; transition: all 0.15s; background: white; }
        .tpl-card:hover { border-color: #5eead4; box-shadow: 0 2px 8px rgba(94,234,212,0.2); }
        .tpl-card-meal { border-left: 3px solid #22c55e; }
        .tpl-card-workout { border-left: 3px solid #3b82f6; }
        .bento-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
        .bento-card { background: white; border-radius: 14px; padding: 16px; box-shadow: 0 1px 4px rgba(0,0,0,0.06); border: 1px solid #e5e7eb; }
        .bento-card-lg { grid-column: span 2; grid-row: span 2; }
        .bento-card-md { grid-column: span 2; }
        .pfc-bar-bg { height: 22px; background: #f3f4f6; border-radius: 11px; overflow: hidden; position: relative; margin-bottom: 8px; }
        .pfc-bar-fill { height: 100%; border-radius: 11px; transition: width 0.4s ease, background-color 0.3s; }
        .pfc-bar-label { position: absolute; left: 8px; top: 50%; transform: translateY(-50%); font-size: 11px; font-weight: 600; color: #374151; z-index: 1; }
        .pfc-bar-value { position: absolute; right: 8px; top: 50%; transform: translateY(-50%); font-size: 10px; color: #6b7280; z-index: 1; }
        .cq-cat-btn { font-size: 11px; padding: 3px 8px; border: 1px solid #d1d5db; border-radius: 9999px; background: white; cursor: pointer; transition: all 0.15s; }
        .cq-cat-btn:hover { background: #fef9c3; border-color: #facc15; }
        .cq-cat-active { background: #fef08a !important; border-color: #eab308 !important; font-weight: 600; }
        .slot-timeline { display: flex; gap: 12px; overflow-x: auto; padding: 8px 0; }
        .slot-card { min-width: 110px; border: 2px solid #e5e7eb; border-radius: 12px; padding: 10px; text-align: center; cursor: pointer; transition: all 0.2s; flex-shrink: 0; }
        .slot-card:hover { border-color: #5eead4; transform: translateY(-2px); }
        .slot-card.assigned { border-color: #22c55e; background: #f0fdf4; }
        .slot-card.selected { border-color: #0d9488; background: #f0fdfa; box-shadow: 0 4px 12px rgba(13,148,136,0.15); }
        .cq-left::-webkit-scrollbar, .cq-main::-webkit-scrollbar, .cq-drawer::-webkit-scrollbar { width: 6px; }
        .cq-left::-webkit-scrollbar-thumb, .cq-main::-webkit-scrollbar-thumb, .cq-drawer::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 3px; }
        .prof-tab { padding: 6px 14px; font-size: 12px; font-weight: 600; border-bottom: 2px solid transparent; cursor: pointer; color: #6b7280; transition: all 0.2s; border-radius: 6px 6px 0 0; }
        .prof-tab.active { border-color: #0d9488; color: #0d9488; background: #f0fdfa; }
        @media (max-width: 1200px) { .bento-grid { grid-template-columns: repeat(2, 1fr); } .bento-card-lg { grid-column: span 2; grid-row: span 1; } }
        @media (max-width: 768px) { .cq-layout { flex-direction: column; } .cq-left { width: 100%; min-width: 100%; max-height: 200px; border-right: none; border-bottom: 1px solid #e0e0e0; } .cq-drawer { width: 100%; } .bento-grid { grid-template-columns: 1fr; } .bento-card-lg, .bento-card-md { grid-column: span 1; } }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="cq-header">
        <div class="flex items-center gap-3">
            <h1 class="text-lg font-bold text-gray-800">ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ãƒãƒ¼ã‚¿ãƒ«</h1>
            <span class="text-xs bg-teal-100 text-teal-700 px-2 py-0.5 rounded-full font-bold"><span id="cq-template-count">0</span>ä»¶</span>
            <span class="text-xs text-teal-600 font-bold" id="trainer-org-label"></span>
        </div>
        <div class="flex items-center gap-3">
            <button onclick="toggleGuide()" class="text-xs bg-gray-100 text-gray-600 px-3 py-1 rounded-lg hover:bg-gray-200 font-bold">? ä½¿ã„æ–¹</button>
            <span class="text-sm text-gray-500" id="user-info"></span>
            <button onclick="logout()" class="text-xs text-red-500 hover:text-red-700">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
    </div>

    <div class="cq-layout">
        <!-- Left Pane: Template Library -->
        <div class="cq-left">
            <div class="p-3 border-b border-gray-200">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-bold text-gray-700">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</span>
                    <button onclick="openDrawer('create')" class="bg-teal-600 text-white text-xs px-3 py-1.5 rounded-lg hover:bg-teal-700 font-bold">+ æ–°è¦</button>
                </div>
                <input type="text" id="cq-tpl-search" placeholder="æ¤œç´¢..." oninput="renderTemplateList()" class="w-full border border-gray-300 rounded-lg px-3 py-1.5 text-sm mb-2">
                <div class="flex gap-1">
                    <button onclick="setLeftFilter('ALL')" class="cq-left-filter text-[10px] px-2 py-1 rounded-full border border-gray-300 cq-cat-active" data-filter="ALL">ALL</button>
                    <button onclick="setLeftFilter('MEAL')" class="cq-left-filter text-[10px] px-2 py-1 rounded-full border border-gray-300" data-filter="MEAL">MEAL</button>
                    <button onclick="setLeftFilter('WORKOUT')" class="cq-left-filter text-[10px] px-2 py-1 rounded-full border border-gray-300" data-filter="WORKOUT">WORKOUT</button>
                    <select id="cq-tpl-sort" onchange="renderTemplateList()" class="text-[10px] border border-gray-300 rounded px-1 py-0.5 ml-auto">
                        <option value="newest">æ–°ã—ã„é †</option><option value="oldest">å¤ã„é †</option><option value="name-asc">åå‰é †</option><option value="cal-desc">Calé«˜ã„é †</option><option value="cal-asc">Calä½ã„é †</option>
                    </select>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto p-3" id="cq-template-list"><div class="text-center text-gray-400 text-sm py-8">èª­ã¿è¾¼ã¿ä¸­...</div></div>
        </div>

        <!-- Main Pane -->
        <div class="cq-main">
            <!-- Client Selection -->
            <div class="bg-white rounded-xl p-4 mb-4 shadow-sm border border-gray-200">
                <div class="flex flex-wrap items-center gap-3 mb-3">
                    <div class="flex-1 min-w-[200px]">
                        <div class="flex gap-2">
                            <select id="cq-client-dropdown" class="flex-1 border border-gray-300 rounded-lg px-3 py-2 text-sm">
                                <option value="">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’é¸æŠ...</option>
                            </select>
                            <button onclick="loadUserSlots()" class="bg-teal-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-teal-700 font-bold">èª­ã¿è¾¼ã¿</button>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <label class="flex items-center gap-1 text-sm cursor-pointer">
                            <input type="checkbox" id="cq-assign-persistent" checked class="rounded">
                            <span class="text-xs font-bold text-yellow-700 bg-yellow-100 px-2 py-0.5 rounded">æ°¸ç¶š</span>
                        </label>
                        <input type="date" id="cq-assign-date" class="border border-gray-300 rounded-lg px-2 py-1.5 text-sm">
                    </div>
                </div>
                <div id="cq-assign-user-info" class="mt-2 text-sm font-bold text-teal-700"></div>
            </div>

            <!-- Bento Grid -->
            <div id="cq-bento-container" class="hidden">
                <div class="bento-grid">
                    <!-- PFC Summary -->
                    <div class="bento-card bento-card-lg" id="bento-pfc">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-bold text-gray-800">PFC ã‚µãƒãƒªãƒ¼</h3>
                            <span class="text-xs text-gray-400" id="pfc-target-label">---</span>
                        </div>
                        <div id="pfc-bars-container"><div class="text-gray-400 text-sm text-center py-4">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„</div></div>
                    </div>
                    <!-- Slot Timeline -->
                    <div class="bento-card bento-card-lg" id="bento-slots">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-gray-800">ã‚¹ãƒ­ãƒƒãƒˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</h3>
                            <button onclick="assignAllSlots()" class="text-[10px] bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 font-bold">ä¸€æ‹¬ä¿å­˜</button>
                        </div>
                        <div id="cq-slot-timeline" class="slot-timeline mb-3"></div>
                        <div id="cq-assign-slot-container"><div class="text-gray-400 text-sm text-center py-2">---</div></div>
                        <input type="hidden" id="cq-assign-slot" value="">
                        <div id="cq-bulk-assign-message" class="mt-1 text-sm"></div>
                        <div id="cq-assign-message" class="mt-1 text-sm"></div>
                    </div>
                    <!-- Profile (unified view + edit) -->
                    <div class="bento-card bento-card-md" id="bento-profile">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-gray-800 text-sm">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</h3>
                            <div class="flex items-center gap-1">
                                <button onclick="switchProfileMode('view')" id="prof-mode-view" class="prof-mode-btn text-[10px] px-2 py-1 rounded font-bold bg-teal-100 text-teal-700">è¡¨ç¤º</button>
                                <button onclick="switchProfileMode('schedule')" id="prof-mode-schedule" class="prof-mode-btn text-[10px] px-2 py-1 rounded font-bold text-gray-500 hover:bg-gray-100">æ™‚åˆ»</button>
                                <button onclick="switchProfileMode('basic')" id="prof-mode-basic" class="prof-mode-btn text-[10px] px-2 py-1 rounded font-bold text-gray-500 hover:bg-gray-100">åŸºæœ¬</button>
                                <button onclick="switchProfileMode('goal')" id="prof-mode-goal" class="prof-mode-btn text-[10px] px-2 py-1 rounded font-bold text-gray-500 hover:bg-gray-100">ç›®æ¨™</button>
                                <button onclick="switchProfileMode('food')" id="prof-mode-food" class="prof-mode-btn text-[10px] px-2 py-1 rounded font-bold text-gray-500 hover:bg-gray-100">é£Ÿæ</button>
                            </div>
                        </div>
                        <!-- View mode -->
                        <div id="cq-profile-view" class="text-xs max-h-[400px] overflow-y-auto">
                            <div id="cq-user-profile-content"><span class="text-gray-400">ãƒ‡ãƒ¼ã‚¿ãªã—</span></div>
                        </div>
                        <!-- Edit modes -->
                        <div id="cq-profile-edit-container" class="hidden">
                            <div id="cq-profile-save-msg" class="hidden text-sm mb-2"></div>
                            <div id="cq-panel-schedule" class="cq-prof-panel hidden">
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <div><label class="block text-xs text-gray-500 mb-1">èµ·åºŠ</label><input type="time" id="cq-prof-wake" value="07:00" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm" onchange="onMealsPerDayChange()"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">å°±å¯</label><input type="time" id="cq-prof-sleep" value="23:00" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm" onchange="onMealsPerDayChange()"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">é£Ÿäº‹å›æ•°</label><input type="number" id="cq-prof-meals" value="5" min="2" max="8" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm" onchange="onMealsPerDayChange()"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">ãƒˆãƒ¬å¾Œé£Ÿäº‹ç•ªå·</label><input type="number" id="cq-prof-training-after" placeholder="ä¾‹:3" min="1" max="8" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm" onchange="toggleTrainingFields();onMealsPerDayChange()"></div>
                                </div>
                                <div id="cq-training-fields" class="hidden mt-3 grid grid-cols-3 gap-3">
                                    <div><label class="block text-xs text-gray-500 mb-1">ãƒˆãƒ¬é–‹å§‹</label><input type="time" id="cq-prof-training-time" value="17:00" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm" onchange="onMealsPerDayChange()"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">ãƒˆãƒ¬æ™‚é–“(åˆ†)</label><input type="number" id="cq-prof-training-dur" value="120" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">ã‚¹ã‚¿ã‚¤ãƒ«</label><select id="cq-prof-style" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"><option value="POWER">ãƒ‘ãƒ¯ãƒ¼</option><option value="PUMP" selected>ãƒ‘ãƒ³ãƒ—</option><option value="MIXED">ãƒŸãƒƒã‚¯ã‚¹</option></select></div>
                                </div>
                            </div>
                            <div id="cq-panel-basic" class="cq-prof-panel hidden">
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <div><label class="block text-xs text-gray-500 mb-1">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </label><input type="text" id="cq-prof-nickname" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">å¹´é½¢</label><input type="number" id="cq-prof-age" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">æ€§åˆ¥</label><select id="cq-prof-gender" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"><option value="MALE">ç”·æ€§</option><option value="FEMALE">å¥³æ€§</option><option value="OTHER">ãã®ä»–</option></select></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">èº«é•·cm</label><input type="number" id="cq-prof-height" step="0.1" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">ä½“é‡kg</label><input type="number" id="cq-prof-weight" step="0.1" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">ä½“è„‚è‚ª%</label><input type="number" id="cq-prof-bodyfat" step="0.1" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">ç†æƒ³ä½“é‡</label><input type="number" id="cq-prof-ideal-weight" step="0.1" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">ç†æƒ³ä½“è„‚è‚ª%</label><input type="number" id="cq-prof-ideal-bodyfat" step="0.1" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                </div>
                            </div>
                            <div id="cq-panel-goal" class="cq-prof-panel hidden">
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                    <div><label class="block text-xs text-gray-500 mb-1">ç›®æ¨™</label><select id="cq-prof-goal" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"><option value="LOSE_WEIGHT">ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ</option><option value="MAINTAIN" selected>ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ»ãƒªã‚³ãƒ³ãƒ—</option><option value="GAIN_MUSCLE">ãƒãƒ«ã‚¯ã‚¢ãƒƒãƒ—</option></select></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">æ´»å‹•ãƒ¬ãƒ™ãƒ«</label><select id="cq-prof-activity" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"><option value="DESK_WORK" selected>ãƒ‡ã‚¹ã‚¯ãƒ¯ãƒ¼ã‚¯</option><option value="STANDING_WORK">ç«‹ã¡ä»•äº‹</option><option value="PHYSICAL_LABOR">è‚‰ä½“åŠ´åƒ</option></select></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">Calèª¿æ•´</label><input type="number" id="cq-prof-cal-adjust" value="0" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">é£Ÿè²»</label><select id="cq-prof-budget" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"><option value="1">ç¯€ç´„</option><option value="2" selected>æ¨™æº–</option><option value="3">ã‚†ã¨ã‚Š</option></select></div>
                                </div>
                                <div class="mt-3 grid grid-cols-3 gap-3">
                                    <div><label class="block text-xs text-gray-500 mb-1">P%</label><input type="number" id="cq-prof-prot-ratio" value="35" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">F%</label><input type="number" id="cq-prof-fat-ratio" value="15" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">C%</label><input type="number" id="cq-prof-carb-ratio" value="50" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                </div>
                                <div class="mt-3"><div class="text-xs font-bold text-gray-600 mb-1">ãƒˆãƒ¬å‰PFC(g)</div><div class="grid grid-cols-3 gap-3"><div><input type="number" id="cq-prof-pre-p" value="20" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm" placeholder="P"></div><div><input type="number" id="cq-prof-pre-f" value="1" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm" placeholder="F"></div><div><input type="number" id="cq-prof-pre-c" value="25" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm" placeholder="C"></div></div></div>
                                <div class="mt-2"><div class="text-xs font-bold text-gray-600 mb-1">ãƒˆãƒ¬å¾ŒPFC(g)</div><div class="grid grid-cols-3 gap-3"><div><input type="number" id="cq-prof-post-p" value="20" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm" placeholder="P"></div><div><input type="number" id="cq-prof-post-f" value="1" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm" placeholder="F"></div><div><input type="number" id="cq-prof-post-c" value="25" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm" placeholder="C"></div></div></div>
                            </div>
                            <div id="cq-panel-food" class="cq-prof-panel hidden">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <div><label class="block text-xs text-gray-500 mb-1">å„ªå…ˆã‚¿ãƒ³ãƒ‘ã‚¯æº</label><input type="text" id="cq-prof-prot-sources" placeholder="é¶ã‚€ã­è‚‰, é®­" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">å„ªå…ˆç‚­æ°´åŒ–ç‰©æº</label><input type="text" id="cq-prof-carb-sources" placeholder="ç™½ç±³, ç„ç±³" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">å„ªå…ˆè„‚è³ªæº</label><input type="text" id="cq-prof-fat-sources" placeholder="ã‚ªãƒªãƒ¼ãƒ–ã‚ªã‚¤ãƒ«" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">é¿ã‘ãŸã„é£Ÿæ</label><input type="text" id="cq-prof-avoid-foods" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼</label><input type="text" id="cq-prof-allergies" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">ã‚ˆãé£Ÿã¹ã‚‹é£Ÿæ</label><input type="text" id="cq-prof-fav-foods" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                    <div><label class="block text-xs text-gray-500 mb-1">NGé£Ÿæ</label><input type="text" id="cq-prof-ng-foods" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                                </div>
                            </div>
                            <div class="flex gap-2 mt-3 pt-3 border-t border-gray-200">
                                <button onclick="resetAllProfileDefaults()" class="text-xs text-gray-500 hover:text-gray-700 px-3 py-1.5 border border-gray-300 rounded-lg">ãƒªã‚»ãƒƒãƒˆ</button>
                                <button onclick="saveUserProfile()" class="bg-green-600 text-white px-4 py-1.5 rounded-lg text-xs hover:bg-green-700 font-bold flex-1">ä¿å­˜</button>
                            </div>
                        </div>
                    </div>
                    <!-- Routine -->
                    <div class="bento-card bento-card-md">
                        <h3 class="font-bold text-gray-800 text-sm mb-2">ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³</h3>
                        <div id="cq-user-routine-content" class="text-xs max-h-[300px] overflow-y-auto"><span class="text-gray-400">ãƒ‡ãƒ¼ã‚¿ãªã—</span></div>
                    </div>
                    <!-- User Templates -->
                    <div class="bento-card bento-card-md">
                        <h3 class="font-bold text-gray-800 text-sm mb-2" id="cq-info-tab-templates">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</h3>
                        <div id="cq-user-templates-content" class="text-xs max-h-[300px] overflow-y-auto"><span class="text-gray-400">ãƒ‡ãƒ¼ã‚¿ãªã—</span></div>
                    </div>
                    <!-- Assignment History -->
                    <div class="bento-card bento-card-md">
                        <h3 class="font-bold text-gray-800 text-sm mb-2" id="cq-assign-list-title">å‰²å½“å±¥æ­´</h3>
                        <div id="cq-assign-list" class="text-xs max-h-[300px] overflow-y-auto"><span class="text-gray-400">ãƒ‡ãƒ¼ã‚¿ãªã—</span></div>
                    </div>
                    <!-- Meal History -->
                    <div class="bento-card bento-card-md">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-gray-800 text-sm">ğŸ½ é£Ÿäº‹å±¥æ­´</h3>
                            <div class="flex items-center gap-1">
                                <button onclick="shiftMealDate(-1)" class="text-[10px] bg-gray-100 hover:bg-gray-200 text-gray-600 px-2 py-1 rounded font-bold">â—€</button>
                                <span id="meal-history-date-label" class="text-[11px] font-bold text-teal-700 px-2 min-w-[40px] text-center">ä»Šæ—¥</span>
                                <button onclick="shiftMealDate(1)" id="meal-history-fwd-btn" class="text-[10px] bg-gray-100 hover:bg-gray-200 text-gray-600 px-2 py-1 rounded font-bold" disabled style="opacity:0.3">â–¶</button>
                                <input type="date" id="meal-history-date-picker" onchange="onMealDatePick(this.value)" class="text-[10px] border border-gray-300 rounded px-1 py-0.5 ml-1 w-[110px]">
                            </div>
                        </div>
                        <div id="meal-history-content" class="text-xs max-h-[400px] overflow-y-auto"><span class="text-gray-400">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</span></div>
                    </div>
                    <!-- Condition Records -->
                    <div class="bento-card bento-card-md">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="font-bold text-gray-800 text-sm">ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³è¨˜éŒ²</h3>
                            <select id="cq-condition-days" onchange="loadConditionRecords()" class="text-[10px] border border-gray-300 rounded px-2 py-0.5">
                                <option value="7">7æ—¥é–“</option>
                                <option value="14">14æ—¥é–“</option>
                                <option value="30" selected>30æ—¥é–“</option>
                            </select>
                        </div>
                        <div id="cq-condition-content" class="text-xs max-h-[350px] overflow-y-auto"><span class="text-gray-400">ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„</span></div>
                    </div>
                </div>
            </div>

            <!-- Custom Items Panel (hidden by default) -->
            <div id="cq-user-panels" class="hidden mt-4 bg-white rounded-xl p-4 shadow-sm border border-gray-200">
                <h3 class="font-bold text-gray-800 text-sm mb-2" id="cq-info-tab-custom">ã‚«ã‚¹ã‚¿ãƒ ã‚¢ã‚¤ãƒ†ãƒ </h3>
                <div id="cq-user-custom-items-content" class="text-xs max-h-[300px] overflow-y-auto"><span class="text-gray-400">ãƒ‡ãƒ¼ã‚¿ãªã—</span></div>
            </div>
        </div>
    </div>

    <!-- Drawer Overlay -->
    <div class="cq-drawer-overlay" id="cq-drawer-overlay" onclick="closeDrawer()"></div>
    <!-- Glassmorphism Drawer -->
    <div class="cq-drawer" id="cq-drawer">
        <div class="p-4 border-b border-gray-200 flex items-center justify-between">
            <h2 class="font-bold text-gray-800" id="cq-drawer-title">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ</h2>
            <button onclick="closeDrawer()" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
        </div>
        <div class="flex-1 overflow-y-auto p-4">
            <div class="mb-3"><label class="block text-sm font-bold mb-1">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå</label><input type="text" id="cq-tpl-title" placeholder="ä¾‹: ã€æ¸›é‡ã€‘å®šç•ªã®æœé£Ÿã‚»ãƒƒãƒˆ" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm"></div>
            <div class="mb-3"><label class="block text-sm font-bold mb-1">ã‚¿ã‚¤ãƒ—</label><select id="cq-tpl-type" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm" onchange="onTemplateTypeChange()"><option value="MEAL">MEAL</option><option value="WORKOUT">WORKOUT</option></select></div>
            <div class="flex flex-wrap gap-1 mb-3" id="cq-category-tabs"></div>
            <!-- Meal inputs -->
            <div id="cq-meal-inputs">
                <div class="flex gap-2 items-end mb-2">
                    <div class="flex-1"><label class="block text-xs text-gray-500 mb-1" id="cq-tpl-item-label">é£Ÿå“å</label><div class="relative"><input type="text" id="cq-tpl-food-search" placeholder="é£Ÿå“åã§æ¤œç´¢..." class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm" oninput="filterFoodList()" onfocus="showFoodDropdown()" autocomplete="off"><div id="cq-food-dropdown" class="absolute z-50 w-full bg-white border border-gray-300 rounded-lg mt-1 max-h-48 overflow-y-auto hidden shadow-lg"></div></div></div>
                    <div style="width:75px"><label class="block text-xs text-gray-500 mb-1">é‡</label><input type="number" id="cq-tpl-food-amount" placeholder="100" min="0" step="0.1" class="w-full border border-gray-300 rounded-lg px-2 py-2 text-sm"></div>
                    <div style="width:65px"><label class="block text-xs text-gray-500 mb-1">å˜ä½</label><select id="cq-tpl-food-unit" class="w-full border border-gray-300 rounded-lg px-1 py-2 text-sm"><option value="g">g</option><option value="å€‹">å€‹</option><option value="ml">ml</option><option value="æ¯">æ¯</option><option value="æš">æš</option><option value="æœ¬">æœ¬</option><option value="ä¸">ä¸</option><option value="ç²’">ç²’</option></select></div>
                    <button onclick="addTemplateItem()" class="bg-blue-500 text-white px-3 py-2 rounded-lg text-sm hover:bg-blue-600 font-bold">+</button>
                </div>
            </div>
            <!-- Workout inputs -->
            <div id="cq-workout-inputs" class="hidden">
                <div class="flex gap-2 items-end mb-2">
                    <div class="flex-1"><label class="block text-xs text-gray-500 mb-1">ç¨®ç›®å</label><div class="relative"><input type="text" id="cq-tpl-exercise-search" placeholder="ç¨®ç›®åã§æ¤œç´¢..." class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm" oninput="filterFoodList()" onfocus="showFoodDropdown()" autocomplete="off"><div id="cq-exercise-dropdown" class="absolute z-50 w-full bg-white border border-gray-300 rounded-lg mt-1 max-h-48 overflow-y-auto hidden shadow-lg"></div></div></div>
                    <button onclick="addTemplateItem()" class="bg-blue-500 text-white px-3 py-2 rounded-lg text-sm hover:bg-blue-600 font-bold">+</button>
                </div>
                <div id="cq-strength-fields" class="flex flex-wrap gap-2 mt-2">
                    <div style="width:75px"><label class="block text-xs text-gray-500 mb-1">ã‚»ãƒƒãƒˆ</label><input type="number" id="cq-ex-sets" placeholder="3" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                    <div style="width:75px"><label class="block text-xs text-gray-500 mb-1">å›æ•°</label><input type="number" id="cq-ex-reps" placeholder="10" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                    <div style="width:75px"><label class="block text-xs text-gray-500 mb-1">é‡é‡kg</label><input type="number" id="cq-ex-weight" placeholder="60" step="0.5" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                    <div style="width:75px"><label class="block text-xs text-gray-500 mb-1">åˆ†</label><input type="number" id="cq-ex-duration-strength" placeholder="15" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                </div>
                <div id="cq-rm-fields" class="flex gap-2 mt-2">
                    <div style="width:85px"><label class="block text-xs text-gray-500 mb-1">1RM%ä¸‹é™</label><input type="number" id="cq-ex-rm-min" placeholder="70" max="100" step="5" class="w-full border border-orange-300 rounded px-2 py-1.5 text-sm"></div>
                    <div style="width:85px"><label class="block text-xs text-gray-500 mb-1">1RM%ä¸Šé™</label><input type="number" id="cq-ex-rm-max" placeholder="80" max="100" step="5" class="w-full border border-orange-300 rounded px-2 py-1.5 text-sm"></div>
                </div>
                <div id="cq-cardio-fields" class="hidden flex gap-2 mt-2">
                    <div style="width:75px"><label class="block text-xs text-gray-500 mb-1">åˆ†</label><input type="number" id="cq-ex-duration-cardio" placeholder="30" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                    <div style="width:85px"><label class="block text-xs text-gray-500 mb-1">è·é›¢km</label><input type="number" id="cq-ex-distance" placeholder="5" step="0.1" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                </div>
                <div id="cq-stretch-fields" class="hidden flex gap-2 mt-2">
                    <div style="width:75px"><label class="block text-xs text-gray-500 mb-1">åˆ†</label><input type="number" id="cq-ex-duration-stretch" placeholder="10" class="w-full border border-gray-300 rounded px-2 py-1.5 text-sm"></div>
                </div>
            </div>
            <div class="mt-3"><label class="block text-sm font-bold mb-1">è¿½åŠ æ¸ˆã¿ã‚¢ã‚¤ãƒ†ãƒ </label><div id="cq-tpl-item-list" class="border border-dashed border-gray-300 rounded-lg p-3 min-h-[50px] text-sm text-gray-400">ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</div></div>
            <div id="cq-tpl-message" class="mt-2 text-sm"></div>
        </div>
        <div class="p-4 border-t border-gray-200">
            <button onclick="handleDrawerSave()" id="cq-drawer-save-btn" class="w-full bg-teal-600 text-white py-2.5 rounded-lg font-bold hover:bg-teal-700 transition">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜</button>
        </div>
    </div>

    <!-- Usage Guide Modal -->
    <div id="cq-guide-overlay" class="fixed inset-0 bg-black/40 z-[60] hidden" onclick="toggleGuide()"></div>
    <div id="cq-guide-modal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[720px] max-w-[90vw] max-h-[85vh] bg-white rounded-2xl shadow-2xl z-[61] hidden flex flex-col">
        <div class="flex items-center justify-between p-5 border-b border-gray-200">
            <h2 class="text-lg font-bold text-gray-800">ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ãƒãƒ¼ã‚¿ãƒ« â€” ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰</h2>
            <button onclick="toggleGuide()" class="text-gray-400 hover:text-gray-600 text-2xl leading-none">&times;</button>
        </div>
        <div class="flex-1 overflow-y-auto p-5 text-sm text-gray-700 leading-relaxed space-y-6">
            <!-- Step 1 -->
            <section>
                <h3 class="font-bold text-base text-green-700 mb-2">Step 1: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã™ã‚‹</h3>
                <div class="bg-green-50 rounded-lg p-3 space-y-2">
                    <p>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã€Œé£Ÿäº‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ã¾ãŸã¯ã€Œé‹å‹•ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ã®é››å½¢ã§ã™ã€‚1å›åˆ†ã®çŒ®ç«‹ã‚„1ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ†ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’ç™»éŒ²ã—ã¾ã™ã€‚</p>
                    <ol class="list-decimal pl-5 space-y-1">
                        <li>å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ä¸Šéƒ¨ã® <span class="bg-teal-600 text-white text-xs px-2 py-0.5 rounded font-bold">+ æ–°è¦</span> ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                        <li>å³å´ã«ç·¨é›†ãƒ‘ãƒãƒ«ãŒé–‹ãã®ã§ <strong>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå</strong> ã‚’å…¥åŠ›ï¼ˆä¾‹: ã€æ¸›é‡ã€‘æœé£Ÿã‚»ãƒƒãƒˆï¼‰</li>
                        <li><strong>ã‚¿ã‚¤ãƒ—</strong> ã‚’ MEALï¼ˆé£Ÿäº‹ï¼‰ or WORKOUTï¼ˆé‹å‹•ï¼‰ã‹ã‚‰é¸æŠ</li>
                        <li><strong>ã‚«ãƒ†ã‚´ãƒªã‚¿ãƒ–</strong> ã§é£Ÿå“/ç¨®ç›®ã‚’çµã‚Šè¾¼ã¿ã€æ¤œç´¢æ¬„ã§ç´ æ—©ãè¦‹ã¤ã‘ã‚‹</li>
                        <li>ã‚¢ã‚¤ãƒ†ãƒ ã‚’ <span class="bg-blue-500 text-white text-xs px-2 py-0.5 rounded font-bold">+</span> ã§è¿½åŠ ã€‚è¿½åŠ å¾Œã‚‚é‡ãƒ»å˜ä½ãƒ»ã‚»ãƒƒãƒˆæ•°ç­‰ã‚’ç›´æ¥ç·¨é›†å¯</li>
                        <li><span class="bg-teal-600 text-white text-xs px-2 py-0.5 rounded font-bold">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä¿å­˜</span> ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                    </ol>
                    <div class="text-xs text-gray-500 mt-1">ä½œæˆã—ãŸãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯è‡ªç¤¾å°‚ç”¨ã¨ã—ã¦ä¿å­˜ã•ã‚Œã¾ã™ã€‚å…±é€šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚‚åˆ©ç”¨å¯èƒ½ã§ã™ã€‚</div>
                </div>
            </section>

            <!-- Step 2 -->
            <section>
                <h3 class="font-bold text-base text-blue-700 mb-2">Step 2: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’é¸æŠã™ã‚‹</h3>
                <div class="bg-blue-50 rounded-lg p-3 space-y-2">
                    <ol class="list-decimal pl-5 space-y-1">
                        <li>ä¸­å¤®ã‚¨ãƒªã‚¢ä¸Šéƒ¨ã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‹ã‚‰ <strong>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ</strong> ã‚’é¸æŠ</li>
                        <li><span class="bg-teal-600 text-white text-xs px-2 py-0.5 rounded font-bold">èª­ã¿è¾¼ã¿</span> ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                        <li>ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ»ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ãƒ»PFCã‚µãƒãƒªãƒ¼ãƒ»ã‚¹ãƒ­ãƒƒãƒˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹</li>
                    </ol>
                    <div class="text-xs text-gray-500 mt-1">ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã«ã¯è‡ªç¤¾æ‰€å±ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã¿è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
                </div>
            </section>

            <!-- Step 3 -->
            <section>
                <h3 class="font-bold text-base text-orange-700 mb-2">Step 3: ã‚¹ãƒ­ãƒƒãƒˆã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å‰²ã‚Šå½“ã¦ã‚‹</h3>
                <div class="bg-orange-50 rounded-lg p-3 space-y-2">
                    <p>ã‚¹ãƒ­ãƒƒãƒˆï¼1æ—¥ã®é£Ÿäº‹ãƒ»é‹å‹•æ ã§ã™ã€‚ä¾‹: 5é£Ÿ+1ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚° ï¼ 6ã‚¹ãƒ­ãƒƒãƒˆã€‚</p>
                    <ol class="list-decimal pl-5 space-y-1">
                        <li><strong>ã‚¹ãƒ­ãƒƒãƒˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</strong> ã®å„ã‚«ãƒ¼ãƒ‰ã«ã‚ã‚‹ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‹ã‚‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠ</li>
                        <li>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠæ™‚ã€ã‚«ãƒ­ãƒªãƒ¼ãŒã‚¹ãƒ­ãƒƒãƒˆç›®æ¨™ã«è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã•ã‚Œã‚‹ï¼ˆé£Ÿäº‹ã®ã¿ï¼‰</li>
                        <li>PFCã‚µãƒãƒªãƒ¼ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ›´æ–° â€” éä¸è¶³ã‚’ãƒãƒ¼ã§ç¢ºèª</li>
                        <li>å…¨ã‚¹ãƒ­ãƒƒãƒˆè¨­å®šå¾Œã€<span class="bg-green-600 text-white text-xs px-2 py-0.5 rounded font-bold">ä¸€æ‹¬ä¿å­˜</span> ã§ä¿å­˜</li>
                    </ol>
                    <div class="mt-2 text-xs">
                        <div class="font-bold text-gray-600 mb-1">æ°¸ç¶š / æ—¥ä»˜æŒ‡å®šã®é•ã„:</div>
                        <ul class="list-disc pl-5 space-y-0.5 text-gray-600">
                            <li><span class="bg-yellow-100 text-yellow-800 text-[10px] px-1.5 py-0.5 rounded font-bold">æ°¸ç¶š</span> â€” æ¯æ—¥é©ç”¨ã•ã‚Œã‚‹ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ—ãƒ©ãƒ³ï¼ˆ_default ã¨ã—ã¦ä¿å­˜ï¼‰</li>
                            <li><span class="text-[10px]">æ—¥ä»˜æŒ‡å®š</span> â€” ç‰¹å®šæ—¥ã®ã¿ä¸Šæ›¸ãï¼ˆãã®æ—¥ã ã‘ã®ç‰¹åˆ¥ãƒ—ãƒ©ãƒ³ï¼‰</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Step 4 -->
            <section>
                <h3 class="font-bold text-base text-red-700 mb-2">Step 4: PFCãƒãƒ¼ã®è¦‹æ–¹</h3>
                <div class="bg-red-50 rounded-lg p-3 space-y-2">
                    <p>PFCã‚µãƒãƒªãƒ¼ã®å„ãƒãƒ¼ã¯ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ç›®æ¨™ã«å¯¾ã™ã‚‹å‰²å½“é‡ã®å‰²åˆã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>
                    <div class="grid grid-cols-2 gap-2 text-xs mt-1">
                        <div class="flex items-center gap-2"><span class="inline-block w-4 h-4 rounded" style="background:#0d9488"></span> <strong>ãƒ†ã‚£ãƒ¼ãƒ« (95-105%)</strong>: ç›®æ¨™é”æˆ</div>
                        <div class="flex items-center gap-2"><span class="inline-block w-4 h-4 rounded" style="background:#f97316"></span> <strong>ã‚ªãƒ¬ãƒ³ã‚¸ (&lt;95%)</strong>: ã‚„ã‚„ä¸è¶³</div>
                        <div class="flex items-center gap-2"><span class="inline-block w-4 h-4 rounded" style="background:#ef4444"></span> <strong>èµ¤ (&lt;70%)</strong>: å¤§å¹…ä¸è¶³</div>
                        <div class="flex items-center gap-2"><span class="inline-block w-4 h-4 rounded" style="background:#8b5cf6"></span> <strong>ç´« (&gt;105%)</strong>: è¶…é</div>
                    </div>
                </div>
            </section>

            <!-- Theory / Coaching Reference -->
            <section>
                <h3 class="font-bold text-base text-teal-700 mb-2">ã‚³ãƒ¼ãƒãƒ³ã‚°ãƒ»ã‚»ã‚ªãƒªãƒ¼</h3>
                <div class="space-y-3">
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 text-xs">
                        <div class="font-bold text-yellow-800 mb-1">åŸºæœ¬å“²å­¦</div>
                        <ul class="space-y-0.5 text-gray-700 list-disc pl-4">
                            <li><strong>é£Ÿã¹ãªã‘ã‚Œã°èº«ä½“ã¯ä½œã‚Œãªã„</strong> â€” ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã¯ãã£ã‹ã‘ã€èº«ä½“ã‚’ä½œã‚‹ã®ã¯é£Ÿäº‹</li>
                            <li><strong>365æ—¥ã®ç¶™ç¶š</strong> â€” ã‚ªãƒ³ãƒ»ã‚ªãƒ•ã‚’ä½œã‚‰ãšæ·¡ã€…ã¨ç¶šã‘ã‚‹</li>
                            <li><strong>å¤–é£Ÿã‚ˆã‚Šè‡ªç‚Š</strong> â€” è¦‹ãˆãªã„è„‚è³ªãƒ»èª¿å‘³æ–™ã‚’æ’é™¤</li>
                        </ul>
                    </div>
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 text-xs">
                        <div class="font-bold text-blue-800 mb-1">PFCæˆ¦ç•¥ â€” P35% F15% C50%</div>
                        <div class="grid grid-cols-3 gap-2 mt-1">
                            <div class="text-center bg-red-50 rounded p-1.5"><div class="font-bold text-red-700">P = ã‚¨ãƒ³ã‚¸ãƒ³</div><div class="text-gray-600">ç­‹è‚‰ã®ææ–™ / æœ€é‡è¦</div></div>
                            <div class="text-center bg-amber-50 rounded p-1.5"><div class="font-bold text-amber-700">C = ã‚¬ã‚½ãƒªãƒ³</div><div class="text-gray-600">ç­‹è‚‰ã‚’å‹•ã‹ã™ / æŠœãã¨ãƒãƒªå–ªå¤±</div></div>
                            <div class="text-center bg-gray-100 rounded p-1.5"><div class="font-bold text-gray-600">F = æœ€å°é™</div><div class="text-gray-500">9kcal/gã§éå‰°æ³¨æ„ / å¿…é ˆè„‚è‚ªé…¸ã¯ã‚µãƒ—ãƒªã§</div></div>
                        </div>
                    </div>
                    <div class="bg-green-50 border border-green-200 rounded-lg p-3 text-xs">
                        <div class="font-bold text-green-800 mb-1">GIã‚¿ã‚¤ãƒŸãƒ³ã‚°æˆ¦ç•¥</div>
                        <table class="w-full text-[11px]">
                            <thead><tr class="border-b border-green-300"><th class="text-left py-0.5">ã‚¿ã‚¤ãƒŸãƒ³ã‚°</th><th class="text-left py-0.5">GI</th><th class="text-left py-0.5">æ¨å¥¨é£Ÿæ</th><th class="text-left py-0.5">ç†ç”±</th></tr></thead>
                            <tbody>
                                <tr class="border-b border-green-100"><td class="py-0.5"><span class="bg-red-100 text-red-700 px-1 rounded text-[10px] font-bold">ãƒˆãƒ¬ç›´å¾Œ</span></td><td class="font-bold text-red-600">é«˜GI</td><td>ãƒãƒ«ãƒˆãƒ‡ã‚­ã‚¹ãƒˆãƒªãƒ³ã€ç™½ç±³ï¼ˆç‚Šé£¯ç›´å¾Œï¼‰ã€ã‚‚ã¡ã€ãƒãƒŠãƒŠ</td><td>ã‚¤ãƒ³ã‚¹ãƒªãƒ³â†’ç­‹è‚‰ã¸æ€¥é€Ÿãƒ‡ãƒªãƒãƒªãƒ¼</td></tr>
                                <tr class="border-b border-green-100"><td class="py-0.5"><span class="bg-orange-100 text-orange-700 px-1 rounded text-[10px] font-bold">ãƒˆãƒ¬å‰</span></td><td class="font-bold text-blue-600">ä½GI</td><td>ç™½ç±³ï¼ˆå†·ã‚„ã”é£¯ãƒ»å†åŠ ç†±ï¼‰ã€ã‚ªãƒ¼ãƒˆãƒŸãƒ¼ãƒ«ã€ã•ã¤ã¾ã„ã‚‚ + ä½è„‚è³ª</td><td>æ¶ˆåŒ–é…å»¶é˜²æ­¢ï¼†æŒç¶šã‚¨ãƒãƒ«ã‚®ãƒ¼</td></tr>
                                <tr class="border-b border-green-100"><td class="py-0.5"><span class="bg-gray-200 text-gray-700 px-1 rounded text-[10px] font-bold">é€šå¸¸é£Ÿ</span></td><td class="font-bold text-blue-600">ä½GI</td><td>ç™½ç±³ï¼ˆå†·ã‚„ã”é£¯ãƒ»å†åŠ ç†±ï¼‰ã€ç„ç±³ã€ã‚ªãƒ¼ãƒˆãƒŸãƒ¼ãƒ«ã€ãã°</td><td>è¡€ç³–å®‰å®šï¼†ä½“è„‚è‚ªåŒ–é˜²æ­¢</td></tr>
                                <tr><td class="py-0.5" colspan="4"><span class="text-[10px] text-gray-500">å†·å´ã§ãƒ¬ã‚¸ã‚¹ã‚¿ãƒ³ãƒˆã‚¹ã‚¿ãƒ¼ãƒç”Ÿæˆï¼ˆRS: 0.64â†’1.65g/100gï¼‰ã€‚å†åŠ ç†±ã—ã¦ã‚‚RSã¯ç¶­æŒã•ã‚ŒGIä½ä¸‹ï¼ˆ88â†’65ï¼‰ã€‚ç‚Šé£¯ç›´å¾Œã¯ãƒˆãƒ¬ç›´å¾Œå°‚ç”¨</span></td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="bg-teal-50 border border-teal-200 rounded-lg p-3 text-xs">
                        <div class="font-bold text-teal-800 mb-1">ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ³•ï¼ˆç‚­æ°´åŒ–ç‰©é‡ã®èª¿æ•´ï¼‰</div>
                        <ol class="space-y-0.5 text-gray-700 list-decimal pl-4">
                            <li>åŸºæº–é‡ï¼ˆãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ï¼‰ã‚’æ±ºã‚ã¦1é€±é–“é£Ÿã¹ã‚‹</li>
                            <li>ä½“é‡å¢—åŠ  â†’ ç‚­æ°´åŒ–ç‰©ã‚’åŠåˆ†ã«æ¸›ã‚‰ã™</li>
                            <li>ä½“é‡æ¸›å°‘ã—ã™ã â†’ ç‚­æ°´åŒ–ç‰©ã‚’å€ã«å¢—ã‚„ã™</li>
                            <li>å¾®èª¿æ•´ã‚’ç¹°ã‚Šè¿”ã—ã€ä½“è„‚è‚ªãŒå¢—ãˆãªã„ã‚®ãƒªã‚®ãƒªã®ãƒ©ã‚¤ãƒ³ã‚’æ¢ã™</li>
                        </ol>
                        <div class="mt-1 text-gray-500 italic">ã€Œæ¸›ã‚‰ã—ã™ããªã„ã€â€” ä»£è¬ã‚’è½ã¨ã•ãšç­‹è‚‰ã®ãƒãƒªã‚’ä¿ã¤</div>
                    </div>
                </div>
            </section>

            <!-- Editing Templates -->
            <section>
                <h3 class="font-bold text-base text-indigo-700 mb-2">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ç·¨é›†ãƒ»è¤‡è£½ãƒ»å‰Šé™¤</h3>
                <div class="bg-indigo-50 rounded-lg p-3 space-y-1 text-xs">
                    <p>å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚«ãƒ¼ãƒ‰ã«ã‚«ãƒ¼ã‚½ãƒ«ã‚’å½“ã¦ã‚‹ã¨ã€æ“ä½œãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                    <ul class="list-disc pl-5 space-y-0.5">
                        <li><strong>ç·¨é›†</strong> â€” å³å´ã«ç·¨é›†ãƒ‘ãƒãƒ«ãŒé–‹ãã€åå‰ãƒ»ã‚¢ã‚¤ãƒ†ãƒ ã®å¤‰æ›´ãŒå¯èƒ½</li>
                        <li><strong>è¤‡è£½</strong> â€” åŒã˜å†…å®¹ã§æ–°ã—ã„ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆ</li>
                        <li><strong>å‰Šé™¤</strong> â€” è‡ªç¤¾ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã¿å‰Šé™¤å¯èƒ½ï¼ˆå…±é€šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯å‰Šé™¤ä¸å¯ï¼‰</li>
                    </ul>
                </div>
            </section>

            <!-- Profile -->
            <section>
                <h3 class="font-bold text-base text-amber-700 mb-2">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</h3>
                <div class="bg-amber-50 rounded-lg p-3 space-y-1 text-xs">
                    <p>ä¸­å¤®ã‚¨ãƒªã‚¢ã€Œãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã€ã‚«ãƒ¼ãƒ‰å³ä¸Šã®ã‚¿ãƒ–ã§è¡¨ç¤ºã¨ç·¨é›†ã‚’åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚</p>
                    <ul class="list-disc pl-5 space-y-0.5">
                        <li><strong>è¡¨ç¤º</strong> â€” ç¾åœ¨ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã‚’ç¢ºèªï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰</li>
                        <li><strong>æ™‚åˆ»</strong> â€” èµ·åºŠ/å°±å¯/é£Ÿäº‹å›æ•°/ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ™‚é–“å¸¯</li>
                        <li><strong>åŸºæœ¬</strong> â€” èº«é•·/ä½“é‡/ä½“è„‚è‚ªç‡/ç†æƒ³ä½“å‹</li>
                        <li><strong>ç›®æ¨™</strong> â€” æ¸›é‡/ç¶­æŒ/å¢—é‡ + PFCæ¯”ç‡ + ãƒˆãƒ¬å‰å¾ŒPFCå›ºå®šå€¤</li>
                        <li><strong>é£Ÿæ</strong> â€” å„ªå…ˆé£Ÿæ/NGé£Ÿæ/ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼</li>
                    </ul>
                    <p class="mt-1">ç·¨é›†å¾Œã¯ <span class="bg-green-600 text-white text-[10px] px-1.5 py-0.5 rounded font-bold">ä¿å­˜</span> ã‚’å¿˜ã‚Œãšã«ã€‚</p>
                </div>
            </section>

            <!-- Tips -->
            <section>
                <h3 class="font-bold text-base text-gray-700 mb-2">Tips</h3>
                <div class="bg-gray-50 rounded-lg p-3 text-xs space-y-1">
                    <ul class="list-disc pl-5 space-y-0.5 text-gray-600">
                        <li>ESCã‚­ãƒ¼ã§ç·¨é›†ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹ã“ã¨ãŒã§ãã¾ã™</li>
                        <li>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®é‡å¤‰æ›´æ™‚ã¯è¿½åŠ æ¸ˆã¿ã‚¢ã‚¤ãƒ†ãƒ ã®æ•°å€¤ã‚’ç›´æ¥ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç·¨é›†ã§ãã¾ã™</li>
                        <li>ã‚¹ãƒ­ãƒƒãƒˆå‰²å½“ã‚’å¤‰æ›´ã™ã‚‹ãŸã³ã«PFCãƒãƒ¼ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ›´æ–°ã•ã‚Œã¾ã™</li>
                        <li>å…±é€šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨è‡ªç¤¾ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ãƒãƒƒã‚¸ã§åŒºåˆ¥ã•ã‚Œã¾ã™</li>
                    </ul>
                </div>
            </section>
        </div>
        <div class="p-4 border-t border-gray-200 text-center">
            <button onclick="toggleGuide()" class="bg-teal-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-teal-700 transition">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <!-- MAIN SCRIPT (loaded after cq-databases.js) -->
    <script src="/js/trainer-functions.js"></script>
    <script>
        function toggleGuide() {
            const o = document.getElementById('cq-guide-overlay');
            const m = document.getElementById('cq-guide-modal');
            const open = o.classList.contains('hidden');
            o.classList.toggle('hidden', !open);
            m.classList.toggle('hidden', !open);
        }
    </script>
</body>
</html>
