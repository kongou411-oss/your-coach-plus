# App Store 審査リジェクト対応ガイド (IAP & サブスクリプション情報)

**提出日**: 2026-01-14
**リジェクト理由**: Guideline 2.1 (IAP未提出) & Guideline 3.1.2 (サブスクリプション情報不足)
**Submission ID**: 654977c7-1999-47a3-80f2-950bcfcc45a9

---

## ✅ Claude Code が完了した作業

### コード修正
- ✅ サブスクリプション画面に利用規約とプライバシーポリシーへのリンクを追加
  - Premium会員タブに追加
  - クレジット追加購入タブに追加
  - リンク先: `/terms.html` と `/privacy.html`

---

## 📱 あなたが実行する手順

### Step 1: App Store Connect でアプリ内課金製品を登録

#### 1-1. App Store Connect にログイン

1. [App Store Connect](https://appstoreconnect.apple.com/) を開く
2. **マイApp** → **Your Coach+** を選択
3. 左側メニューから **サブスクリプション** または **App 内課金** をクリック

#### 1-2. サブスクリプション製品を登録

**製品1: Premium月額プラン**

1. **「+」ボタン** → **自動更新サブスクリプション** を選択
2. 以下の情報を入力:

| 項目 | 入力内容 |
|------|---------|
| **参照名** | Premium Monthly Subscription |
| **製品ID** | `yourcoach_premium_monthly` |
| **サブスクリプショングループ** | 新規グループ作成「Premium Plans」 |
| **サブスクリプション期間** | 1ヶ月 |
| **価格** | ¥940 (Tier 9) |
| **App Review用スクリーンショット** | Premium会員登録画面のスクリーンショット（後述） |
| **レビューノート** | Premium会員登録 - AI分析100回/月 + 全機能使い放題 |

3. **ローカライズ情報** (日本語):
   - **表示名**: Premium会員
   - **説明**: 月額¥940でAI分析100回分 + 全機能使い放題。コミュニティ、履歴、テンプレート無制限、データエクスポートなど。

#### 1-3. 消費型製品を登録 (クレジットパック)

**製品2: 50回クレジットパック**

1. **「+」ボタン** → **消費型** を選択
2. 以下の情報を入力:

| 項目 | 入力内容 |
|------|---------|
| **参照名** | 50 Credits Pack |
| **製品ID** | `yourcoach_credits_50` |
| **価格** | ¥400 (Tier 4) |
| **App Review用スクリーンショット** | クレジット購入画面のスクリーンショット |
| **レビューノート** | AI分析クレジット50回分の追加購入 |

3. **ローカライズ情報** (日本語):
   - **表示名**: 50回パック
   - **説明**: AI分析クレジット50回分

**製品3: 150回クレジットパック**

| 項目 | 入力内容 |
|------|---------|
| **参照名** | 150 Credits Pack |
| **製品ID** | `yourcoach_credits_150` |
| **価格** | ¥1,000 (Tier 10) |
| **ローカライズ表示名** | 150回パック |
| **ローカライズ説明** | AI分析クレジット150回分（人気） |

**製品4: 300回クレジットパック**

| 項目 | 入力内容 |
|------|---------|
| **参照名** | 300 Credits Pack |
| **製品ID** | `yourcoach_credits_300` |
| **価格** | ¥1,800 (Tier 18) |
| **ローカライズ表示名** | 300回パック |
| **ローカライズ説明** | AI分析クレジット300回分（お得） |

#### 1-4. スクリーンショットの用意

各製品に **App Review用スクリーンショット** が必要です。

**方法1: シミュレーターでスクリーンショット撮影**

```bash
# iOS Simulator を起動
open -a Simulator

# アプリを実行
npx cap open ios
# Xcode で Run (▶ボタン)

# シミュレーター上でアプリを操作:
# 1. 設定 → Premium会員登録 をタップ
# 2. スクリーンショット撮影 (Cmd+S)
# 3. クレジット追加購入タブに切り替え
# 4. スクリーンショット撮影 (Cmd+S)
```

**スクリーンショットの保存場所**:
- Mac: `~/Desktop/` に保存されます

**方法2: 実機でスクリーンショット撮影**

- iPhone で Your Coach+ を開く
- 設定 → Premium会員登録を開く
- スクリーンショット撮影 (ボリュームアップ + サイドボタン)
- Mac に AirDrop で転送

#### 1-5. すべての製品を審査に提出

1. 各製品の編集画面で **「審査に提出」** ボタンをクリック
2. すべての製品 (1サブスク + 3消費型 = 計4製品) を提出

---

### Step 2: App Store Connect のメタデータに利用規約リンクを追加

#### 2-1. アプリ情報ページを開く

1. **App Store Connect** → **Your Coach+**
2. 左側メニュー → **App Store** → **バージョン 1.0** (または最新バージョン)

#### 2-2. 利用規約リンクを追加

**オプション1: App説明に利用規約リンクを追加 (推奨)**

1. **App説明** フィールドを編集
2. 説明文の最後に以下を追加:

```
【利用規約・プライバシーポリシー】
利用規約: https://your-coach-plus.web.app/terms.html
プライバシーポリシー: https://your-coach-plus.web.app/privacy.html

サブスクリプション情報:
- 月額¥940で自動更新
- キャンセルはいつでも可能
- 未使用期間の返金はありません
```

**オプション2: EULA (使用許諾契約書) フィールドを使用**

1. 下にスクロールして **「使用許諾契約書」** セクションを探す
2. **「カスタム使用許諾契約書」** を選択
3. 利用規約の全文をコピーして貼り付ける

または:

1. **「標準のApple使用許諾契約書 (EULA) を使用」** を選択
2. App説明に利用規約URLを記載 (上記参照)

#### 2-3. プライバシーポリシーURLを確認

1. **App プライバシー** セクションを確認
2. **プライバシーポリシーURL**: `https://your-coach-plus.web.app/privacy.html`
   - すでに設定されている場合はOK
   - 未設定の場合は追加

3. **保存** をクリック

---

### Step 3: 新しいビルドをアップロード

IAP製品とメタデータを更新したら、アプリの新しいビルドをアップロードします。

#### 3-1. コード修正を確認

Claude Code がすでに以下を完了しています:
- ✅ `src/components/18_subscription.jsx` に利用規約・プライバシーポリシーリンクを追加

#### 3-2. ビルド番号を上げる

**方法1: Xcode で直接変更**

1. Xcode で `ios/App/App.xcodeproj` を開く
2. **TARGETS** → **App** → **General** タブ
3. **Build** 番号を **5** → **6** に変更
4. Cmd+S で保存

**方法2: Info.plist を直接編集**

```bash
# ios/App/App/Info.plist の CFBundleVersion を確認
plutil -p /Users/amtheash7/yourcoach_new/ios/App/App/Info.plist | grep CFBundleVersion

# 現在が 5 の場合、6 に変更
```

#### 3-3. Webビルド & iOS同期

```bash
cd /Users/amtheash7/yourcoach_new

# Webビルド
npm run build

# iOSに同期
npx cap sync ios
```

#### 3-4. Xcode でクリーンビルド & Archive

```bash
# Xcode を開く
open /Users/amtheash7/yourcoach_new/ios/App/App.xcodeproj
```

**Xcode 内で:**

1. **Product** → **Clean Build Folder** (Cmd+Shift+K)
2. **Xcode** → **Settings** → **Locations** → **Derived Data** → **Advanced** → **Reset**
3. **Product** → **Archive**
4. ビルド完了まで待つ (5-10分)

#### 3-5. App Store Connect へアップロード

1. **Organizer** ウィンドウで最新のアーカイブを選択
2. **Distribute App** をクリック
3. **App Store Connect** → **Upload** を選択
4. 証明書を選択 → **Upload**
5. アップロード完了まで待つ (5-15分)

---

### Step 4: 審査に再提出

#### 4-1. ビルドが処理されるまで待つ

- アップロード後、App Store Connect でビルドが処理されるまで **10-30分** かかります
- **マイApp** → **Your Coach+** → **App Store** → **ビルド** で確認

#### 4-2. 新しいビルドを選択

1. **ビルド** セクションで **「+」** または **「ビルドを選択」** をクリック
2. 最新のビルド (**Build 6**) を選択
3. **保存** をクリック

#### 4-3. 審査に提出

1. 画面右上の **「審査に提出」** ボタンをクリック
2. 確認ダイアログで **「提出」** をクリック

---

## 📊 チェックリスト

提出前に以下をすべて確認してください:

### コード修正
- [x] サブスクリプション画面に利用規約リンクを追加
- [x] サブスクリプション画面にプライバシーポリシーリンクを追加

### App Store Connect - IAP製品
- [ ] `yourcoach_premium_monthly` (サブスク) を登録・提出
- [ ] `yourcoach_credits_50` (消費型) を登録・提出
- [ ] `yourcoach_credits_150` (消費型) を登録・提出
- [ ] `yourcoach_credits_300` (消費型) を登録・提出
- [ ] 各製品にApp Review用スクリーンショットを添付

### App Store Connect - メタデータ
- [ ] App説明に利用規約リンクを追加 (または EULA フィールドを設定)
- [ ] プライバシーポリシーURLが設定されている

### ビルド & 提出
- [ ] Build番号を 6 に変更
- [ ] `npm run build && npx cap sync ios` 実行
- [ ] Xcode でクリーンビルド & Archive
- [ ] App Store Connect へアップロード
- [ ] 新しいビルドを選択
- [ ] 審査に提出

---

## ⏱️ タイムライン

| ステップ | 所要時間 |
|---------|---------|
| IAP製品登録 (4製品) | 30-60分 |
| スクリーンショット撮影 | 10分 |
| メタデータ更新 | 5分 |
| ビルド番号変更 | 1分 |
| Web ビルド & iOS 同期 | 2-3分 |
| Xcode Archive | 5-10分 |
| App Store Connect アップロード | 5-15分 |
| ビルド処理完了 | 10-30分 |
| 審査開始 | 提出後 1-3日 |

**合計**: 約 1.5-2 時間 + 審査待ち

---

## 🆘 トラブルシューティング

### Q1: 製品IDが「既に使用されています」と表示される

**A**: 製品IDはAppleのシステム全体で一意である必要があります。

**解決策**:
1. 製品IDの前にバンドルIDを付ける:
   - `com.yourcoach.plus.yourcoachplus.premium_monthly`
2. または、既存の製品を検索:
   - App Store Connect → App 内課金 → 検索
   - 既に登録済みの場合は編集して使用

### Q2: スクリーンショットのサイズ要件は？

**A**: App Review用スクリーンショットは特定のサイズ要件はありません。

- iPhoneシミュレーターのスクリーンショット (Cmd+S) で問題なし
- 推奨サイズ: 1242x2688 (iPhone 14 Pro Max) または 1170x2532 (iPhone 14 Pro)

### Q3: ビルド番号を変更し忘れた

**A**: Xcode に戻って以下を実行:
1. **General** → **Build** を 6 に変更 (または現在の番号+1)
2. 再度 **Product** → **Archive** を実行

### Q4: IAP製品の審査状況を確認したい

**A**: App Store Connect で確認できます:
1. **マイApp** → **Your Coach+** → **App 内課金**
2. 各製品のステータスを確認:
   - **審査待ち**: 提出済み、審査中
   - **承認済み**: 審査完了
   - **却下**: 修正が必要

---

## 📞 サポート

問題が発生した場合:
- スクリーンショットと共に Claude Code に報告してください
- Apple のサポートに問い合わせる: App Store Connect → ヘルプ

---

**今回は必ず審査を通過するはずです！頑張ってください！** 🚀
