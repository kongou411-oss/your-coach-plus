// 食材でよく使われる漢字→読み仮名マッピング
// foodDatabaseで実際に使われているすべての漢字に対応（137文字）
// 音読み・訓読みの両方に対応
// 部分一致検索用（例: 「ぎ」→「牛」、「うし」→「牛」）

export const KANJI_READING_MAP = {
    // 基本的な文字（音訓両方）
    '三': 'さん み みっ',
    '上': 'じょう うえ うわ かみ あ',
    '中': 'ちゅう なか',
    '主': 'しゅ ぬし おも',
    '乳': 'にゅう ちち',
    '乾': 'かん ほ',
    '亜': 'あ',
    '低': 'てい ひく',
    '個': 'こ',
    '倍': 'ばい',
    '全': 'ぜん まった すべ',
    '再': 'さい ふたた',
    '冷': 'れい つめ ひ',
    '分': 'ぶん ふん わ',
    '割': 'わり かつ さ',
    '力': 'りょく ちから',
    '加': 'か くわ',
    '厚': 'こう あつ',
    '口': 'こう くち',
    '味': 'み あじ',
    '和': 'わ やわ なご',
    '品': 'ひん しな',
    '団': 'だん',
    '大': 'だい おお',
    '子': 'し こ',
    '小': 'しょう ちい こ',
    '岩': 'がん いわ',
    '強': 'きょう つよ',
    '後': 'ご こう あと のち うし',
    '揚': 'よう あ',
    '料': 'りょう',
    '春': 'しゅん はる',
    '最': 'さい もっと',
    '木': 'もく き',
    '東': 'とう ひがし',
    '松': 'しょう まつ',
    '板': 'ばん いた',
    '枝': 'し えだ',
    '柏': 'はく かしわ',
    '柱': 'ちゅう はしら',
    '根': 'こん ね',
    '桜': 'おう さくら',
    '殖': 'しょく ふ',
    '水': 'すい みず',
    '油': 'ゆ あぶら',
    '泉': 'せん いずみ',
    '淡': 'たん あわ',
    '温': 'おん あたた ぬく',
    '漬': 'つ',
    '濃': 'のう こ',
    '炊': 'すい た',
    '無': 'む ぶ な',
    '焼': 'しょう や',
    '煮': 'しゃ に',
    '熱': 'ねつ あつ',
    '片': 'へん かた',
    '玄': 'げん',
    '理': 'り',
    '甘': 'かん あま',
    '生': 'せい なま い',
    '発': 'はつ ほつ',
    '白': 'はく びゃく しろ',
    '皮': 'ひ かわ',
    '目': 'もく め',
    '直': 'ちょく じき なお ただ',
    '福': 'ふく',
    '粉': 'ふん こ こな',
    '粒': 'りゅう つぶ',
    '粗': 'そ あら',
    '精': 'せい しょう',
    '納': 'のう なっ な',
    '絹': 'けん きぬ',
    '綿': 'めん わた',
    '緑': 'りょく みどり',
    '練': 'れん ね',
    '縮': 'しゅく ちぢ',
    '缶': 'かん',
    '群': 'ぐん む',
    '肩': 'けん かた',
    '肪': 'ぼう',
    '胚': 'はい',
    '脂': 'し あぶら',
    '腐': 'ふ くさ',
    '色': 'しょく しき いろ',
    '芽': 'が め',
    '草': 'そう くさ',
    '菊': 'きく',
    '菓': 'か',
    '華': 'か はな',
    '葉': 'よう は',
    '蒲': 'ほ がま かば',
    '蕷': 'しょ',
    '薄': 'はく うす',
    '蜜': 'みつ',
    '製': 'せい',
    '調': 'ちょう しら ととの',
    '貝': 'かい',
    '身': 'しん み',
    '辛': 'しん から つら',
    '酒': 'しゅ さけ さか',
    '酢': 'さく す',
    '酸': 'さん す',
    '里': 'り さと',
    '鉄': 'てつ',
    '鉛': 'えん なまり',
    '長': 'ちょう なが',
    '関': 'かん せき',
    '雨': 'う あめ',
    '類': 'るい',
    '風': 'ふう かぜ',
    '食': 'しょく じき く た',
    '飯': 'はん めし',
    '餅': 'へい もち',
    '養': 'よう やしな',
    '黄': 'おう こう き',
    '黒': 'こく くろ',

    // 肉類・魚介類（音訓両方）
    '牛': 'ぎゅう うし',
    '豚': 'とん ぶた',
    '鶏': 'けい にわとり とり',
    '鳥': 'ちょう とり',
    '鴨': 'おう かも',
    '羊': 'よう ひつじ',
    '馬': 'ば うま',
    '猪': 'ちょ いのしし い',
    '鹿': 'ろく しか',
    '肉': 'にく',

    // 魚介類（音訓両方）
    '鮭': 'さけ しゃけ',
    '鯖': 'さば',
    '鰯': 'いわし',
    '鯵': 'あじ',
    '鰹': 'かつお',
    '鮪': 'まぐろ',
    '鰤': 'ぶり',
    '鯛': 'たい',
    '鰻': 'うなぎ',
    '秋刀魚': 'さんま',
    '蛸': 'たこ',
    '烏賊': 'いか',
    '海老': 'えび',
    '蝦': 'えび',
    '蟹': 'かに',
    '貝': 'かい',
    '鮑': 'あわび',
    '牡蠣': 'かき',

    // 野菜（音訓両方）
    '玉': 'ぎょく たま',
    '葱': 'そう ねぎ',
    '茄子': 'なす なすび',
    '南瓜': 'なんか かぼちゃ',
    '胡瓜': 'きゅうり',
    '人参': 'にんじん じんしん',
    '蕃茄': 'ばんか トマト',
    '馬鈴薯': 'ばれいしょ じゃがいも',
    '薩摩芋': 'さつまいも',
    '芋': 'う いも',
    '大根': 'だいこん',
    '蓮根': 'れんこん',
    '牛蒡': 'ごぼう',
    '筍': 'じゅん たけのこ',
    '椎茸': 'しいたけ',
    '茸': 'じょう きのこ',
    '舞茸': 'まいたけ',
    '榎茸': 'えのきたけ',
    '白菜': 'はくさい',
    '菜': 'さい な',
    '菠菜': 'ほうれんそう',
    '韮': 'きゅう にら',
    '蒜': 'さん にんにく ひる',
    '生姜': 'しょうが しょうきょう',
    '豆': 'とう ず まめ',
    '枝豆': 'えだまめ',
    '豌豆': 'えんどう',
    '莢': 'きょう さや',
    '隠元': 'いんげん',
    '茶': 'ちゃ さ',

    // 果物（音訓両方）
    '苺': 'ばい いちご',
    '林檎': 'りんご',
    '蜜柑': 'みかん',
    '柑': 'かん',
    '桃': 'とう もも',
    '梨': 'り なし',
    '柿': 'し かき',
    '葡萄': 'ぶどう',
    '西瓜': 'せいか すいか',
    '瓜': 'か うり',
    '檸檬': 'れいもん レモン',
    '柚子': 'ゆず ゆうず',
    '李': 'り すもも',
    '杏': 'きょう あんず',
    '梅': 'ばい うめ',
    '栗': 'りつ くり',
    '胡桃': 'くるみ',
    '銀杏': 'ぎんなん いちょう',

    // 穀類（音訓両方）
    '米': 'べい まい こめ',
    '麦': 'ばく むぎ',
    '麺': 'めん',
    '蕎麦': 'そば きょうばく',

    // 調味料・その他（音訓両方）
    '醤': 'しょう ひしお',
    '噌': 'そ みそ',
    '塩': 'えん しお',
    '糖': 'とう',
    '卵': 'らん たまご',

    // 加工食品（音訓両方）
    '豆腐': 'とうふ',
    '腐': 'ふ くさ',

    // 部位・状態（音訓両方）
    '赤': 'せき しゃく あか',
    '薯': 'しょ いも'
};

/**
 * テキスト内の漢字を読み仮名に変換（部分的）
 * 例: 「牛肉」 → 「ぎゅうにく」（「肉」も変換される場合）
 */
export function convertKanjiToReading(text) {
    let result = text;

    // マッピングテーブルの各エントリをチェック
    for (const [kanji, reading] of Object.entries(KANJI_READING_MAP)) {
        if (text.includes(kanji)) {
            // 元のテキストに含まれる漢字の読み仮名を追加（スペース区切り）
            result += ' ' + reading;
        }
    }

    return result;
}

/**
 * 検索用の正規化テキストを生成
 * 元のテキスト + 読み仮名候補を返す
 */
export function normalizeForSearch(text) {
    // 基本的な正規化
    const normalized = text
        .toLowerCase()
        .replace(/[（）\(\)]/g, '') // 括弧を削除
        .replace(/[\u30a1-\u30f6]/g, (m) => String.fromCharCode(m.charCodeAt(0) - 0x60)) // カタカナ→ひらがな
        .replace(/\s+/g, ''); // 空白削除

    // 漢字→読み仮名変換を追加
    const withReading = convertKanjiToReading(text);
    const normalizedWithReading = withReading
        .toLowerCase()
        .replace(/[（）\(\)]/g, '')
        .replace(/[\u30a1-\u30f6]/g, (m) => String.fromCharCode(m.charCodeAt(0) - 0x60))
        .replace(/\s+/g, '');

    return normalizedWithReading;
}
