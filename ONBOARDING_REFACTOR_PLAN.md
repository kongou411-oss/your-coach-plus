# オンボーディング改修計画

**作成日**: 2025年11月2日
**ステータス**: 次回実装予定
**優先度**: 高

---

## 📋 現状分析

### 現在のフロー

```
1. ログイン/サインアップ（LoginScreen）
   ↓
2. オンボーディング（OnboardingScreen - 4ステップ）
   - Step 1: 基本情報（氏名、性別、年齢、睡眠時間、スタイル）
   - Step 2: 体組成（身長、体重、体脂肪率、理想の体型）
   - Step 3: 目的（ダイエット、メンテナンス、バルクアップ、リコンプ）
   - Step 4: 活動レベル、カロリー調整値
   ↓
3. WelcomeGuideModal（4ページのアプリ使い方ガイド）
   - Page 1: Your Coach+の特徴
   - Page 2: 記録フロー（食事→運動→コンディション→分析→全機能開放）
   - Page 3: 画面の使い方
   - Page 4: データ蓄積のメリット
   ↓
4. ダッシュボード（記録開始）
```

### 評価スコア: 60点 / 100点

---

## ✅ 現在のUIの優れている点

### 1. 明確な目標設定フロー
- Step 3で目的を選択（ダイエット、メンテナンス、バルクアップ、リコンプ）
- 目的に応じたカロリー調整値が自動設定される
- 最終的な目標摂取カロリーが表示される

**評価**: ゴールベースの思想は**既に実装されている**。目的→カロリー→具体的な数値という流れは科学的で明確。

### 2. 理想の体型目標（Step 2）
- 理想の体重、理想の体脂肪率、理想のLBMを設定
- 現在のLBMとの差分を表示

**評価**: ゴールを数値化しており、ユーザーが目指すべき体型を明確にイメージできる。

### 3. WelcomeGuideModal
- 4ページで段階的に説明
- 記録フロー（食事→運動→コンディション→分析）が明示されている
- 「初日に分析まで完了すれば、すべての機能がすぐに使える」と動機づけ

**評価**: チュートリアル的要素が既に存在し、記録の流れと目的を理解させている。

---

## ⚠️ 現在のUIの課題

### 1. 情報入力の順序が逆

**現在の順序**:
```
基本情報 → 体組成 → 目的 → 活動レベル
```

**問題点**:
- **目的（ゴール）が3番目**: ユーザーはまず「なぜこのアプリを使うのか」を明確にするべき
- **目的意識が後回し**: 基本情報を入力している時点では、まだゴールが不明確
- **動機づけが弱い**: なぜこの情報が必要なのか理解できないまま入力を求められる

### 2. 栄養教育が不足

**現在の問題**:
- PFC、LBM、TDEE、カロリー調整値などの専門用語が説明なしに登場
- 「なぜタンパク質が重要なのか」「なぜ体脂肪率を測るのか」といった理由が不明
- WelcomeGuideModal は使い方の説明のみで、栄養知識の教育がない

### 3. テンプレート作成の誘導が弱い

**現在の問題**:
- WelcomeGuideModal の onFinish で「食事誘導モーダル」を表示する設計だが、実際のテンプレート作成までの誘導が弱い
- ダッシュボードに到達後、「何を記録すればいいのか」が不明確

### 4. WelcomeGuideModal とオンボーディングが分離

**現在の問題**:
- オンボーディング（4ステップ）→ WelcomeGuideModal（4ページ）という2段階構成
- ユーザーは8つの画面を通過する必要があり、離脱リスクが高い

---

## 🎯 改善方針：ゴールベース・チュートリアル統合型オンボーディング

### コンセプト

```
WHY（なぜ） → GOAL（ゴール） → NOW（現在地） → HOW（方法） → PRACTICE（実践）
```

この順序により：
1. **動機づけ**: 最初に目的を明確化することで、以降の入力に納得感が生まれる
2. **目標の可視化**: ゴールを設定してから現在地を入力することで、ギャップを認識できる
3. **栄養教育**: 各ステップで「なぜこの情報が必要なのか」を簡潔に説明
4. **実践誘導**: 最後に実際にテンプレートを作成することで、記録開始のハードルを下げる

---

## 📐 新しいオンボーディングフロー（全5ステップ）

### Step 1: WHY - 目的を選ぶ

**UI構成**:
```
┌─────────────────────────────────┐
│ あなたの目的は？               │
├─────────────────────────────────┤
│ □ ダイエット                   │
│   脂肪を落としてスリムな体に   │
│                                 │
│ □ バルクアップ                 │
│   筋肉をつけて大きな体に       │
│                                 │
│ □ メンテナンス                 │
│   今の体型を維持する           │
│                                 │
│ □ リコンプ                     │
│   筋肉を増やしつつ脂肪を減らす │
└─────────────────────────────────┘
```

**教育要素**:
- 各目的の簡潔な説明（1-2行）
- 選択後: 「あなたのゴールは〇〇です！一緒に達成しましょう」と動機づけ

**実装ファイル**: `components/02_auth.js` - OnboardingScreen

---

### Step 2: GOAL - 理想の体型を設定

**UI構成**:
```
┌─────────────────────────────────┐
│ 理想の体型を教えてください     │
├─────────────────────────────────┤
│ 理想の体重: [  70  ] kg        │
│ 理想の体脂肪率: [  15  ] %     │
│                                 │
│ ┌─────────────────────────┐   │
│ │ 理想のLBM: 59.5 kg      │   │
│ │ （除脂肪体重）          │   │
│ └─────────────────────────┘   │
└─────────────────────────────────┘

💡 LBMとは？
筋肉や骨など、脂肪以外の体重です。
健康的な体づくりの鍵は、このLBMを
増やすこと（または維持すること）です。
```

**教育要素**:
- LBMの説明（簡潔に）
- なぜLBMが重要なのか
- 視覚的ガイド（体脂肪率の外見イメージ）へのリンク

**実装ファイル**: `components/02_auth.js` - OnboardingScreen

---

### Step 3: NOW - 現在地を知る

**UI構成**:
```
┌─────────────────────────────────┐
│ 現在の体組成を入力してください │
├─────────────────────────────────┤
│ 身長: [  170  ] cm             │
│ 体重: [  75  ] kg              │
│ 体脂肪率: [  20  ] %           │
│                                 │
│ ┌─────────────────────────┐   │
│ │ 現在のLBM: 60.0 kg      │   │
│ └─────────────────────────┘   │
│                                 │
│ ┌─────────────────────────┐   │
│ │ 🎯 目標までの距離       │   │
│ │ LBM: -0.5 kg            │   │
│ │ 体脂肪: -5%             │   │
│ └─────────────────────────┘   │
└─────────────────────────────────┘

💡 体脂肪率の測り方
体組成計での測定を推奨します。
不明な場合は「外見から推定」ボタンで
おおよその値を確認できます。
```

**教育要素**:
- 体脂肪率の測定方法
- ゴールとのギャップを可視化
- 「外見から推定」機能（既存のvisualGuideModalを活用）

**実装ファイル**: `components/02_auth.js` - OnboardingScreen

---

### Step 4: HOW - 達成方法を理解する

**UI構成**:
```
┌─────────────────────────────────┐
│ 達成するための設定             │
├─────────────────────────────────┤
│ 活動レベル:                     │
│ [デスクワーク中心 - 1.05x ▼]   │
│                                 │
│ カロリー調整:                   │
│ [-300] kcal/日（ダイエット推奨）│
│                                 │
│ ┌─────────────────────────┐   │
│ │ 🎯 あなたの目標摂取量   │   │
│ │                         │   │
│ │ カロリー: 2100 kcal/日  │   │
│ │ タンパク質: 150g        │   │
│ │ 脂質: 58g               │   │
│ │ 炭水化物: 210g          │   │
│ └─────────────────────────┘   │
└─────────────────────────────────┘

💡 PFCバランスとは？
P: Protein（タンパク質）
F: Fat（脂質）
C: Carbohydrate（炭水化物）

タンパク質はLBMを維持・増やすために
最も重要な栄養素です。体重1kgあたり
2g程度を目安に摂取しましょう。
```

**教育要素**:
- PFCの意味と重要性
- タンパク質の役割（LBM維持）
- TDEEの簡単な説明
- なぜカロリー調整が必要なのか

**実装ファイル**: `components/02_auth.js` - OnboardingScreen

---

### Step 5: PRACTICE - 実際に記録してみる

**UI構成**:
```
┌─────────────────────────────────┐
│ 朝食の定番メニューを            │
│ 登録してみましょう！            │
├─────────────────────────────────┤
│ これをテンプレートとして保存すれば│
│ 明日からワンタップで記録できます│
│                                 │
│ ┌─────────────────────────┐   │
│ │ [🔍 食材を検索]         │   │
│ └─────────────────────────┘   │
│                                 │
│ 追加された食材:                 │
│ • 鶏むね肉 200g                 │
│ • 白米 150g                     │
│ • 卵 2個                        │
│                                 │
│ [💾 テンプレートとして保存]    │
│ [⏭️  スキップ（後で設定）]     │
└─────────────────────────────────┘

💡 テンプレートのメリット
一度登録すれば、次回から数秒で記録完了。
継続のカギは「記録の手軽さ」です！
```

**教育要素**:
- テンプレートの便利さを体験
- 実際に検索して選択する練習
- スキップ可能（後から「設定 → ヘルプ」で確認可能）

**実装ファイル**:
- `components/02_auth.js` - OnboardingScreen（UI部分）
- `components/07_add_item_v2.js`の検索機能を活用

---

### 基本情報（氏名、年齢、性別）の扱い

**配置案A**: Step 1の前に簡単に入力
```
Step 0: 基本情報（氏名、年齢、性別）
  ↓
Step 1: WHY（目的）
```

**配置案B**: Step 4の後に入力
```
Step 4: HOW（達成方法）
  ↓
Step 4.5: 基本情報（氏名、年齢、性別）
  ↓
Step 5: PRACTICE（実践）
```

**推奨**: 案A（Step 1の前）
- 理由: 既存の実装との互換性が高い
- ただし、「なぜこの情報が必要なのか」を簡潔に説明する

---

## 🚀 実装計画

### Phase 1: オンボーディングの順序変更（1週間）

**タスク**:
1. `components/02_auth.js` の OnboardingScreen を編集
2. Step順序を変更:
   - 旧Step 3（目的） → 新Step 1
   - 旧Step 2（理想の体型） → 新Step 2
   - 旧Step 2（現在の体組成） → 新Step 3
   - 旧Step 4（活動レベル） → 新Step 4
   - 旧Step 1（基本情報） → 新Step 0（または4.5）
3. 各ステップのプログレス表示を調整（1/5, 2/5, ...）

**変更ファイル**:
- `components/02_auth.js` (Line 515-1192)

**期待される効果**:
- 目的意識の明確化
- 入力の納得感向上

---

### Phase 2: 栄養教育の追加（1-2週間）

**タスク**:
1. 各ステップに「💡 教育セクション」を追加
2. LBMの説明（Step 2, 3）
3. PFCの説明（Step 4）
4. テンプレートのメリット説明（Step 5）
5. 専門用語の簡潔な説明（最大3-4行）

**変更ファイル**:
- `components/02_auth.js` (OnboardingScreen内)

**期待される効果**:
- 専門用語への理解向上
- 記録の意義を理解
- 継続意欲の向上

---

### Phase 3: テンプレート作成誘導（1-2週間）

**タスク**:
1. Step 5として「実際に記録してみる」を追加
2. 食材検索機能を呼び出す（`components/07_add_item_v2.js`の検索モーダルを再利用）
3. テンプレート保存機能を実装
4. スキップボタンを追加（後から「設定 → ヘルプ」で確認可能）

**変更ファイル**:
- `components/02_auth.js` (OnboardingScreen内に新Step 5を追加)
- `components/07_add_item_v2.js` (検索機能の再利用可能化)

**期待される効果**:
- 記録開始のハードル低下
- テンプレートの便利さを体験
- 継続率向上

---

### Phase 4: WelcomeGuideModal統合（1週間）

**タスク**:
1. 現在のWelcomeGuideModalの内容を確認
2. オンボーディングの各ステップに統合可能な内容を抽出
3. 重複する内容を削除
4. 必要に応じてWelcomeGuideModalを簡略化、または削除

**変更ファイル**:
- `components/08_app.js` (WelcomeGuideModal部分)
- `components/02_auth.js` (統合先)

**期待される効果**:
- 離脱リスク低減（8画面 → 5画面）
- 一貫した体験の提供

---

## 📊 成功指標（KPI）

### 定量指標
- オンボーディング完了率: 現在 XX% → 目標 80%以上
- 初回記録完了率: 現在 XX% → 目標 60%以上
- 7日間継続率: 現在 XX% → 目標 50%以上

### 定性指標
- ユーザーフィードバック: 「わかりやすかった」「目的が明確になった」
- サポート問い合わせ減少: 「使い方がわからない」系の問い合わせが減少

---

## ⚠️ リスクと対策

### リスク1: 既存ユーザーへの影響
**対策**:
- 既存ユーザーは既にオンボーディング完了済み
- 新規ユーザーのみに適用されるため影響なし

### リスク2: 実装の複雑化
**対策**:
- Phase 1から段階的に実装
- 各Phaseで動作確認を徹底

### リスク3: Step 5（実践）の実装難易度
**対策**:
- 既存の検索機能（`components/07_add_item_v2.js`）を再利用
- 最小限の機能に絞る（検索 → 選択 → 保存のみ）

---

## 🎯 次回実装時のチェックリスト

### 実装前
- [ ] 現在の`components/02_auth.js`をバックアップ
- [ ] ブラウザで現在のオンボーディングフローを確認・スクリーンショット
- [ ] WelcomeGuideModalの内容を確認

### Phase 1実装時
- [ ] Step順序を変更
- [ ] プログレス表示を調整（X/5形式）
- [ ] 動作確認（ブラウザ）
- [ ] キャッシュバスター更新

### Phase 2実装時
- [ ] 各ステップに教育セクションを追加
- [ ] LBM、PFC、TDEEの説明を追加
- [ ] 文字数チェック（各説明は3-4行以内）
- [ ] 動作確認（ブラウザ）

### Phase 3実装時
- [ ] Step 5の実装
- [ ] 検索機能の統合
- [ ] テンプレート保存機能の実装
- [ ] スキップ機能の実装
- [ ] 動作確認（ブラウザ）

### Phase 4実装時
- [ ] WelcomeGuideModalとの統合
- [ ] 重複内容の削除
- [ ] 動作確認（ブラウザ）

### 実装後
- [ ] 全体フローのテスト（新規ユーザーとして）
- [ ] エラーチェック（F12コンソール）
- [ ] ユーザーフィードバック収集

---

## 📝 補足メモ

### WelcomeGuideModalの現在の内容（参考）

**Page 1**: Your Coach+の特徴
- LBMベースの科学的アプローチ
- 7日間すべての機能が無料
- AIがあなたをパーソナライズ

**Page 2**: 毎日の記録で体を知る
- 食事記録 → 運動記録 → コンディション記録 → 分析 → 全機能開放

**Page 3**: 画面の使い方
- 画面下部のタブバー
- 追加ボタン
- 左右のショートカット

**Page 4**: データが蓄積されると...
- 履歴画面で長期トレンドを確認
- AI分析で改善提案
- 繰り返すことでパーソナライズ

**統合方針**:
- Page 2の内容 → Step 5（実践）に統合
- Page 3の内容 → 削除（ダッシュボードで自然に理解できる）
- Page 1, 4の内容 → 簡略化してStep 1またはStep 4に統合

---

## 🔗 関連ファイル

- `components/02_auth.js` (Line 515-1192): OnboardingScreen
- `components/08_app.js` (Line 1-300): WelcomeGuideModal
- `components/07_add_item_v2.js`: 食材検索機能
- `components/03_dashboard.js`: ダッシュボード
- `utils.js`: LBMUtils（LBM計算関連）

---

**最終更新**: 2025年11月2日
**次回実装予定**: 次回チャットセッション
